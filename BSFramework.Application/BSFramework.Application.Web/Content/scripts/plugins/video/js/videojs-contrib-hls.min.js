/**
 * videojs-contrib-hls
 * @version 5.8.2
 * @copyright 2017 Brightcove, Inc
 * @license Apache-2.0
 *//*
 2017 Brightcove, Inc
 @license Apache-2.0
*/
(function(M){"object"===typeof exports&&"undefined"!==typeof module?module.exports=M():"function"===typeof define&&define.amd?define([],M):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).videojsContribHls=M()})(function(){return function k(q,l,e){function h(d,b){if(!l[d]){if(!q[d]){var a="function"==typeof require&&require;if(!b&&a)return a(d,!0);if(n)return n(d,!0);a=Error("Cannot find module '"+d+"'");throw a.code="MODULE_NOT_FOUND",a;}a=l[d]={exports:{}};q[d][0].call(a.exports,function(a){var b=q[d][1][a];return h(b?b:a)},a,a.exports,k,q,l,e)}return l[d].exports}for(var n="function"==typeof require&&require,f=0;f<e.length;f++)h(e[f]);return h}({1:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});var e=function(){return function(f,d){if(Array.isArray(f))return f;if(Symbol.iterator in Object(f)){var b=[],a=!0,c=!1,r=void 0;try{for(var u=f[Symbol.iterator](),t;!(a=(t=u.next()).done)&&(b.push(t.value),!d||b.length!==d);a=!0);}catch(v){c=!0,r=v}finally{try{if(!a&&u["return"])u["return"]()}finally{if(c)throw r;}}return b}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),h=(k=k("global/window"))&&k.__esModule?k:{"default":k},n=function(f,d){for(var b=f.cues,a=0;a<b.length;a++){var c=b[a];if(d>=c.adStartTime&&d<=c.adEndTime)return c}return null};l["default"]={updateAdCues:function(f,d){if(f.segments)for(var b=2>=arguments.length||void 0===arguments[2]?0:arguments[2],a=void 0,c=0;c<f.segments.length;c++){var r=f.segments[c];a||(a=n(d,b+r.duration/2));if(a){if("cueIn"in r){a.endTime=b;a.adEndTime=b;b+=r.duration;a=null;continue}if(b<a.endTime){b+=r.duration;continue}a.endTime+=r.duration}else if("cueOut"in r&&(a=new h["default"].VTTCue(b,b+r.duration,r.cueOut),a.adStartTime=b,a.adEndTime=b+parseFloat(r.cueOut),d.addCue(a)),"cueOutCont"in r){var u,t;u=r.cueOutCont.split("/").map(parseFloat);a=e(u,2);u=a[0];t=a[1];a=new h["default"].VTTCue(b,b+r.duration,"");a.adStartTime=b-u;a.adEndTime=a.adStartTime+t;d.addCue(a)}b+=r.duration}},findAdCue:n};q.exports=l["default"]},{"global/window":27}],2:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});var e=function(f,d){var b=f.toString(16);return"00".substring(0,2-b.length)+b+(d%2?" ":"")},h=function(f){return 32<=f&&126>f?String.fromCharCode(f):"."},n={hexDump:function(f){f=Array.prototype.slice.call(f);for(var d="",b,a,c=0;c<f.length/16;c++)b=f.slice(16*c,16*c+16).map(e).join(""),a=f.slice(16*c,16*c+16).map(h).join(""),d+=b+" "+a+"\n";return d},tagDump:function(f){return n.hexDump(f.bytes)},textRanges:function(f){var d="",b;for(b=0;b<f.length;b++){var a;a=f;var c=b;a=a.start(c)+"-"+a.end(c);d+=a+" "}return d},createTransferableMessage:function(f){var d={};Object.keys(f).forEach(function(b){var a=f[b];ArrayBuffer.isView(a)?d[b]={bytes:a.buffer,byteOffset:a.byteOffset,byteLength:a.byteLength}:d[b]=a});return d},initSegmentId:function(f){var d=f.byterange||{length:Infinity,offset:0};return[d.length,d.offset,f.resolvedUri].join()}};l["default"]=n;q.exports=l["default"]},{}],3:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});l["default"]={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,GOAL_BUFFER_LENGTH_RATE:1,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,BUFFER_LOW_WATER_LINE_RATE:1};q.exports=l["default"]},{}],4:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});var e=k("global/window"),h=e&&e.__esModule?e:{"default":e},n=k("aes-decrypter"),f=k("./bin-utils"),d=function(b){b.onmessage=function(a){var b=a.data;a=new Uint8Array(b.encrypted.bytes,b.encrypted.byteOffset,b.encrypted.byteLength);var d=new Uint32Array(b.key.bytes,b.key.byteOffset,b.key.byteLength/4),u=new Uint32Array(b.iv.bytes,b.iv.byteOffset,b.iv.byteLength/4);new n.Decrypter(a,d,u,function(a,c){h["default"].postMessage((0,f.createTransferableMessage)({source:b.source,decrypted:c}),[c.buffer])})}};l["default"]=function(b){return new d(b)};q.exports=l["default"]},{"./bin-utils":2,"aes-decrypter":23,"global/window":27}],5:[function(k,q,l){(function(e){function h(a){return a&&a.__esModule?a:{"default":a}}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(l,"__esModule",{value:!0});var f=function(){function a(a,b){for(var g=0;g<b.length;g++){var c=b[g];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,g,c){g&&a(b.prototype,g);c&&a(b,c);return b}}(),d=function(a,b,g){var c=!0;for(;c;)if(null===a&&(a=Function.prototype),c=Object.getOwnPropertyDescriptor(a,b),void 0===c){a=Object.getPrototypeOf(a);if(null===a)break;c=!0}else{if("value"in c)return c.value;b=c.get;return void 0===b?void 0:b.call(g)}},b=k("./playlist-loader"),a=h(b),b=k("./segment-loader"),c=h(b),b=k("./vtt-segment-loader"),r=h(b),b=k("./ranges"),u=h(b),t=h("undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null);e=k("./ad-cue-tags");var v=h(e);e=k("./sync-controller");var g=h(e),p=k("videojs-contrib-media-sources/es5/codec-utils");e=k("webworkify");var x=h(e);e=k("./decrypter-worker");var w=h(e);e=k("./config");var m=h(e),C=void 0,y={videoCodec:"avc1",videoObjectTypeIndicator:".4d400d",audioProfile:"2"},z="mediaRequests mediaRequestsAborted mediaRequestsTimedout mediaRequestsErrored mediaTransferDuration mediaBytesTransferred".split(" "),B=function(a){return this.audioSegmentLoader_[a]+this.mainSegmentLoader_[a]},A=function(a,b){if(typeof a!==typeof b||Object.keys(a).length!==Object.keys(b).length)return!0;for(var c in a)if(a[c]!==b[c])return!0;return!1},E=function(a){var b={codecCount:0},c;b.codecCount=a.split(",").length;b.codecCount=b.codecCount||2;if(c=/(^|\s|,)+(avc1)([^ ,]*)/i.exec(a))b.videoCodec=c[2],b.videoObjectTypeIndicator=c[3];b.audioProfile=/(^|\s|,)+mp4a.[0-9A-Fa-f]+\.([0-9A-Fa-f]+)/i.exec(a);b.audioProfile=b.audioProfile&&b.audioProfile[2];return b},q=function(a){return a.replace(/avc1\.(\d+)\.(\d+)/i,function(a){return(0,p.translateLegacyCodecs)([a])[0]})};l.mapLegacyAvcCodecs_=q;var D=function(a,b,c){return a+"/"+b+'; codecs\x3d"'+c.filter(function(a){return!!a}).join(", ")+'"'},G=function(a,b){var c;c=b.segments&&b.segments.length&&b.segments[0].map?"mp4":"mp2t";var g;var m=b.attributes||{};g=m.CODECS?E(m.CODECS):y;var d=b.attributes||{},m=!0,r=!1;if(!b)return[];if(a.mediaGroups.AUDIO&&d.AUDIO&&(d=a.mediaGroups.AUDIO[d.AUDIO])){var r=!0,m=!1,p;for(p in d)if(!d[p].uri){m=!0;break}}r&&!g.audioProfile&&(t["default"].log.warn("Multiple audio tracks present but no audio codec string is specified. Attempting to use the default audio codec (mp4a.40.2)"),g.audioProfile=y.audioProfile);var f,w;g.videoCodec&&(f=""+g.videoCodec+g.videoObjectTypeIndicator);g.audioProfile&&(w="mp4a.40."+g.audioProfile);p=D("audio",c,[w]);g=D("video",c,[f]);c=D("video",c,[f,w]);return r?!m&&f?[g,p]:[c,p]:f?[c]:[p]};l.mimeTypesForPlaylist_=G;e=function(b){function p(b){var m=this;if(!(this instanceof p))throw new TypeError("Cannot call a class as a function");d(Object.getPrototypeOf(p.prototype),"constructor",this).call(this);var f=b.url,u=b.withCredentials,v=b.mode,h=b.tech,e=b.bandwidth,y=b.externHls,n=b.useCueTags,I=b.blacklistDuration;if(!f)throw Error("A non-empty playlist URL is required");C=y;this.withCredentials=u;this.tech_=h;this.hls_=h.hls;this.mode_=v;this.useCueTags_=n;this.blacklistDuration=I;this.useCueTags_&&(this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues"),this.cueTagsTrack_.inBandMetadataTrackDispatchType="");this.requestOptions_={withCredentials:this.withCredentials,timeout:null};this.audioGroups_={};this.subtitleGroups_={groups:{},tracks:{}};this.mediaSource=new t["default"].MediaSource({mode:v});this.audioinfo_=null;this.mediaSource.on("audioinfo",this.handleAudioinfoUpdate_.bind(this));this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_.bind(this));this.seekable_=t["default"].createTimeRanges();this.hasPlayed_=function(){return!1};this.syncController_=new g["default"](b);this.segmentMetadataTrack_=h.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!0).track;this.decrypter_=(0,x["default"])(w["default"]);u={hls:this.hls_,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:function(){return m.seekable()},seeking:function(){return m.tech_.seeking()},duration:function(){return m.mediaSource.duration},hasPlayed:function(){return m.hasPlayed_()},goalBufferLength:function(){return m.goalBufferLength()},bandwidth:e,syncController:this.syncController_,decrypter:this.decrypter_};this.masterPlaylistLoader_=new a["default"](f,this.hls_,this.withCredentials);this.setupMasterPlaylistLoaderListeners_();this.subtitlePlaylistLoader_=this.audioPlaylistLoader_=null;this.mainSegmentLoader_=new c["default"](t["default"].mergeOptions(u,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),b);this.audioSegmentLoader_=new c["default"](t["default"].mergeOptions(u,{loaderType:"audio"}),b);this.subtitleSegmentLoader_=new r["default"](t["default"].mergeOptions(u,{loaderType:"vtt"}),b);this.setupSegmentLoaderListeners_();z.forEach(function(a){m[a+"_"]=B.bind(m,a)});this.masterPlaylistLoader_.load()}n(p,b);f(p,[{key:"setupMasterPlaylistLoaderListeners_",value:function(){var a=this;this.masterPlaylistLoader_.on("loadedmetadata",function(){var b=a.masterPlaylistLoader_.media(),c=1500*a.masterPlaylistLoader_.targetDuration;a.masterPlaylistLoader_.isLowestEnabledRendition_()?a.requestOptions_.timeout=0:a.requestOptions_.timeout=c;b.endList&&"none"!==a.tech_.preload()&&(a.mainSegmentLoader_.playlist(b,a.requestOptions_),a.mainSegmentLoader_.load());a.fillAudioTracks_();a.setupAudio();a.fillSubtitleTracks_();a.setupSubtitles();a.triggerPresenceUsage_(a.master(),b);try{a.setupSourceBuffers_()}catch(J){return t["default"].log.warn("Failed to create SourceBuffers",J),a.mediaSource.endOfStream("decode")}a.setupFirstPlay();a.trigger("audioupdate");a.trigger("selectedinitialmedia")});this.masterPlaylistLoader_.on("loadedplaylist",function(){var b=a.masterPlaylistLoader_.media();b?(a.useCueTags_&&a.updateAdCues_(b),a.mainSegmentLoader_.playlist(b,a.requestOptions_),a.updateDuration(),a.tech_.paused()||a.mainSegmentLoader_.load(),b.endList||function(){var b=function(){var b=a.seekable();0!==b.length&&a.mediaSource.addSeekableRange_(b.start(0),b.end(0))};Infinity!==a.duration()?function(){a.tech_.one("durationchange",function K(){if(Infinity===a.duration())b();else a.tech_.one("durationchange",K)})}():b()}()):(a.initialMedia_=a.selectPlaylist(),a.masterPlaylistLoader_.media(a.initialMedia_))});this.masterPlaylistLoader_.on("error",function(){a.blacklistCurrentPlaylist(a.masterPlaylistLoader_.error)});this.masterPlaylistLoader_.on("mediachanging",function(){a.mainSegmentLoader_.abort();a.mainSegmentLoader_.pause()});this.masterPlaylistLoader_.on("mediachange",function(){var b=a.masterPlaylistLoader_.media(),c=1500*a.masterPlaylistLoader_.targetDuration,g=void 0,g=void 0;a.masterPlaylistLoader_.isLowestEnabledRendition_()?a.requestOptions_.timeout=0:a.requestOptions_.timeout=c;a.mainSegmentLoader_.playlist(b,a.requestOptions_);a.mainSegmentLoader_.load();g=a.activeAudioGroup();g=g.filter(function(a){return a.enabled})[0];g||(a.mediaGroupChanged(),a.trigger("audioupdate"));a.setupSubtitles();a.tech_.trigger({type:"mediachange",bubbles:!0})});this.masterPlaylistLoader_.on("playlistunchanged",function(){var b=a.masterPlaylistLoader_.media();a.stuckAtPlaylistEnd_(b)&&(a.blacklistCurrentPlaylist({message:"Playlist no longer updating."}),a.tech_.trigger("playliststuck"))});this.masterPlaylistLoader_.on("renditiondisabled",function(){a.tech_.trigger({type:"usage",name:"hls-rendition-disabled"})});this.masterPlaylistLoader_.on("renditionenabled",function(){a.tech_.trigger({type:"usage",name:"hls-rendition-enabled"})})}},{key:"triggerPresenceUsage_",value:function(a,b){var c=a.mediaGroups||{},g=!0,m=Object.keys(c.AUDIO),d;for(d in c.AUDIO)for(var t in c.AUDIO[d])c.AUDIO[d][t].uri||(g=!1);g&&this.tech_.trigger({type:"usage",name:"hls-demuxed"});Object.keys(c.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"hls-webvtt"});C.Playlist.isAes(b)&&this.tech_.trigger({type:"usage",name:"hls-aes"});C.Playlist.isFmp4(b)&&this.tech_.trigger({type:"usage",name:"hls-fmp4"});m.length&&1<Object.keys(c.AUDIO[m[0]]).length&&this.tech_.trigger({type:"usage",name:"hls-alternate-audio"});this.useCueTags_&&this.tech_.trigger({type:"usage",name:"hls-playlist-cue-tags"})}},{key:"setupSegmentLoaderListeners_",value:function(){var a=this;this.mainSegmentLoader_.on("bandwidthupdate",function(){var b=a.selectPlaylist(),c=a.masterPlaylistLoader_.media(),g=a.tech_.buffered(),g=g.length?g.end(g.length-1)-a.tech_.currentTime():0,d=a.bufferLowWaterLine();(!c.endList||a.duration()<m["default"].MAX_BUFFER_LOW_WATER_LINE||b.attributes.BANDWIDTH<c.attributes.BANDWIDTH||g>=d)&&a.masterPlaylistLoader_.media(b);a.tech_.trigger("bandwidthupdate")});this.mainSegmentLoader_.on("progress",function(){a.trigger("progress")});this.mainSegmentLoader_.on("error",function(){a.blacklistCurrentPlaylist(a.mainSegmentLoader_.error())});this.mainSegmentLoader_.on("syncinfoupdate",function(){a.onSyncInfoUpdate_()});this.mainSegmentLoader_.on("timestampoffset",function(){a.tech_.trigger({type:"usage",name:"hls-timestamp-offset"})});this.audioSegmentLoader_.on("syncinfoupdate",function(){a.onSyncInfoUpdate_()});this.mainSegmentLoader_.on("ended",function(){a.onEndOfStream()});this.audioSegmentLoader_.on("ended",function(){a.onEndOfStream()});this.audioSegmentLoader_.on("error",function(){t["default"].log.warn("Problem encountered with the current alternate audio track. Switching back to default.");a.audioSegmentLoader_.abort();a.audioPlaylistLoader_=null;a.setupAudio()});this.subtitleSegmentLoader_.on("error",this.handleSubtitleError_.bind(this))}},{key:"handleAudioinfoUpdate_",value:function(a){if(!C.supportsAudioInfoChange_()&&this.audioInfo_&&A(this.audioInfo_,a.info)){a="had different audio properties (channels, sample rate, etc.) or changed in some other way.  This behavior is currently unsupported in Firefox 48 and below due to an issue: \n\nhttps://bugzilla.mozilla.org/show_bug.cgi?id\x3d1247138\n\n";var b=this.activeAudioGroup().map(function(a){return a.enabled}).indexOf(!0),c=this.activeAudioGroup()[b],g=this.activeAudioGroup().filter(function(a){return a.properties_&&a.properties_["default"]})[0];this.audioPlaylistLoader_?(a="The audio track '"+c.label+"' that we tried to "+("switch to "+a+" Unfortunately this means we will have to ")+("return you to the main track '"+g.label+"'. Sorry!"),g.enabled=!0,this.activeAudioGroup().splice(b,1),this.trigger("audioupdate")):(a="The rendition that we tried to switch to "+a+"Unfortunately that means we will have to blacklist the current playlist and switch to another. Sorry!",this.blacklistCurrentPlaylist());t["default"].log.warn(a);this.setupAudio()}else this.audioInfo_=a.info}},{key:"mediaSecondsLoaded_",value:function(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}},{key:"fillAudioTracks_",value:function(){var a=this.master().mediaGroups||{};a&&a.AUDIO&&0!==Object.keys(a.AUDIO).length&&"html5"===this.mode_||(a.AUDIO={main:{"default":{"default":!0}}});for(var b in a.AUDIO){this.audioGroups_[b]||(this.audioGroups_[b]=[]);for(var c in a.AUDIO[b]){var g=a.AUDIO[b][c],m=new t["default"].AudioTrack({id:c,kind:this.audioTrackKind_(g),enabled:!1,language:g.language,label:c});m.properties_=g;this.audioGroups_[b].push(m)}}(this.activeAudioGroup().filter(function(a){return a.properties_["default"]})[0]||this.activeAudioGroup()[0]).enabled=!0}},{key:"audioTrackKind_",value:function(a){var b=a["default"]?"main":"alternative";a.characteristics&&0<=a.characteristics.indexOf("public.accessibility.describes-video")&&(b="main-desc");return b}},{key:"fillSubtitleTracks_",value:function(){var a=this.master().mediaGroups||{},b;for(b in a.SUBTITLES){this.subtitleGroups_.groups[b]||(this.subtitleGroups_.groups[b]=[]);for(var c in a.SUBTITLES[b]){var g=a.SUBTITLES[b][c];g.forced||(this.subtitleGroups_.groups[b].push(t["default"].mergeOptions({id:c},g)),"undefined"===typeof this.subtitleGroups_.tracks[c]&&(g=this.tech_.addRemoteTextTrack({id:c,kind:"subtitles",enabled:!1,language:g.language,label:c},!0).track,this.subtitleGroups_.tracks[c]=g))}}}},{key:"load",value:function(){this.mainSegmentLoader_.load();this.audioPlaylistLoader_&&this.audioSegmentLoader_.load();this.subtitlePlaylistLoader_&&this.subtitleSegmentLoader_.load()}},{key:"activeAudioGroup",value:function(){var a=this.masterPlaylistLoader_.media(),b=void 0;a.attributes&&a.attributes.AUDIO&&(b=this.audioGroups_[a.attributes.AUDIO]);return b||this.audioGroups_.main}},{key:"activeSubtitleGroup_",value:function(){var a=this.masterPlaylistLoader_.media(),b=void 0;if(!a)return null;a.attributes&&a.attributes.SUBTITLES&&(b=this.subtitleGroups_.groups[a.attributes.SUBTITLES]);return b||this.subtitleGroups_.groups.main}},{key:"activeSubtitleTrack_",value:function(){for(var a in this.subtitleGroups_.tracks)if("showing"===this.subtitleGroups_.tracks[a].mode)return this.subtitleGroups_.tracks[a];return null}},{key:"handleSubtitleError_",value:function(){t["default"].log.warn("Problem encountered loading the subtitle track. Switching back to default.");this.subtitleSegmentLoader_.abort();var a=this.activeSubtitleTrack_();a&&(a.mode="disabled");this.setupSubtitles()}},{key:"mediaGroupChanged",value:function(){var a=this.getActiveAudioTrack_();this.stopAudioLoaders_();this.resyncAudioLoaders_(a)}},{key:"setupAudio",value:function(){var a=this.getActiveAudioTrack_();this.stopAudioLoaders_();this.resetAudioLoaders_(a)}},{key:"getActiveAudioTrack_",value:function(){var a=this.activeAudioGroup(),b=a.filter(function(a){return a.enabled})[0];b||(b=a.filter(function(a){return a.properties_["default"]})[0]||a[0],b.enabled=!0);return b}},{key:"stopAudioLoaders_",value:function(){this.audioPlaylistLoader_&&(this.audioPlaylistLoader_.dispose(),this.audioPlaylistLoader_=null);this.audioSegmentLoader_.pause()}},{key:"resetAudioLoaders_",value:function(a){a.properties_.resolvedUri?(this.audioSegmentLoader_.resetEverything(),this.setupAudioPlaylistLoader_(a)):this.mainSegmentLoader_.resetEverything()}},{key:"resyncAudioLoaders_",value:function(a){a.properties_.resolvedUri&&(this.audioSegmentLoader_.resyncLoader(),this.setupAudioPlaylistLoader_(a))}},{key:"setupAudioPlaylistLoader_",value:function(b){var c=this;this.audioPlaylistLoader_=new a["default"](b.properties_.resolvedUri,this.hls_,this.withCredentials);this.audioPlaylistLoader_.load();this.audioPlaylistLoader_.on("loadedmetadata",function(){var a=c.audioPlaylistLoader_.media();c.audioSegmentLoader_.playlist(a,c.requestOptions_);(!c.tech_.paused()||a.endList&&"none"!==c.tech_.preload())&&c.audioSegmentLoader_.load();a.endList||c.audioPlaylistLoader_.trigger("firstplay")});this.audioPlaylistLoader_.on("loadedplaylist",function(){var a=void 0;c.audioPlaylistLoader_&&(a=c.audioPlaylistLoader_.media());a?c.audioSegmentLoader_.playlist(a,c.requestOptions_):c.audioPlaylistLoader_.media(c.audioPlaylistLoader_.playlists.master.playlists[0])});this.audioPlaylistLoader_.on("error",function(){t["default"].log.warn("Problem encountered loading the alternate audio track. Switching back to default.");c.audioSegmentLoader_.abort();c.setupAudio()})}},{key:"setupSubtitles",value:function(){var b=this,c=this.activeSubtitleGroup_(),g=this.activeSubtitleTrack_();this.subtitleSegmentLoader_.pause();g?(c=c.filter(function(a){return a.id===g.id})[0],this.subtitlePlaylistLoader_&&this.subtitlePlaylistLoader_.media()&&this.subtitlePlaylistLoader_.media().resolvedUri===c.resolvedUri||(this.subtitlePlaylistLoader_&&this.subtitlePlaylistLoader_.dispose(),this.subtitleSegmentLoader_.resetEverything(),this.subtitlePlaylistLoader_=new a["default"](c.resolvedUri,this.hls_,this.withCredentials),this.subtitlePlaylistLoader_.on("loadedmetadata",function(){var a=b.subtitlePlaylistLoader_.media();b.subtitleSegmentLoader_.playlist(a,b.requestOptions_);b.subtitleSegmentLoader_.track(b.activeSubtitleTrack_());(!b.tech_.paused()||a.endList&&"none"!==b.tech_.preload())&&b.subtitleSegmentLoader_.load()}),this.subtitlePlaylistLoader_.on("loadedplaylist",function(){var a=void 0;b.subtitlePlaylistLoader_&&(a=b.subtitlePlaylistLoader_.media());a&&b.subtitleSegmentLoader_.playlist(a,b.requestOptions_)}),this.subtitlePlaylistLoader_.on("error",this.handleSubtitleError_.bind(this))),this.subtitlePlaylistLoader_.media()&&this.subtitlePlaylistLoader_.media().resolvedUri===c.resolvedUri?this.subtitleSegmentLoader_.load():this.subtitlePlaylistLoader_.load()):this.subtitlePlaylistLoader_&&(this.subtitlePlaylistLoader_.dispose(),this.subtitlePlaylistLoader_=null)}},{key:"fastQualityChange_",value:function(){var a=this.selectPlaylist();a!==this.masterPlaylistLoader_.media()&&(this.masterPlaylistLoader_.media(a),this.mainSegmentLoader_.resetLoader())}},{key:"play",value:function(){if(!this.setupFirstPlay()){this.tech_.ended()&&this.tech_.setCurrentTime(0);this.hasPlayed_()&&this.load();var a=this.tech_.seekable();if(Infinity===this.tech_.duration()&&this.tech_.currentTime()<a.start(0))return this.tech_.setCurrentTime(a.end(a.length-1))}}},{key:"setupFirstPlay",value:function(){var a=void 0;return!(a=this.masterPlaylistLoader_.media())||this.tech_.paused()||this.hasPlayed_()?!1:(a.endList||(this.trigger("firstplay"),a=this.seekable(),a.length&&this.tech_.setCurrentTime(a.end(0))),this.hasPlayed_=function(){return!0},this.load(),!0)}},{key:"handleSourceOpen_",value:function(){try{this.setupSourceBuffers_()}catch(I){return t["default"].log.warn("Failed to create Source Buffers",I),this.mediaSource.endOfStream("decode")}this.tech_.autoplay()&&this.tech_.play();this.trigger("sourceopen")}},{key:"onEndOfStream",value:function(){var a=this.mainSegmentLoader_.ended_;this.audioPlaylistLoader_&&(a=a&&this.audioSegmentLoader_.ended_);a&&this.mediaSource.endOfStream()}},{key:"stuckAtPlaylistEnd_",value:function(a){if(!this.seekable().length)return!1;var b=this.syncController_.getExpiredTime(a,this.mediaSource.duration);if(null===b)return!1;a=C.Playlist.playlistEnd(a,b);var b=this.tech_.currentTime(),c=this.tech_.buffered();if(!c.length)return a-b<=u["default"].TIME_FUDGE_FACTOR;c=c.end(c.length-1);return c-b<=u["default"].TIME_FUDGE_FACTOR&&a-c<=u["default"].TIME_FUDGE_FACTOR}},{key:"blacklistCurrentPlaylist",value:function(){var a=0>=arguments.length||void 0===arguments[0]?{}:arguments[0],b;b=a.playlist||this.masterPlaylistLoader_.media();if(!b){this.error=a;try{return this.mediaSource.endOfStream("network")}catch(J){return this.trigger("error")}}var c=this.masterPlaylistLoader_.isFinalRendition_();if(c)return t["default"].log.warn("Problem encountered with the current HLS playlist. Trying again since it is the final playlist."),this.tech_.trigger("retryplaylist"),this.masterPlaylistLoader_.load(c);b.excludeUntil=Date.now()+1E3*this.blacklistDuration;this.tech_.trigger("blacklistplaylist");this.tech_.trigger({type:"usage",name:"hls-rendition-blacklisted"});b=this.selectPlaylist();t["default"].log.warn("Problem encountered with the current HLS playlist."+(a.message?" "+a.message:"")+" Switching to another playlist.");return this.masterPlaylistLoader_.media(b)}},{key:"pauseLoading",value:function(){this.mainSegmentLoader_.pause();this.audioPlaylistLoader_&&this.audioSegmentLoader_.pause();this.subtitlePlaylistLoader_&&this.subtitleSegmentLoader_.pause()}},{key:"setCurrentTime",value:function(a){var b=u["default"].findRange(this.tech_.buffered(),a);if(!this.masterPlaylistLoader_||!this.masterPlaylistLoader_.media()||!this.masterPlaylistLoader_.media().segments)return 0;var c="flash"===this.mode_||"auto"===this.mode_&&!t["default"].MediaSource.supportsNativeMediaSources();if(b&&b.length&&!c)return a;this.mainSegmentLoader_.resetEverything();this.mainSegmentLoader_.abort();this.audioPlaylistLoader_&&(this.audioSegmentLoader_.resetEverything(),this.audioSegmentLoader_.abort());this.subtitlePlaylistLoader_&&(this.subtitleSegmentLoader_.resetEverything(),this.subtitleSegmentLoader_.abort());this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioPlaylistLoader_&&this.audioSegmentLoader_.load(),this.subtitlePlaylistLoader_&&this.subtitleSegmentLoader_.load())}},{key:"duration",value:function(){return this.masterPlaylistLoader_?this.mediaSource?this.mediaSource.duration:C.Playlist.duration(this.masterPlaylistLoader_.media()):0}},{key:"seekable",value:function(){return this.seekable_}},{key:"onSyncInfoUpdate_",value:function(){var a,b=void 0;if(this.masterPlaylistLoader_){var c=this.masterPlaylistLoader_.media();if(c){var g=this.syncController_.getExpiredTime(c,this.mediaSource.duration);if(null!==g&&(a=C.Playlist.seekable(c,g),0!==a.length)){if(this.audioPlaylistLoader_){c=this.audioPlaylistLoader_.media();g=this.syncController_.getExpiredTime(c,this.mediaSource.duration);if(null===g)return;b=C.Playlist.seekable(c,g);if(0===b.length)return}b?b.start(0)>a.end(0)||a.start(0)>b.end(0)?this.seekable_=a:this.seekable_=t["default"].createTimeRanges([[b.start(0)>a.start(0)?b.start(0):a.start(0),b.end(0)<a.end(0)?b.end(0):a.end(0)]]):this.seekable_=a;this.tech_.trigger("seekablechanged")}}}}},{key:"updateDuration",value:function(){var a=this,b=this.mediaSource.duration,c=C.Playlist.duration(this.masterPlaylistLoader_.media()),g=this.tech_.buffered(),m=function L(){a.mediaSource.duration=c;a.tech_.trigger("durationchange");a.mediaSource.removeEventListener("sourceopen",L)};0<g.length&&(c=Math.max(c,g.end(g.length-1)));b!==c&&("open"!==this.mediaSource.readyState?this.mediaSource.addEventListener("sourceopen",m):m())}},{key:"dispose",value:function(){this.decrypter_.terminate();this.masterPlaylistLoader_.dispose();this.mainSegmentLoader_.dispose();this.audioPlaylistLoader_&&this.audioPlaylistLoader_.dispose();this.subtitlePlaylistLoader_&&this.subtitlePlaylistLoader_.dispose();this.audioSegmentLoader_.dispose();this.subtitleSegmentLoader_.dispose()}},{key:"master",value:function(){return this.masterPlaylistLoader_.master}},{key:"media",value:function(){return this.masterPlaylistLoader_.media()||this.initialMedia_}},{key:"setupSourceBuffers_",value:function(){var a=this.masterPlaylistLoader_.media(),b;if(a&&"open"===this.mediaSource.readyState){b=G(this.masterPlaylistLoader_.master,a);if(1>b.length)return this.error="No compatible SourceBuffer configuration for the variant stream:"+a.resolvedUri,this.mediaSource.endOfStream("decode");this.mainSegmentLoader_.mimeType(b[0]);b[1]&&this.audioSegmentLoader_.mimeType(b[1]);this.excludeIncompatibleVariants_(a)}}},{key:"excludeIncompatibleVariants_",value:function(a){var b=this.masterPlaylistLoader_.master,c=2,g=null,m=void 0;a.attributes&&a.attributes.CODECS&&(m=E(a.attributes.CODECS),g=m.videoCodec,c=m.codecCount);b.playlists.forEach(function(a){var b={codecCount:2,videoCodec:null};if(a.attributes&&a.attributes.CODECS){var m=a.attributes.CODECS,b=E(m);window.MediaSource&&window.MediaSource.isTypeSupported&&!window.MediaSource.isTypeSupported('video/mp4; codecs\x3d"'+q(m)+'"')&&(a.excludeUntil=Infinity)}b.codecCount!==c&&(a.excludeUntil=Infinity);b.videoCodec!==g&&(a.excludeUntil=Infinity)})}},{key:"updateAdCues_",value:function(a){var b=0,c=this.seekable();c.length&&(b=c.start(0));v["default"].updateAdCues(a,this.cueTagsTrack_,b)}},{key:"goalBufferLength",value:function(){var a=this.tech_.currentTime(),b=m["default"].GOAL_BUFFER_LENGTH;return Math.min(b+a*m["default"].GOAL_BUFFER_LENGTH_RATE,Math.max(b,m["default"].MAX_GOAL_BUFFER_LENGTH))}},{key:"bufferLowWaterLine",value:function(){var a=this.tech_.currentTime(),b=m["default"].BUFFER_LOW_WATER_LINE;return Math.min(b+a*m["default"].BUFFER_LOW_WATER_LINE_RATE,Math.max(b,m["default"].MAX_BUFFER_LOW_WATER_LINE))}}]);return p}(t["default"].EventTarget);l.MasterPlaylistController=e}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./ad-cue-tags":1,"./config":3,"./decrypter-worker":4,"./playlist-loader":8,"./ranges":11,"./segment-loader":15,"./sync-controller":17,"./vtt-segment-loader":18,"videojs-contrib-media-sources/es5/codec-utils":64,webworkify:75}],6:[function(k,q,l){(function(e){Object.defineProperty(l,"__esModule",{value:!0});var h=(e="undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null)&&e.__esModule?e:{"default":e},n=k("./bin-utils"),f={FAILURE:2,TIMEOUT:-101,ABORTED:-102};l.REQUEST_ERRORS=f;var d=function(a){var b={};a.byterange&&(a=a.byterange,b.Range="bytes\x3d"+a.offset+"-"+(a.offset+a.length-1));return b},b=function(a){a.forEach(function(a){a.abort()})},a=function(a){var b=a.target,b=Date.now()-b.requestTime,b={bandwidth:Infinity,bytesReceived:0,roundTripTime:b||0};b.bytesReceived=a.loaded;b.bandwidth=Math.floor(b.bytesReceived/b.roundTripTime*8E3);return b},c=function(a,b){return b.timedout?{status:b.status,message:"HLS request timed-out at URL: "+b.uri,code:f.TIMEOUT,xhr:b}:b.aborted?{status:b.status,message:"HLS request aborted at URL: "+b.uri,code:f.ABORTED,xhr:b}:a?{status:b.status,message:"HLS request errored at URL: "+b.uri,code:f.FAILURE,xhr:b}:null},r=function(a,b){return function(g,m){var d=m.response,t=c(g,m);if(t)return b(t,a);if(16!==d.byteLength)return b({status:m.status,message:"Invalid HLS key at URL: "+m.uri,code:f.FAILURE,xhr:m},a);d=new DataView(d);a.key.bytes=new Uint32Array([d.getUint32(0),d.getUint32(4),d.getUint32(8),d.getUint32(12)]);return b(null,a)}},u=function(a,b){return function(g,m){var d=m.response,t=c(g,m);if(t)return b(t,a);if(0===d.byteLength)return b({status:m.status,message:"Empty HLS segment content at URL: "+m.uri,code:f.FAILURE,xhr:m},a);a.map.bytes=new Uint8Array(m.response);return b(null,a)}},t=function(a,b){return function(g,m){var d=m.response,t=c(g,m),p=[98,111,115,115,105,101,110,95,101,110,99,114,121,112,116];if(t)return b(t,a);if(0===d.byteLength)return b({status:m.status,message:"Empty HLS segment content at URL: "+m.uri,code:f.FAILURE,xhr:m},a);a.stats={bandwidth:m.bandwidth,bytesReceived:m.bytesReceived||0,roundTripTime:m.roundTripTime||0};if(a.key)a.encryptedBytes=new Uint8Array(m.response);else{a.bytes=new Uint8Array(m.response);d=new Uint8Array(m.response,0,15);a:if(d.length===p.length){for(t=0;t<d.length;++t)if(d[t]!=p[t]){p=!1;break a}p=!0}else p=!1;if(p&&2==(new Uint8Array(m.response,15,2))[1])for(p=19;p<a.bytes.length;++p)a.bytes[p]^=d[0]/2-1}return b(null,a)}},v=function(a,b,c){a.addEventListener("message",function z(g){if(g.data.source===b.requestId)return a.removeEventListener("message",z),g=g.data.decrypted,b.bytes=new Uint8Array(g.bytes,g.byteOffset,g.byteLength),c(null,b)});a.postMessage((0,n.createTransferableMessage)({source:b.requestId,encrypted:b.encryptedBytes,key:b.key.bytes,iv:b.key.iv}),[b.encryptedBytes.buffer,b.key.bytes.buffer])},g=function(a){return a.reduce(function(a,b){return b.code>a.code?b:a})},p=function(a,c,d){var m=[],t=0;return function(p,r){p&&(b(a),m.push(p));t+=1;if(t===a.length){r.endOfAllRequests=Date.now();if(0<m.length){var f=g(m);return d(f,r)}return r.encryptedBytes?v(c,r,d):d(null,r)}}},x=function(b,c){return function(g){b.stats=h["default"].mergeOptions(b.stats,a(g));!b.stats.firstBytesReceivedAt&&b.stats.bytesReceived&&(b.stats.firstBytesReceivedAt=Date.now());return c(g,b)}};l.mediaSegmentRequest=function(a,c,g,f,v,e){var m=[];g=p(m,g,e);if(f.key){e=h["default"].mergeOptions(c,{uri:f.key.resolvedUri,responseType:"arraybuffer"});var n=r(f,g);e=a(e,n);m.push(e)}f.map&&!f.map.bytes&&(e=h["default"].mergeOptions(c,{uri:f.map.resolvedUri,responseType:"arraybuffer",headers:d(f.map)}),n=u(f,g),e=a(e,n),m.push(e));c=h["default"].mergeOptions(c,{uri:f.resolvedUri,responseType:"arraybuffer",headers:d(f)});g=t(f,g);a=a(c,g);a.addEventListener("progress",x(f,v));m.push(a);return function(){return b(m)}}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./bin-utils":2}],7:[function(k,q,l){(function(e){function h(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(l,"__esModule",{value:!0});var n=function(){function a(a,b){for(var c=0;c<b.length;c++){var g=b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),f=k("global/window"),d=h(f),f=k("./ranges"),b=h(f),a=h("undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null),c=["seeking","seeked","pause","playing","error"];e=function(){function f(b){var t=this;if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");this.tech_=b.tech;this.seekable=b.seekable;this.consecutiveUpdates=0;this.checkCurrentTimeTimeout_=this.timer_=this.lastRecordedTime=null;b.debug&&(this.logger_=a["default"].log.bind(a["default"],"playback-watcher -\x3e"));this.logger_("initialize");var r=function(){return t.techWaiting_()},g=function(){return t.cancelTimer_()},p=function(){return t.fixesBadSeeks_()};this.tech_.on("seekablechanged",p);this.tech_.on("waiting",r);this.tech_.on(c,g);this.monitorCurrentTime_();this.dispose=function(){t.logger_("dispose");t.tech_.off("seekablechanged",p);t.tech_.off("waiting",r);t.tech_.off(c,g);t.checkCurrentTimeTimeout_&&d["default"].clearTimeout(t.checkCurrentTimeTimeout_);t.cancelTimer_()}}n(f,[{key:"monitorCurrentTime_",value:function(){this.checkCurrentTime_();this.checkCurrentTimeTimeout_&&d["default"].clearTimeout(this.checkCurrentTimeTimeout_);this.checkCurrentTimeTimeout_=d["default"].setTimeout(this.monitorCurrentTime_.bind(this),250)}},{key:"checkCurrentTime_",value:function(){if(this.tech_.seeking()&&this.fixesBadSeeks_())this.consecutiveUpdates=0,this.lastRecordedTime=this.tech_.currentTime();else if(!this.tech_.paused()&&!this.tech_.seeking()){var a=this.tech_.currentTime(),b=this.tech_.buffered();if(this.lastRecordedTime===a&&(!b.length||a+.1>=b.end(b.length-1)))return this.techWaiting_();5<=this.consecutiveUpdates&&a===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):a===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=a)}}},{key:"cancelTimer_",value:function(){this.consecutiveUpdates=0;this.timer_&&(this.logger_("cancelTimer_"),clearTimeout(this.timer_));this.timer_=null}},{key:"fixesBadSeeks_",value:function(){var a=this.seekable(),c=this.tech_.currentTime();if(this.tech_.seeking()&&this.outsideOfSeekableWindow_(a,c)){var d=a.end(a.length-1);this.logger_("Trying to seek outside of seekable at time "+c+" with "+("seekable range "+b["default"].printableRange(a)+". Seeking to ")+(d+"."));this.tech_.setCurrentTime(d);return!0}return!1}},{key:"waiting_",value:function(){if(!this.techWaiting_()){var a=this.tech_.currentTime(),c=this.tech_.buffered(),c=b["default"].findRange(c,a);c.length&&a+3<=c.end(0)&&(this.cancelTimer_(),this.tech_.setCurrentTime(a),this.logger_("Stopped at "+a+" while inside a buffered region "+("["+c.start(0)+" -\x3e "+c.end(0)+"]. Attempting to resume ")+"playback by seeking to the current time."),this.tech_.trigger({type:"usage",name:"hls-unknown-waiting"}))}}},{key:"techWaiting_",value:function(){var a=this.seekable(),c=this.tech_.currentTime();if(this.tech_.seeking()&&this.fixesBadSeeks_()||this.tech_.seeking()||null!==this.timer_)return!0;if(this.fellOutOfLiveWindow_(a,c))return a=a.end(a.length-1),this.logger_("Fell out of live window at time "+c+". Seeking to "+("live point (seekable end) "+a)),this.cancelTimer_(),this.tech_.setCurrentTime(a),this.tech_.trigger({type:"usage",name:"hls-live-resync"}),!0;var d=this.tech_.buffered(),a=b["default"].findNextRange(d,c);return this.videoUnderflow_(a,d,c)?(this.cancelTimer_(),this.tech_.setCurrentTime(c),this.tech_.trigger({type:"usage",name:"hls-video-underflow"}),!0):0<a.length?(d=a.start(0)-c,this.logger_("Stopped at "+c+", setting timer for "+d+", seeking "+("to "+a.start(0))),this.timer_=setTimeout(this.skipTheGap_.bind(this),1E3*d,c),!0):!1}},{key:"outsideOfSeekableWindow_",value:function(a,b){return a.length?b<a.start(0)-.1||b>a.end(a.length-1)+.1?!0:!1:!1}},{key:"fellOutOfLiveWindow_",value:function(a,b){return a.length&&0<a.start(0)&&b<a.start(0)?!0:!1}},{key:"videoUnderflow_",value:function(a,b,c){return 0===a.length&&(a=this.gapFromVideoUnderflow_(b,c))?(this.logger_("Encountered a gap in video from "+a.start+" to "+a.end+". "+("Seeking to current time "+c)),!0):!1}},{key:"skipTheGap_",value:function(a){var c=this.tech_.buffered(),d=this.tech_.currentTime(),c=b["default"].findNextRange(c,d);this.cancelTimer_();0!==c.length&&d===a&&(this.logger_("skipTheGap_:","currentTime:",d,"scheduled currentTime:",a,"nextRange start:",c.start(0)),this.tech_.setCurrentTime(c.start(0)+b["default"].TIME_FUDGE_FACTOR),this.tech_.trigger({type:"usage",name:"hls-gap-skip"}))}},{key:"gapFromVideoUnderflow_",value:function(a,c){for(var d=b["default"].findGaps(a),g=0;g<d.length;g++){var p=d.start(g),f=d.end(g);if(4>c-p&&2<c-p)return{start:p,end:f}}return null}},{key:"logger_",value:function(){}}]);return f}();l["default"]=e;q.exports=l["default"]}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./ranges":11,"global/window":27}],8:[function(k,q,l){(function(e){function h(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(l,"__esModule",{value:!0});var n=k("./resolve-url"),f=h(n),d="undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null,b=h(d),a=k("./playlist.js");e=k("m3u8-parser");var c=h(e);e=k("global/window");var r=h(e),u=function(a,b){for(var c=!1,p=(0,d.mergeOptions)(a,{}),r=a.playlists.length,t,m;r--;)if(t=p.playlists[r],!(t.uri!==b.uri||t.segments&&b.segments&&t.segments.length===b.segments.length&&t.mediaSequence===b.mediaSequence)){p.playlists[r]=(0,d.mergeOptions)(t,b);p.playlists[b.uri]=p.playlists[r];if(t.segments){c=p.playlists[r];m=t.segments;var e=b.segments,h=b.mediaSequence-t.mediaSequence,n=e.slice(),v,h=h||0,e=Math.min(m.length,e.length+h);for(v=h;v<e;v++)n[v-h]=(0,d.mergeOptions)(m[v],n[v-h]);c.segments=n}m=0;p.playlists[r].segments&&(m=p.playlists[r].segments.length);for(;m--;)c=p.playlists[r].segments[m],c.resolvedUri||(c.resolvedUri=(0,f["default"])(t.resolvedUri,c.uri)),c.key&&!c.key.resolvedUri&&(c.key.resolvedUri=(0,f["default"])(t.resolvedUri,c.key.uri)),c.map&&!c.map.resolvedUri&&(c.map.resolvedUri=(0,f["default"])(t.resolvedUri,c.map.uri));c=!0}return c?p:null};e=function v(g,d,e){var p=this,m=this,h=void 0,n=void 0,z=void 0,B=void 0,x=!1;v.prototype.constructor.call(this);this.hls_=d;if(!g)throw Error("A non-empty playlist URL is required");z=function(a,b,c){m.setBandwidth(n||a);n=null;c&&(m.state=c);m.error={playlist:m.master.playlists[b],status:a.status,message:"HLS playlist request error at URL: "+b,responseText:a.responseText,code:500<=a.status?4:2};m.trigger("error")};B=function(a,b){var g=void 0,d=void 0,p=void 0;m.setBandwidth(n||a);n=null;m.state="HAVE_METADATA";g=new c["default"].Parser;g.push(a.responseText);g.end();g.manifest.uri=b;p=u(m.master,g.manifest);d=1E3*(g.manifest.targetDuration||10);m.targetDuration=g.manifest.targetDuration;p?(m.master=p,m.media_=m.master.playlists[g.manifest.uri]):(d/=2,m.trigger("playlistunchanged"));m.media().endList||(r["default"].clearTimeout(h),h=r["default"].setTimeout(function(){m.trigger("mediaupdatetimeout")},d));m.trigger("loadedplaylist")};m.state="HAVE_NOTHING";m.dispose=function(){m.stopRequest();r["default"].clearTimeout(h);m.off()};m.stopRequest=function(){if(n){var a=n;n=null;a.onreadystatechange=null;a.abort()}};m.enabledPlaylists_=function(){return m.master.playlists.filter(a.isEnabled).length};m.isLowestEnabledRendition_=function(){if(1===m.master.playlists.length)return!0;var b=m.media().attributes.BANDWIDTH||Number.MAX_VALUE;return 0===m.master.playlists.filter(function(c){if(!(0,a.isEnabled)(c))return!1;var g=0;c&&c.attributes&&(g=c.attributes.BANDWIDTH);return g<b}).length};m.isFinalRendition_=function(){return 1===m.master.playlists.filter(a.isEnabled).length};m.media=function(a){var b=m.state,c=void 0;if(!a)return m.media_;if("HAVE_NOTHING"===m.state)throw Error("Cannot switch media playlist from "+m.state);if("string"===typeof a){if(!m.master.playlists[a])throw Error("Unknown playlist URI: "+a);a=m.master.playlists[a]}c=!m.media_||a.uri!==m.media_.uri;if(m.master.playlists[a.uri].endList)n&&(n.onreadystatechange=null,n.abort(),n=null),m.state="HAVE_METADATA",m.media_=a,c&&(m.trigger("mediachanging"),m.trigger("mediachange"));else if(c){m.state="SWITCHING_MEDIA";if(n){if(a.resolvedUri===n.url)return;n.onreadystatechange=null;n.abort();n=null}this.media_&&this.trigger("mediachanging");n=this.hls_.xhr({uri:a.resolvedUri,withCredentials:e},function(c,g){if(n){g.responseURL&&a.resolvedUri!==g.responseURL&&(a.resolvedUri=g.responseURL);if(c)return z(n,a.uri,b);B(g,a.uri);"HAVE_MASTER"===b?m.trigger("loadedmetadata"):m.trigger("mediachange")}})}};m.setBandwidth=function(a){m.bandwidth=a.bandwidth};m.on("mediaupdatetimeout",function(){"HAVE_METADATA"===m.state&&(m.state="HAVE_CURRENT_METADATA",n=this.hls_.xhr({uri:m.media().resolvedUri,withCredentials:e},function(a,b){if(n){if(a)return z(n,m.media().uri,"HAVE_METADATA");B(n,m.media().uri)}}))});m.on("firstplay",function(){var a=m.media();a&&(a.syncInfo={mediaSequence:a.mediaSequence,time:0})});m.pause=function(){m.stopRequest();r["default"].clearTimeout(h);"HAVE_NOTHING"===m.state&&(m.started=!1)};m.load=function(a){var b=m.media();r["default"].clearTimeout(h);a?(a=b?b.targetDuration/2*1E3:5E3,h=r["default"].setTimeout(m.load.bind(null,!1),a)):m.started?b&&!b.endList?m.trigger("mediaupdatetimeout"):m.trigger("loadedplaylist"):m.start()};m.start=function(){m.started=!0;n=p.hls_.xhr({uri:g,withCredentials:e},function(a,d){var p=void 0,e=void 0,h=void 0;if(n){n=null;if(a)return m.error={status:d.status,message:"HLS playlist request error at URL: "+g,responseText:d.responseText,code:2},"HAVE_NOTHING"===m.state&&(m.started=!1),m.trigger("error");p=new c["default"].Parser;p.push(d.responseText);p.end();m.state="HAVE_MASTER";d.responseURL?g!==d.responseURL&&(g=d.responseURL):x||(x=!0,b["default"].log.warn("Current browser does not support redirects for playlist requests."),window.hlsSupportCallback(!1));p.manifest.uri=g;if(p.manifest.playlists){m.master=p.manifest;for(h=m.master.playlists.length;h--;)e=m.master.playlists[h],m.master.playlists[e.uri]=e,e.resolvedUri=(0,f["default"])(m.master.uri,e.uri);["AUDIO","SUBTITLES"].forEach(function(a){for(var b in m.master.mediaGroups[a])for(var c in m.master.mediaGroups[a][b]){var g=m.master.mediaGroups[a][b][c];g.uri&&(g.resolvedUri=(0,f["default"])(m.master.uri,g.uri))}});m.trigger("loadedplaylist");n||m.media(p.manifest.playlists[0])}else return m.master={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:r["default"].location.href,playlists:[{uri:g,resolvedUri:g}]},m.master.playlists[g]=m.master.playlists[0],B(d,g),m.trigger("loadedmetadata")}})}};e.prototype=new d.EventTarget;l["default"]=e;q.exports=l["default"]}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./playlist.js":10,"./resolve-url":14,"global/window":27,"m3u8-parser":28}],9:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});var e=(q=k("./config"))&&q.__esModule?q:{"default":q},h=(k=k("./playlist"))&&k.__esModule?k:{"default":k},n=function(a,b){var c;return a?(c=window.getComputedStyle(a))?c[b]:"":""},f=function(a,b){var c=a.slice();a.sort(function(a,d){var f=b(a,d);return 0===f?c.indexOf(a)-c.indexOf(d):f})},d=function(a,b){var c=void 0,d=void 0;a.attributes&&a.attributes.BANDWIDTH&&(c=a.attributes.BANDWIDTH);c=c||window.Number.MAX_VALUE;b.attributes&&b.attributes.BANDWIDTH&&(d=b.attributes.BANDWIDTH);d=d||window.Number.MAX_VALUE;return c-d};l.comparePlaylistBandwidth=d;l.comparePlaylistResolution=function(a,b){var c=void 0,d=void 0;a.attributes&&a.attributes.RESOLUTION&&a.attributes.RESOLUTION.width&&(c=a.attributes.RESOLUTION.width);c=c||window.Number.MAX_VALUE;b.attributes&&b.attributes.RESOLUTION&&b.attributes.RESOLUTION.width&&(d=b.attributes.RESOLUTION.width);d=d||window.Number.MAX_VALUE;return c===d&&a.attributes.BANDWIDTH&&b.attributes.BANDWIDTH?a.attributes.BANDWIDTH-b.attributes.BANDWIDTH:c-d};var b=function(a,b,d,n){a=a.playlists.map(function(a){var b=void 0,c=void 0,g=void 0;a.attributes&&(b=a.attributes.RESOLUTION&&a.attributes.RESOLUTION.width,c=a.attributes.RESOLUTION&&a.attributes.RESOLUTION.height,g=a.attributes.BANDWIDTH);g=g||window.Number.MAX_VALUE;return{bandwidth:g,width:b,height:c,playlist:a}});f(a,function(a,b){return a.bandwidth-b.bandwidth});a=a.filter(function(a){return h["default"].isEnabled(a.playlist)});var c=a.filter(function(a){return a.bandwidth*e["default"].BANDWIDTH_VARIANCE<b}),r=c[c.length-1],g=c.filter(function(a){return a.bandwidth===r.bandwidth})[0],c=c.filter(function(a){return a.width&&a.height});f(c,function(a,b){return a.width-b.width});var p=c.filter(function(a){return a.width===d&&a.height===n}),r=p[p.length-1],p=p.filter(function(a){return a.bandwidth===r.bandwidth})[0],x=void 0,w=void 0,w=void 0;p||(x=c.filter(function(a){return a.width>d||a.height>n}),w=x.filter(function(a){return a.width===x[0].width&&a.height===x[0].height}),r=w[w.length-1],w=w.filter(function(a){return a.bandwidth===r.bandwidth})[0]);return(w||p||g||a[0]).playlist};l.lastBandwidthSelector=function(){return b(this.playlists.master,this.systemBandwidth,parseInt(n(this.tech_.el(),"width"),10),parseInt(n(this.tech_.el(),"height"),10))};l.movingAverageBandwidthSelector=function(a){var c=-1;if(0>a||1<a)throw Error("Moving average bandwidth decay must be between 0 and 1.");return function(){0>c&&(c=this.systemBandwidth);c=a*this.systemBandwidth+(1-a)*c;return b(this.playlists.master,c,parseInt(n(this.tech_.el(),"width"),10),parseInt(n(this.tech_.el(),"height"),10))}};l.minRebufferMaxBandwidthSelector=function(a){var b=a.currentTime,r=a.bandwidth,e=a.duration,t=a.segmentDuration,n=a.timeUntilRebuffer,g=a.currentTimeline,p=a.syncController;a=a.master.playlists.filter(h["default"].hasAttribute.bind(null,"BANDWIDTH")).map(function(a){var c=p.getSyncPoint(a,e,g,b)?1:2,c=h["default"].estimateSegmentRequestTime(t,r,a)*c-n;return{playlist:a,rebufferingImpact:c}});var x=a.filter(function(a){return 0>=a.rebufferingImpact});f(x,function(a,b){return d(b.playlist,a.playlist)});if(x.length)return x[0];f(a,function(a,b){return a.rebufferingImpact-b.rebufferingImpact});return a[0]||null}},{"./config":3,"./playlist":10}],10:[function(k,q,l){(function(e){Object.defineProperty(l,"__esModule",{value:!0});var h="undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null,n=(e=k("global/window"))&&e.__esModule?e:{"default":e},f={UNSAFE_LIVE_SEGMENTS:3},d=function(a,b){var c=0,g=b-a.mediaSequence,d=a.segments[g];if(d){if("undefined"!==typeof d.start)return{result:d.start,precise:!0};if("undefined"!==typeof d.end)return{result:d.end-d.duration,precise:!0}}for(;g--;){d=a.segments[g];if("undefined"!==typeof d.end)return{result:c+d.end,precise:!0};c+=d.duration;if("undefined"!==typeof d.start)return{result:c+d.start,precise:!0}}return{result:c,precise:!1}},b=function(a,b,c){var g,p;"undefined"===typeof b&&(b=a.mediaSequence+a.segments.length);if(b<a.mediaSequence)return 0;p=d(a,b);if(p.precise)return p.result;a:{g=0;for(var f=b-a.mediaSequence;f<a.segments.length;f++){b=a.segments[f];if("undefined"!==typeof b.start){a=b.start-g;g=!0;break a}g+=b.duration;if("undefined"!==typeof b.end){a=b.end-g;g=!0;break a}}a=-1;g=!1}return g?a:p.result+c},a=function(a,c,g){if(!a)return 0;"number"!==typeof g&&(g=0);if("undefined"===typeof c){if(a.totalDuration)return a.totalDuration;if(!a.endList)return n["default"].Infinity}return b(a,c,g)};l.duration=a;var c=function(a,b,c){var g=0;b>c&&(c=[c,b],b=c[0],c=c[1]);if(0>b){for(;b<Math.min(0,c);b++)g+=a.targetDuration;b=0}for(;b<c;b++)g+=a.segments[b].duration;return g};l.sumDurations=c;var r=function(c,g,d){return c&&c.segments?c.endList?a(c):null===g?null:b(c,c.mediaSequence+(d?Math.max(0,c.segments.length-f.UNSAFE_LIVE_SEGMENTS):Math.max(0,c.segments.length)),g||0):null};l.playlistEnd=r;e=function(a,b){var c=b||0,g=r(a,b,!0);return null===g?(0,h.createTimeRange)():(0,h.createTimeRange)(c,g)};l.seekable=e;var u=function(a,b){if(0===b-Math.floor(b))return b+.1*a;for(var c=b.toString().split(".")[1].length,g=1;g<=c;g++){var d=Math.pow(10,g),p=b*d;if(0===p-Math.floor(p)||g===c)return(p+a)/d}},t=u.bind(null,1),v=u.bind(null,-1),u=function(a,b,g,d){var p,f,m=a.segments.length,r=b-d;if(0>r){if(0<g)for(p=g-1;0<=p;p--)if(f=a.segments[p],r+=v(f.duration),0<r)return{mediaIndex:p,startTime:d-c(a,g,p)};return{mediaIndex:0,startTime:b}}if(0>g){for(p=g;0>p;p++)if(r-=a.targetDuration,0>r)return{mediaIndex:0,startTime:b};g=0}for(p=g;p<m;p++)if(f=a.segments[p],r-=t(f.duration),0>r)return{mediaIndex:p,startTime:d+c(a,g,p)};return{mediaIndex:m-1,startTime:b}};l.getMediaInfoForTime=u;var g=function(a){return a.excludeUntil&&a.excludeUntil>Date.now()};l.isBlacklisted=g;var p=function(a){var b=g(a);return!a.disabled&&!b};l.isEnabled=p;var x=function(a){for(var b=0;b<a.segments.length;b++)if(a.segments[b].key)return!0;return!1};l.isAes=x;var w=function(a){for(var b=0;b<a.segments.length;b++)if(a.segments[b].map)return!0;return!1};l.isFmp4=w;var m=function(a,b){return b.attributes&&b.attributes[a]};l.hasAttribute=m;var C=function(a,b,c){var g=3>=arguments.length||void 0===arguments[3]?0:arguments[3];return m("BANDWIDTH",c)?(a*c.attributes.BANDWIDTH-8*g)/b:NaN};l.estimateSegmentRequestTime=C;f.duration=a;f.seekable=e;f.getMediaInfoForTime=u;f.isEnabled=p;f.isBlacklisted=g;f.playlistEnd=r;f.isAes=x;f.isFmp4=w;f.hasAttribute=m;f.estimateSegmentRequestTime=C;l["default"]=f}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"global/window":27}],11:[function(k,q,l){(function(e){Object.defineProperty(l,"__esModule",{value:!0});var h=function(){return function(a,b){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a)){var c=[],d=!0,f=!1,g=void 0;try{for(var p=a[Symbol.iterator](),r;!(d=(r=p.next()).done)&&(c.push(r.value),!b||c.length!==b);d=!0);}catch(w){f=!0,g=w}finally{try{if(!d&&p["return"])p["return"]()}finally{if(f)throw g;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),n=(e="undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null)&&e.__esModule?e:{"default":e},f=1/30,d=function(a,b){var c=h(b,2);return Math.min(Math.max(c[0],a),c[1])},b=function(a,b){var c=[],d;if(a&&a.length)for(d=0;d<a.length;d++)b(a.start(d),a.end(d))&&c.push([a.start(d),a.end(d)]);return n["default"].createTimeRanges(c)},a=function(a,b){var c=null,d=null,f=0,g=[],p=[];if(!(a&&a.length&&b&&b.length))return n["default"].createTimeRange();for(var r=a.length;r--;)g.push({time:a.start(r),type:"start"}),g.push({time:a.end(r),type:"end"});for(r=b.length;r--;)g.push({time:b.start(r),type:"start"}),g.push({time:b.end(r),type:"end"});g.sort(function(a,b){return a.time-b.time});for(r=0;r<g.length;r++)"start"===g[r].type?(f++,2===f&&(c=g[r].time)):"end"===g[r].type&&(f--,1===f&&(d=g[r].time)),null!==c&&null!==d&&(p.push([c,d]),d=c=null);return n["default"].createTimeRanges(p)};l["default"]={findRange:function(a,d){return b(a,function(a,b){return a-f<=d&&b+f>=d})},findNextRange:function(a,d){return b(a,function(a){return a-f>=d})},findGaps:function(a){if(2>a.length)return n["default"].createTimeRanges();for(var b=[],c=1;c<a.length;c++){var d=a.end(c-1),f=a.start(c);b.push([d,f])}return n["default"].createTimeRanges(b)},findSoleUncommonTimeRangesEnd:function(a,b){var c=void 0,d=void 0,f=void 0,g=[],p=[],r=function(a){return a[0]<=f&&a[1]>=f};if(a)for(c=0;c<a.length;c++)d=a.start(c),f=a.end(c),p.push([d,f]);if(b)for(c=0;c<b.length;c++)d=b.start(c),f=b.end(c),p.some(r)||g.push(f);return 1!==g.length?null:g[0]},getSegmentBufferedPercent:function(b,f,e,h){f=b+f;var c=n["default"].createTimeRanges([[b,f]]),g=n["default"].createTimeRanges([[d(b,[e,f]),f]]);if(g.start(0)===g.end(0))return 0;b=c.end(0)-c.start(0);f=g.end(0)-g.start(0);f=b-f;g=a(g,h);h=a(c,h);for(var p=c=0,r=g.length;r--;)c+=g.end(r)-g.start(r),g.start(r)===e&&(c+=f);for(r=h.length;r--;)p+=h.end(r)-h.start(r);e=Math.max(c,p)/b*100;return isNaN(e)||Infinity===e||-Infinity===e?0:e},TIME_FUDGE_FACTOR:f,printableRange:function(a){var b=[];if(!a||!a.length)return"";for(var c=0;c<a.length;c++)b.push(a.start(c)+" \x3d\x3e "+a.end(c));return b.join(", ")},timeUntilRebuffer:function(a,b){var c=2>=arguments.length||void 0===arguments[2]?1:arguments[2];return((a.length?a.end(a.length-1):0)-b)/c}};q.exports=l["default"]}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],12:[function(k,q,l){(function(e){Object.defineProperty(l,"__esModule",{value:!0});var h=(e="undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null)&&e.__esModule?e:{"default":e},n={errorInterval:30,getSource:function(d){var b=this.tech({IWillNotUseThisInPlugins:!0}).currentSource_;return d(b)}},f=function b(a,c){var f=0,e=0,t=h["default"].mergeOptions(n,c);a.ready(function(){a.trigger({type:"usage",name:"hls-error-reload-initialized"})});var v=function(){e&&a.currentTime(e)},g=function(b){null!==b&&void 0!==b&&(e=Infinity!==a.duration()&&a.currentTime()||0,a.one("loadedmetadata",v),a.src(b),a.trigger({type:"usage",name:"hls-error-reload"}),a.play())},p=function(){if(Date.now()-f<1E3*t.errorInterval)a.trigger({type:"usage",name:"hls-error-reload-canceled"});else{if(t.getSource&&"function"===typeof t.getSource)return f=Date.now(),t.getSource.call(a,g);h["default"].log.error("ERROR: reloadSourceOnError - The option getSource must be a function!")}},x=function m(){a.off("loadedmetadata",v);a.off("error",p);a.off("dispose",m)};a.on("error",p);a.on("dispose",x);a.reloadSourceOnError=function(c){x();b(a,c)}};l["default"]=function(b){f(this,b)};q.exports=l["default"]}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],13:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});var e=k("./playlist.js"),h=function(f,d,b,a){d=f.master.playlists[d];var c=(0,e.isBlacklisted)(d),r=(0,e.isEnabled)(d);if("undefined"===typeof a)return r;a?delete d.disabled:d.disabled=!0;a===r||c||(b(),a?f.trigger("renditionenabled"):f.trigger("renditiondisabled"));return a},n=function d(b,a,c){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");var r=b.masterPlaylistController_.fastQualityChange_.bind(b.masterPlaylistController_);if(a.attributes){var e=a.attributes;if(e.RESOLUTION){var n=e.RESOLUTION;this.width=n.width;this.height=n.height}this.bandwidth=e.BANDWIDTH}this.id=c;this.enabled=h.bind(this,b.playlists,a.uri,r)};l["default"]=function(d){var b=d.playlists;d.representations=function(){return b.master.playlists.filter(function(a){return!(0,e.isBlacklisted)(a)}).map(function(a,b){return new n(d,a,a.uri)})}};q.exports=l["default"]},{"./playlist.js":10}],14:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});var e=k("url-toolkit"),h=e&&e.__esModule?e:{"default":e},n=(k=k("global/window"))&&k.__esModule?k:{"default":k};l["default"]=function(f,d){if(/^[a-z]+:/i.test(d))return d;/\/\//i.test(f)||(f=h["default"].buildAbsoluteURL(n["default"].location.href,f));return h["default"].buildAbsoluteURL(f,d)};q.exports=l["default"]},{"global/window":27,"url-toolkit":61}],15:[function(k,q,l){(function(e){function h(a){return a&&a.__esModule?a:{"default":a}}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(l,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var g=b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,c,g){c&&a(b.prototype,c);g&&a(b,g);return b}}(),d=function(a,b,c){var g=!0;for(;g;)if(null===a&&(a=Function.prototype),g=Object.getOwnPropertyDescriptor(a,b),void 0===g){a=Object.getPrototypeOf(a);if(null===a)break;g=!0}else{if("value"in g)return g.value;b=g.get;return void 0===b?void 0:b.call(c)}},b=k("./playlist"),a=h(b),c=h("undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null);e=k("./source-updater");var r=h(e);e=k("./config");var u=h(e);e=k("global/window");var t=h(e);e=k("videojs-contrib-media-sources/es5/remove-cues-from-track.js");var v=h(e),g=k("./bin-utils"),p=k("./media-segment-request"),x=k("./ranges"),w=k("./playlist-selectors"),m=function(a,b,c){if(!a||!b)return!1;c=c===a.segments.length;return a.endList&&"open"===b.readyState&&c};e=function(b){function e(a){var b=this,g=1>=arguments.length||void 0===arguments[1]?{}:arguments[1];if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");d(Object.getPrototypeOf(e.prototype),"constructor",this).call(this);if(!a)throw new TypeError("Initialization settings are required");if("function"!==typeof a.currentTime)throw new TypeError("No currentTime getter specified");if(!a.mediaSource)throw new TypeError("No MediaSource specified");this.state="INIT";this.bandwidth=a.bandwidth;this.throughput={rate:0,count:0};this.roundTrip=NaN;this.resetStats_();this.mediaIndex=null;this.hasPlayed_=a.hasPlayed;this.currentTime_=a.currentTime;this.seekable_=a.seekable;this.seeking_=a.seeking;this.duration_=a.duration;this.mediaSource_=a.mediaSource;this.hls_=a.hls;this.loaderType_=a.loaderType;this.segmentMetadataTrack_=a.segmentMetadataTrack;this.goalBufferLength_=a.goalBufferLength;this.checkBufferTimeout_=null;this.error_=void 0;this.currentTimeline_=-1;this.activeInitSegmentId_=this.xhrOptions_=this.sourceUpdater_=this.mimeType_=this.pendingSegment_=null;this.initSegments_={};this.decrypter_=a.decrypter;this.syncController_=a.syncController;this.syncPoint_={segmentIndex:0,time:0};this.syncController_.on("syncinfoupdate",function(){return b.trigger("syncinfoupdate")});this.mediaSource_.addEventListener("sourceopen",function(){return b.ended_=!1});this.fetchAtBuffer_=!1;g.debug&&(this.logger_=c["default"].log.bind(c["default"],"segment-loader",this.loaderType_,"-\x3e"))}n(e,b);f(e,[{key:"resetStats_",value:function(){this.mediaSecondsLoaded=this.mediaTransferDuration=this.mediaRequestsErrored=this.mediaRequestsTimedout=this.mediaRequestsAborted=this.mediaRequests=this.mediaBytesTransferred=0}},{key:"dispose",value:function(){this.state="DISPOSED";this.pause();this.abort_();this.sourceUpdater_&&this.sourceUpdater_.dispose();this.resetStats_()}},{key:"abort",value:function(){"WAITING"!==this.state?this.pendingSegment_&&(this.pendingSegment_=null):(this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_())}},{key:"abort_",value:function(){this.pendingSegment_&&this.pendingSegment_.abortRequests();this.pendingSegment_=null}},{key:"error",value:function(a){"undefined"!==typeof a&&(this.error_=a);this.pendingSegment_=null;return this.error_}},{key:"endOfStream",value:function(){this.ended_=!0;this.pause();this.trigger("ended")}},{key:"buffered_",value:function(){return this.sourceUpdater_?this.sourceUpdater_.buffered():c["default"].createTimeRanges()}},{key:"initSegment",value:function(a){var b=1>=arguments.length||void 0===arguments[1]?!1:arguments[1];if(!a)return null;var c=(0,g.initSegmentId)(a),d=this.initSegments_[c];b&&!d&&a.bytes&&(this.initSegments_[c]=d={resolvedUri:a.resolvedUri,byterange:a.byterange,bytes:a.bytes});return d||a}},{key:"couldBeginLoading_",value:function(){return this.playlist_&&(this.sourceUpdater_||this.mimeType_&&"INIT"===this.state)&&!this.paused()}},{key:"load",value:function(){this.monitorBuffer_();if(this.playlist_){this.syncController_.setDateTimeMapping(this.playlist_);if("INIT"===this.state&&this.couldBeginLoading_())return this.init_();!this.couldBeginLoading_()||"READY"!==this.state&&"INIT"!==this.state||(this.state="READY")}}},{key:"init_",value:function(){this.state="READY";this.sourceUpdater_=new r["default"](this.mediaSource_,this.mimeType_);this.resetEverything();return this.monitorBuffer_()}},{key:"playlist",value:function(a){var b=1>=arguments.length||void 0===arguments[1]?{}:arguments[1];if(a){var c=this.playlist_,g=this.pendingSegment_;this.playlist_=a;this.xhrOptions_=b;this.hasPlayed_()||(a.syncInfo={mediaSequence:a.mediaSequence,time:0});this.trigger("syncinfoupdate");if("INIT"===this.state&&this.couldBeginLoading_())return this.init_();c&&c.uri===a.uri?(b=a.mediaSequence-c.mediaSequence,this.logger_("mediaSequenceDiff",b),null!==this.mediaIndex&&(this.mediaIndex-=b),g&&(g.mediaIndex-=b,0<=g.mediaIndex&&(g.segment=a.segments[g.mediaIndex])),this.syncController_.saveExpiredSegmentInfo(c,a)):null!==this.mediaIndex&&this.resyncLoader()}}},{key:"pause",value:function(){this.checkBufferTimeout_&&(t["default"].clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}},{key:"paused",value:function(){return null===this.checkBufferTimeout_}},{key:"mimeType",value:function(a){this.mimeType_||(this.mimeType_=a,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_())}},{key:"resetEverything",value:function(){this.ended_=!1;this.resetLoader();this.remove(0,Infinity)}},{key:"resetLoader",value:function(){this.fetchAtBuffer_=!1;this.resyncLoader()}},{key:"resyncLoader",value:function(){this.syncPoint_=this.mediaIndex=null;this.abort()}},{key:"remove",value:function(a,b){this.sourceUpdater_&&this.sourceUpdater_.remove(a,b);(0,v["default"])(a,b,this.segmentMetadataTrack_)}},{key:"monitorBuffer_",value:function(){this.checkBufferTimeout_&&t["default"].clearTimeout(this.checkBufferTimeout_);this.checkBufferTimeout_=t["default"].setTimeout(this.monitorBufferTick_.bind(this),1)}},{key:"monitorBufferTick_",value:function(){"READY"===this.state&&this.fillBuffer_();this.checkBufferTimeout_&&t["default"].clearTimeout(this.checkBufferTimeout_);this.checkBufferTimeout_=t["default"].setTimeout(this.monitorBufferTick_.bind(this),500)}},{key:"fillBuffer_",value:function(){if(!this.sourceUpdater_.updating()){this.syncPoint_||(this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_()));var a=this.checkBuffer_(this.buffered_(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_);if(a)if(m(this.playlist_,this.mediaSource_,a.mediaIndex))this.endOfStream();else if(a.mediaIndex!==this.playlist_.segments.length-1||"ended"!==this.mediaSource_.readyState||this.seeking_()){if(a.timeline!==this.currentTimeline_||null!==a.startOfSegment&&a.startOfSegment<this.sourceUpdater_.timestampOffset())this.syncController_.reset(),a.timestampOffset=a.startOfSegment;this.loadSegment_(a)}}}},{key:"checkBuffer_",value:function(b,c,g,d,f,p){var m=0;b.length&&(m=b.end(b.length-1));b=Math.max(0,m-f);if(!c.segments.length||b>=this.goalBufferLength_()||!d&&1<=b)return null;this.logger_("checkBuffer_","mediaIndex:",g,"hasPlayed:",d,"currentTime:",f,"syncPoint:",p,"fetchAtBuffer:",this.fetchAtBuffer_,"bufferedTime:",b);if(null===p)return g=this.getSyncSegmentCandidate_(c),this.logger_("getSync","mediaIndex:",g),this.generateSegmentInfo_(c,g,null,!0);if(null!==g)return this.logger_("walkForward","mediaIndex:",g+1),m=(d=c.segments[g])&&d.end?d.end:m,this.generateSegmentInfo_(c,g+1,m,!1);m=this.fetchAtBuffer_?a["default"].getMediaInfoForTime(c,m,p.segmentIndex,p.time):a["default"].getMediaInfoForTime(c,f,p.segmentIndex,p.time);g=m.mediaIndex;m=m.startTime;this.logger_("getMediaIndexForTime","mediaIndex:",g,"startOfSegment:",m);return this.generateSegmentInfo_(c,g,m,!1)}},{key:"getSyncSegmentCandidate_",value:function(a){var b=this;if(-1===this.currentTimeline_)return 0;var c=a.segments.map(function(a,b){return{timeline:a.timeline,segmentIndex:b}}).filter(function(a){return a.timeline===b.currentTimeline_});return c.length?c[Math.min(c.length-1,1)].segmentIndex:Math.max(a.segments.length-1,0)}},{key:"generateSegmentInfo_",value:function(a,b,c,g){if(0>b||b>=a.segments.length)return null;var d=a.segments[b];return{requestId:"segment-loader-"+Math.random(),uri:d.resolvedUri,mediaIndex:b,isSyncRequest:g,startOfSegment:c,playlist:a,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:d.timeline,duration:d.duration,segment:d}}},{key:"abortRequestEarly_",value:function(b){if(this.hls_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes||!this.playlist_.attributes.BANDWIDTH||1E3>Date.now()-(b.firstBytesReceivedAt||Date.now()))return!1;var c=this.currentTime_(),g=b.bandwidth,d=this.pendingSegment_.duration,p=a["default"].estimateSegmentRequestTime(d,g,this.playlist_,b.bytesReceived);b=(0,x.timeUntilRebuffer)(this.buffered_(),c,this.hls_.tech_.playbackRate())-1;if(p<=b)return!1;if(c=(0,w.minRebufferMaxBandwidthSelector)({master:this.hls_.playlists.master,currentTime:c,bandwidth:g,duration:this.duration_(),segmentDuration:d,timeUntilRebuffer:b,currentTimeline:this.currentTimeline_,syncController:this.syncController_})){g=p-b-c.rebufferingImpact;d=.5;b<=x.TIME_FUDGE_FACTOR&&(d=1);if(!c.playlist||c.playlist.uri===this.playlist_.uri||g<d)return!1;this.bandwidth=c.playlist.attributes.BANDWIDTH*u["default"].BANDWIDTH_VARIANCE+1;this.abort();this.trigger("bandwidthupdate");return!0}}},{key:"handleProgress_",value:function(a,b){this.pendingSegment_&&b.requestId===this.pendingSegment_.requestId&&!this.abortRequestEarly_(b.stats)&&this.trigger("progress")}},{key:"loadSegment_",value:function(a){this.state="WAITING";this.pendingSegment_=a;this.trimBackBuffer_(a);a.abortRequests=(0,p.mediaSegmentRequest)(this.hls_.xhr,this.xhrOptions_,this.decrypter_,this.createSimplifiedSegmentObj_(a),this.handleProgress_.bind(this),this.segmentRequestFinished_.bind(this))}},{key:"trimBackBuffer_",value:function(a){a=this.seekable_();var b=this.currentTime_();a=a.length&&0<a.start(0)&&a.start(0)<b?a.start(0):b-30;0<a&&this.remove(0,a)}},{key:"createSimplifiedSegmentObj_",value:function(a){var b=a.segment,c={resolvedUri:b.resolvedUri,byterange:b.byterange,requestId:a.requestId};b.key&&(a=b.key.iv||new Uint32Array([0,0,0,a.mediaIndex+a.playlist.mediaSequence]),c.key={resolvedUri:b.key.resolvedUri,iv:a});b.map&&(c.map=this.initSegment(b.map));return c}},{key:"segmentRequestFinished_",value:function(a,b){this.mediaRequests+=1;b.stats&&(this.mediaBytesTransferred+=b.stats.bytesReceived,this.mediaTransferDuration+=b.stats.roundTripTime);this.pendingSegment_?b.requestId===this.pendingSegment_.requestId&&(a?(this.pendingSegment_=null,this.state="READY",a.code===p.REQUEST_ERRORS.ABORTED?this.mediaRequestsAborted+=1:(this.pause(),a.code===p.REQUEST_ERRORS.TIMEOUT?(this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate")):(this.mediaRequestsErrored+=1,this.error(a),this.trigger("error")))):(this.bandwidth=b.stats.bandwidth,this.roundTrip=b.stats.roundTripTime,b.map&&(b.map=this.initSegment(b.map,!0)),this.processSegmentResponse_(b))):this.mediaRequestsAborted+=1}},{key:"processSegmentResponse_",value:function(a){var b=this.pendingSegment_;b.bytes=a.bytes;a.map&&(b.segment.map.bytes=a.map.bytes);b.endOfAllRequests=a.endOfAllRequests;this.handleSegment_()}},{key:"handleSegment_",value:function(){var a=this;if(this.pendingSegment_){this.state="APPENDING";var b=this.pendingSegment_,c=b.segment;this.syncController_.probeSegmentInfo(b);b.isSyncRequest?(this.trigger("syncinfoupdate"),this.pendingSegment_=null,this.state="READY"):(null!==b.timestampOffset&&b.timestampOffset!==this.sourceUpdater_.timestampOffset()&&(this.sourceUpdater_.timestampOffset(b.timestampOffset),this.trigger("timestampoffset")),c.map&&function(){var b=(0,g.initSegmentId)(c.map);if(!a.activeInitSegmentId_||a.activeInitSegmentId_!==b){var d=a.initSegment(c.map);a.sourceUpdater_.appendBuffer(d.bytes,function(){a.activeInitSegmentId_=b})}}(),b.byteLength=b.bytes.byteLength,this.mediaSecondsLoaded="number"===typeof c.start&&"number"===typeof c.end?this.mediaSecondsLoaded+(c.end-c.start):this.mediaSecondsLoaded+c.duration,this.sourceUpdater_.appendBuffer(b.bytes,this.handleUpdateEnd_.bind(this)))}else this.state="READY"}},{key:"handleUpdateEnd_",value:function(){this.logger_("handleUpdateEnd_","segmentInfo:",this.pendingSegment_);if(this.pendingSegment_){var a=this.pendingSegment_,b=a.segment,c=null!==this.mediaIndex;this.pendingSegment_=null;this.recordThroughput_(a);this.addSegmentMetadataCue_(a);this.state="READY";this.mediaIndex=a.mediaIndex;this.fetchAtBuffer_=!0;this.currentTimeline_=a.timeline;this.trigger("syncinfoupdate");b.end&&this.currentTime_()-b.end>3*a.playlist.targetDuration?this.resetEverything():(c&&this.trigger("bandwidthupdate"),this.trigger("progress"),m(a.playlist,this.mediaSource_,a.mediaIndex+1)&&this.endOfStream(),this.paused()||this.monitorBuffer_())}else this.state="READY",this.paused()||this.monitorBuffer_()}},{key:"recordThroughput_",value:function(a){var b=this.throughput.rate,c=Date.now()-a.endOfAllRequests+1;this.throughput.rate+=(Math.floor(a.byteLength/c*8E3)-b)/++this.throughput.count}},{key:"logger_",value:function(){}},{key:"addSegmentMetadataCue_",value:function(a){if(this.segmentMetadataTrack_){var b=a.segment,c=b.start,b=b.end;if("number"===typeof c&&isFinite(c)&&"number"===typeof b&&isFinite(b)){(0,v["default"])(c,b,this.segmentMetadataTrack_);var g=t["default"].WebKitDataCue||t["default"].VTTCue;a={uri:a.uri,timeline:a.timeline,playlist:a.playlist.uri,start:c,end:b};var d=JSON.stringify(a),c=new g(c,b,d);c.value=a;this.segmentMetadataTrack_.addCue(c)}}}}]);return e}(c["default"].EventTarget);l["default"]=e;q.exports=l["default"]}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./bin-utils":2,"./config":3,"./media-segment-request":6,"./playlist":10,"./playlist-selectors":9,"./ranges":11,"./source-updater":16,"global/window":27,"videojs-contrib-media-sources/es5/remove-cues-from-track.js":71}],16:[function(k,q,l){(function(e){Object.defineProperty(l,"__esModule",{value:!0});var h=function(){function d(b,a){for(var c=0;c<a.length;c++){var d=a[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(b,d.key,d)}}return function(b,a,c){a&&d(b.prototype,a);c&&d(b,c);return b}}(),n=(e="undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null)&&e.__esModule?e:{"default":e},f=function(){};e=function(){function d(b,a){var c=this;if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");var f=function(){c.sourceBuffer_=b.addSourceBuffer(a);c.onUpdateendCallback_=function(){var a=c.pendingCallback_;c.pendingCallback_=null;a&&a();c.runCallback_()};c.sourceBuffer_.addEventListener("updateend",c.onUpdateendCallback_);c.runCallback_()};this.callbacks_=[];this.pendingCallback_=null;this.timestampOffset_=0;this.mediaSource=b;this.processedAppend_=!1;"closed"===b.readyState?b.addEventListener("sourceopen",f):f()}h(d,[{key:"abort",value:function(b){var a=this;this.processedAppend_&&this.queueCallback_(function(){a.sourceBuffer_.abort()},b)}},{key:"appendBuffer",value:function(b,a){var c=this;this.processedAppend_=!0;this.queueCallback_(function(){c.sourceBuffer_.appendBuffer(b)},a)}},{key:"buffered",value:function(){return this.sourceBuffer_?this.sourceBuffer_.buffered:n["default"].createTimeRanges()}},{key:"remove",value:function(b,a){var c=this;this.processedAppend_&&this.queueCallback_(function(){c.sourceBuffer_.remove(b,a)},f)}},{key:"updating",value:function(){return!this.sourceBuffer_||this.sourceBuffer_.updating||this.pendingCallback_}},{key:"timestampOffset",value:function(b){var a=this;"undefined"!==typeof b&&(this.queueCallback_(function(){a.sourceBuffer_.timestampOffset=b}),this.timestampOffset_=b);return this.timestampOffset_}},{key:"queueCallback_",value:function(b,a){this.callbacks_.push([b.bind(this),a]);this.runCallback_()}},{key:"runCallback_",value:function(){var b;!this.updating()&&this.callbacks_.length&&(b=this.callbacks_.shift(),this.pendingCallback_=b[1],b[0]())}},{key:"dispose",value:function(){this.sourceBuffer_.removeEventListener("updateend",this.onUpdateendCallback_);this.sourceBuffer_&&"open"===this.mediaSource.readyState&&this.sourceBuffer_.abort()}}]);return d}();l["default"]=e;q.exports=l["default"]}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],17:[function(k,q,l){(function(e){function h(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(l,"__esModule",{value:!0});var n=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,g){c&&a(b.prototype,c);g&&a(b,g);return b}}(),f=k("mux.js/lib/mp4/probe"),d=f&&f.__esModule?f:{"default":f},b=k("mux.js/lib/tools/ts-inspector.js"),a=k("./playlist"),c=(e="undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null)&&e.__esModule?e:{"default":e},r=[{name:"VOD",run:function(a,b,c,g,d){return Infinity!==c?{time:0,segmentIndex:0}:null}},{name:"ProgramDateTime",run:function(a,b,c,g,d){return a.datetimeToDisplayTime&&b.dateTimeObject?{time:b.dateTimeObject.getTime()/1E3+a.datetimeToDisplayTime,segmentIndex:0}:null}},{name:"Segment",run:function(a,b,c,g,d){a=b.segments||[];c=b=null;d=d||0;for(var f=0;f<a.length;f++){var p=a[f];if(p.timeline===g&&"undefined"!==typeof p.start){var m=Math.abs(d-p.start);if(null!==c&&c<m)break;if(!b||null===c||c>=m)c=m,b={time:p.start,segmentIndex:f}}}return b}},{name:"Discontinuity",run:function(a,b,c,g,d){c=null;d=d||0;if(b.discontinuityStarts&&b.discontinuityStarts.length){g=null;for(var f=0;f<b.discontinuityStarts.length;f++){var p=b.discontinuityStarts[f],m=a.discontinuities[b.discontinuitySequence+f+1];if(m){var e=Math.abs(d-m.time);if(null!==g&&g<e)break;if(!c||null===g||g>=e)g=e,c={time:m.time,segmentIndex:p}}}}return c}},{name:"Playlist",run:function(a,b,c,g,d){return b.syncInfo?{time:b.syncInfo.time,segmentIndex:b.syncInfo.mediaSequence-b.mediaSequence}:null}}];l.syncPointStrategies=r;e=function(f){function e(){var a=0>=arguments.length||void 0===arguments[0]?{}:arguments[0];if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var b;a:{var d=Object.getPrototypeOf(e.prototype),f="constructor";b=this;var r=!0;for(;r;)if(null===d&&(d=Function.prototype),r=Object.getOwnPropertyDescriptor(d,f),void 0===r){d=Object.getPrototypeOf(d);if(null===d)break;r=!0}else{if("value"in r){b=r.value;break a}f=r.get;b=void 0===f?void 0:f.call(b);break a}b=void 0}b.call(this);this.inspectCache_=void 0;this.timelines=[];this.discontinuities=[];this.datetimeToDisplayTime=null;a.debug&&(this.logger_=c["default"].log.bind(c["default"],"sync-controller -\x3e"))}h(e,f);n(e,[{key:"getSyncPoint",value:function(a,b,c,d){a=this.runStrategies_(a,b,c,d);return a.length?this.selectSyncPoint_(a,{key:"time",value:d}):null}},{key:"getExpiredTime",value:function(b,c){if(!b||!b.segments)return null;var g=this.runStrategies_(b,c,b.discontinuitySequence,0);if(!g.length)return null;g=this.selectSyncPoint_(g,{key:"segmentIndex",value:0});0<g.segmentIndex&&(g.time*=-1);return Math.abs(g.time+(0,a.sumDurations)(b,g.segmentIndex,0))}},{key:"runStrategies_",value:function(a,b,c,d){for(var g=[],f=0;f<r.length;f++){var p=r[f],e=p.run(this,a,b,c,d);e&&(e.strategy=p.name,g.push({strategy:p.name,syncPoint:e}),this.logger_("syncPoint found via \x3c"+p.name+"\x3e:",e))}return g}},{key:"selectSyncPoint_",value:function(a,b){for(var c=a[0].syncPoint,g=Math.abs(a[0].syncPoint[b.key]-b.value),d=a[0].strategy,f=1;f<a.length;f++){var e=Math.abs(a[f].syncPoint[b.key]-b.value);e<g&&(g=e,c=a[f].syncPoint,d=a[f].strategy)}this.logger_("syncPoint with strategy \x3c"+d+"\x3e chosen: ",c);return c}},{key:"saveExpiredSegmentInfo",value:function(a,b){for(var c=b.mediaSequence-a.mediaSequence-1;0<=c;c--){var g=a.segments[c];if(g&&"undefined"!==typeof g.start){b.syncInfo={mediaSequence:a.mediaSequence+c,time:g.start};this.logger_("playlist sync:",b.syncInfo);this.trigger("syncinfoupdate");break}}}},{key:"setDateTimeMapping",value:function(a){!this.datetimeToDisplayTime&&a.dateTimeObject&&(this.datetimeToDisplayTime=-(a.dateTimeObject.getTime()/1E3))}},{key:"reset",value:function(){this.inspectCache_=void 0}},{key:"probeSegmentInfo",value:function(a){var b;(b=a.segment.map?this.probeMp4Segment_(a):this.probeTsSegment_(a))&&this.calculateSegmentTimeMapping_(a,b)&&this.saveDiscontinuitySyncInfo_(a)}},{key:"probeMp4Segment_",value:function(a){var b=a.segment,c=d["default"].timescale(b.map.bytes),c=d["default"].startTime(c,a.bytes);null!==a.timestampOffset&&(a.timestampOffset-=c);return{start:c,end:c+b.duration}}},{key:"probeTsSegment_",value:function(a){a=(0,b.inspect)(a.bytes,this.inspectCache_);var c=void 0,d=void 0;if(!a)return null;a.video&&2===a.video.length?(this.inspectCache_=a.video[1].dts,c=a.video[0].dtsTime,d=a.video[1].dtsTime):a.audio&&2===a.audio.length&&(this.inspectCache_=a.audio[1].dts,c=a.audio[0].dtsTime,d=a.audio[1].dtsTime);return{start:c,end:d}}},{key:"timestampOffsetForTimeline",value:function(a){return"undefined"===typeof this.timelines[a]?null:this.timelines[a].time}},{key:"calculateSegmentTimeMapping_",value:function(a,b){var c=a.segment,g=this.timelines[a.timeline];if(null!==a.timestampOffset)this.logger_("tsO:",a.timestampOffset),g={time:a.startOfSegment,mapping:a.startOfSegment-b.start},this.timelines[a.timeline]=g,this.trigger("timestampoffset"),c.start=a.startOfSegment,c.end=b.end+g.mapping;else if(g)c.start=b.start+g.mapping,c.end=b.end+g.mapping;else return!1;return!0}},{key:"saveDiscontinuitySyncInfo_",value:function(b){var c=b.playlist,d=b.segment;if(d.discontinuity)this.discontinuities[d.timeline]={time:d.start,accuracy:0};else if(c.discontinuityStarts.length)for(var f=0;f<c.discontinuityStarts.length;f++){var e=c.discontinuityStarts[f],m=c.discontinuitySequence+f+1,r=e-b.mediaIndex,h=Math.abs(r);if(!this.discontinuities[m]||this.discontinuities[m].accuracy>h)e=0>r?d.start-(0,a.sumDurations)(c,b.mediaIndex,e):d.end+(0,a.sumDurations)(c,b.mediaIndex+1,e),this.discontinuities[m]={time:e,accuracy:h}}}},{key:"logger_",value:function(){}}]);return e}(c["default"].EventTarget);l["default"]=e}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./playlist":10,"mux.js/lib/mp4/probe":52,"mux.js/lib/tools/ts-inspector.js":54}],18:[function(k,q,l){(function(e){function h(a){return a&&a.__esModule?a:{"default":a}}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(l,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var g=b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),d=k("./segment-loader"),d=h(d),b=h("undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null);e=k("global/window");var a=h(e);e=k("videojs-contrib-media-sources/es5/remove-cues-from-track.js");var c=h(e),r=k("./bin-utils"),u=new Uint8Array(["\n","\n"].map(function(a){return a.charCodeAt(0)})),d=function(d){function e(a){var b=1>=arguments.length||void 0===arguments[1]?{}:arguments[1];if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var c;a:{var g=Object.getPrototypeOf(e.prototype),d="constructor";c=this;var f=!0;for(;f;)if(null===g&&(g=Function.prototype),f=Object.getOwnPropertyDescriptor(g,d),void 0===f){g=Object.getPrototypeOf(g);if(null===g)break;f=!0}else{if("value"in f){c=f.value;break a}d=f.get;c=void 0===d?void 0:d.call(c);break a}c=void 0}c.call(this,a,b);this.subtitlesTrack_=this.mediaSource_=null}n(e,d);f(e,[{key:"buffered_",value:function(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues.length)return b["default"].createTimeRanges();var a=this.subtitlesTrack_.cues;return b["default"].createTimeRanges([[a[0].startTime,a[a.length-1].startTime]])}},{key:"initSegment",value:function(a){var b=1>=arguments.length||void 0===arguments[1]?!1:arguments[1];if(!a)return null;var c=(0,r.initSegmentId)(a),g=this.initSegments_[c];b&&!g&&a.bytes&&(b=new Uint8Array(u.byteLength+a.bytes.byteLength),b.set(a.bytes),b.set(u,a.bytes.byteLength),this.initSegments_[c]=g={resolvedUri:a.resolvedUri,byterange:a.byterange,bytes:b});return g||a}},{key:"couldBeginLoading_",value:function(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}},{key:"init_",value:function(){this.state="READY";this.resetEverything();return this.monitorBuffer_()}},{key:"track",value:function(a){this.subtitlesTrack_=a;"INIT"===this.state&&this.couldBeginLoading_()&&this.init_()}},{key:"remove",value:function(a,b){(0,c["default"])(a,b,this.subtitlesTrack_)}},{key:"fillBuffer_",value:function(){var a=this;this.syncPoint_||(this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_()));var b=this.checkBuffer_(this.buffered_(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_);if(b=this.skipEmptySegments_(b))null===this.syncController_.timestampOffsetForTimeline(b.timeline)?(this.syncController_.one("timestampoffset",function(){a.state="READY";a.paused()||a.monitorBuffer_()}),this.state="WAITING_ON_TIMELINE"):this.loadSegment_(b)}},{key:"skipEmptySegments_",value:function(a){for(;a&&a.segment.empty;)a=this.generateSegmentInfo_(a.playlist,a.mediaIndex+1,a.startOfSegment+a.duration,a.isSyncRequest);return a}},{key:"handleSegment_",value:function(){var b=this;if(this.pendingSegment_){this.state="APPENDING";var c=this.pendingSegment_,d=c.segment;if("function"!==typeof a["default"].WebVTT&&this.subtitlesTrack_&&this.subtitlesTrack_.tech_){var f=function(){var a=function(){b.handleSegment_()};b.state="WAITING_ON_VTTJS";b.subtitlesTrack_.tech_.one("vttjsloaded",a);b.subtitlesTrack_.tech_.one("vttjserror",function(){b.subtitlesTrack_.tech_.off("vttjsloaded",a);b.error({message:"Error loading vtt.js"});b.state="READY";b.pause();b.trigger("error")});return{v:void 0}}();if("object"===typeof f)return f.v}d.requested=!0;try{this.parseVTTCues_(c)}catch(m){return this.error({message:m.message}),this.state="READY",this.pause(),this.trigger("error")}this.updateTimeMapping_(c,this.syncController_.timelines[c.timeline],this.playlist_);c.isSyncRequest?(this.trigger("syncinfoupdate"),this.pendingSegment_=null,this.state="READY"):(c.byteLength=c.bytes.byteLength,this.mediaSecondsLoaded+=d.duration,c.cues.forEach(function(a){b.subtitlesTrack_.addCue(a)}),this.handleUpdateEnd_())}else this.state="READY"}},{key:"parseVTTCues_",value:function(c){var g=void 0,d=!1;"function"===typeof a["default"].TextDecoder?g=new a["default"].TextDecoder("utf8"):(g=a["default"].WebVTT.StringDecoder(),d=!0);g=new a["default"].WebVTT.Parser(a["default"],a["default"].vttjs,g);c.cues=[];c.timestampmap={MPEGTS:0,LOCAL:0};g.oncue=c.cues.push.bind(c.cues);g.ontimestampmap=function(a){return c.timestampmap=a};g.onparsingerror=function(a){b["default"].log.warn("Error encountered when parsing cues: "+a.message)};if(c.segment.map){var f=c.segment.map.bytes;d&&(f=String.fromCharCode.apply(null,f));g.parse(f)}f=c.bytes;d&&(f=String.fromCharCode.apply(null,f));g.parse(f);g.flush()}},{key:"updateTimeMapping_",value:function(a,b,c){var d=a.segment;if(b)if(a.cues.length){var g=a.timestampmap,f=g.MPEGTS/9E4-g.LOCAL+b.mapping;a.cues.forEach(function(a){a.startTime+=f;a.endTime+=f});c.syncInfo||(c.syncInfo={mediaSequence:c.mediaSequence+a.mediaIndex,time:Math.min(a.cues[0].startTime,a.cues[a.cues.length-1].startTime-d.duration)})}else d.empty=!0}}]);return e}(d["default"]);l["default"]=d;q.exports=l["default"]}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./bin-utils":2,"./segment-loader":15,"global/window":27,"videojs-contrib-media-sources/es5/remove-cues-from-track.js":71}],19:[function(k,q,l){(function(e){Object.defineProperty(l,"__esModule",{value:!0});var h="undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null,n=h&&h.__esModule?h:{"default":h};l["default"]=function(){return function d(b,a){b=(0,h.mergeOptions)({timeout:45E3},b);var c=d.beforeRequest||n["default"].Hls.xhr.beforeRequest;c&&"function"===typeof c&&(c=c(b))&&(b=c);var e=(0,h.xhr)(b,function(b,c){var d=e.response;!b&&d&&(e.responseTime=Date.now(),e.roundTripTime=e.responseTime-e.requestTime,e.bytesReceived=d.byteLength||d.length,e.bandwidth||(e.bandwidth=Math.floor(e.bytesReceived/e.roundTripTime*8E3)));b&&"ETIMEDOUT"===b.code&&(e.timedout=!0);b||e.aborted||200===c.statusCode||206===c.statusCode||0===c.statusCode||(b=Error("XHR Failed with a response of: "+(e&&(d||e.responseText))));a(b,e)}),k=e.abort;e.abort=function(){e.aborted=!0;return k.apply(e,arguments)};e.uri=b.uri;e.requestTime=Date.now();return e}};q.exports=l["default"]}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],20:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});var e=function(){function e(f,d){for(var b=0;b<d.length;b++){var a=d[b];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(f,a.key,a)}}return function(f,d,b){d&&e(f.prototype,d);b&&e(f,b);return f}}(),h=null;k=function(){function n(f){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");if(!h){var d=[[[],[],[],[],[]],[[],[],[],[],[]]],b=d[0],a=d[1],c=b[4],e=a[4],k,t,v,g=[],p=[],x,w,m,l;for(k=0;256>k;k++)p[(g[k]=k<<1^283*(k>>7))^k]=k;for(t=v=0;!c[t];t^=x||1,v=p[v]||1)for(m=v^v<<1^v<<2^v<<3^v<<4,m=m>>8^m&255^99,c[t]=m,e[m]=t,w=g[k=g[x=g[t]]],l=16843009*w^65537*k^257*x^16843008*t,w=257*g[m]^16843008*m,k=0;4>k;k++)b[k][t]=w=w<<24^w>>>8,a[k][m]=l=l<<24^l>>>8;for(k=0;5>k;k++)b[k]=b[k].slice(0),a[k]=a[k].slice(0);h=d}this._tables=[[h[0][0].slice(),h[0][1].slice(),h[0][2].slice(),h[0][3].slice(),h[0][4].slice()],[h[1][0].slice(),h[1][1].slice(),h[1][2].slice(),h[1][3].slice(),h[1][4].slice()]];d=this._tables[0][4];b=this._tables[1];t=f.length;v=1;if(4!==t&&6!==t&&8!==t)throw Error("Invalid aes key size");c=f.slice(0);e=[];this._key=[c,e];for(f=t;f<4*t+28;f++){a=c[f-1];if(0===f%t||8===t&&4===f%t)a=d[a>>>24]<<24^d[a>>16&255]<<16^d[a>>8&255]<<8^d[a&255],0===f%t&&(a=a<<8^a>>>24^v<<24,v=v<<1^283*(v>>7));c[f]=c[f-t]^a}for(t=0;f;t++,f--)a=c[t&3?f:f-4],e[t]=4>=f||4>t?a:b[0][d[a>>>24]]^b[1][d[a>>16&255]]^b[2][d[a>>8&255]]^b[3][d[a&255]]}e(n,[{key:"decrypt",value:function(f,d,b,a,c,e){var h=this._key[1];f^=h[0];a^=h[1];b^=h[2];d^=h[3];var n,r,g,p=h.length/4-2,k,w=4;n=this._tables[1];var m=n[0],l=n[1],y=n[2],z=n[3],B=n[4];for(k=0;k<p;k++)n=m[f>>>24]^l[a>>16&255]^y[b>>8&255]^z[d&255]^h[w],r=m[a>>>24]^l[b>>16&255]^y[d>>8&255]^z[f&255]^h[w+1],g=m[b>>>24]^l[d>>16&255]^y[f>>8&255]^z[a&255]^h[w+2],d=m[d>>>24]^l[f>>16&255]^y[a>>8&255]^z[b&255]^h[w+3],w+=4,f=n,a=r,b=g;for(k=0;4>k;k++)c[(3&-k)+e]=B[f>>>24]<<24^B[a>>16&255]<<16^B[b>>8&255]<<8^B[d&255]^h[w++],n=f,f=a,a=b,b=d,d=n}}]);return n}();l["default"]=k;q.exports=l["default"]},{}],21:[function(k,q,l){function e(f,d){if("function"!==typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+typeof d);f.prototype=Object.create(d&&d.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}});d&&(Object.setPrototypeOf?Object.setPrototypeOf(f,d):f.__proto__=d)}Object.defineProperty(l,"__esModule",{value:!0});var h=function(){function f(d,b){for(var a=0;a<b.length;a++){var c=b[a];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(d,c.key,c)}}return function(d,b,a){b&&f(d.prototype,b);a&&f(d,a);return d}}(),n=(k=k("./stream"))&&k.__esModule?k:{"default":k};k=function(f){function d(){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");var b;a:{var a=Object.getPrototypeOf(d.prototype),c="constructor";b=this;var f=!0;for(;f;)if(null===a&&(a=Function.prototype),f=Object.getOwnPropertyDescriptor(a,c),void 0===f){a=Object.getPrototypeOf(a);if(null===a)break;f=!0}else{if("value"in f){b=f.value;break a}c=f.get;b=void 0===c?void 0:c.call(b);break a}b=void 0}b.call(this,n["default"]);this.jobs=[];this.delay=1;this.timeout_=null}e(d,f);h(d,[{key:"processJob_",value:function(){this.jobs.shift()();this.timeout_=this.jobs.length?setTimeout(this.processJob_.bind(this),this.delay):null}},{key:"push",value:function(b){this.jobs.push(b);this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))}}]);return d}(n["default"]);l["default"]=k;q.exports=l["default"]},{"./stream":24}],22:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,d,f){d&&a(b.prototype,d);f&&a(b,f);return b}}(),h=(q=k("./aes"))&&q.__esModule?q:{"default":q},n=(q=k("./async-stream"))&&q.__esModule?q:{"default":q},f=k("pkcs7"),d=function(a){return a<<24|(a&65280)<<8|(a&16711680)>>8|a>>>24},b=function(a,b,f){var c=new Int32Array(a.buffer,a.byteOffset,a.byteLength>>2);b=new h["default"](Array.prototype.slice.call(b));a=new Uint8Array(a.byteLength);var e=new Int32Array(a.buffer),n,g,p,r,k,m,l,y;n=f[0];g=f[1];p=f[2];f=f[3];for(y=0;y<c.length;y+=4)r=d(c[y]),k=d(c[y+1]),m=d(c[y+2]),l=d(c[y+3]),b.decrypt(r,k,m,l,e,y),e[y]=d(e[y]^n),e[y+1]=d(e[y+1]^g),e[y+2]=d(e[y+2]^p),e[y+3]=d(e[y+3]^f),n=r,g=k,p=m,f=l;return a};l.decrypt=b;k=function(){function a(b,e,h,k){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");var c=a.STEP,g=new Int32Array(b.buffer),p=new Uint8Array(b.byteLength);b=0;this.asyncStream_=new n["default"];this.asyncStream_.push(this.decryptChunk_(g.subarray(b,b+c),e,h,p));for(b=c;b<g.length;b+=c)h=new Uint32Array([d(g[b-4]),d(g[b-3]),d(g[b-2]),d(g[b-1])]),this.asyncStream_.push(this.decryptChunk_(g.subarray(b,b+c),e,h,p));this.asyncStream_.push(function(){k(null,(0,f.unpad)(p))})}e(a,[{key:"decryptChunk_",value:function(a,d,f,e){return function(){var c=b(a,d,f);e.set(c,a.byteOffset)}}}],[{key:"STEP",get:function(){return 32E3}}]);return a}();l.Decrypter=k;l["default"]={Decrypter:k,decrypt:b}},{"./aes":20,"./async-stream":21,pkcs7:59}],23:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});var e=k("./decrypter");k=k("./async-stream");l["default"]={decrypt:e.decrypt,Decrypter:e.Decrypter,AsyncStream:(k&&k.__esModule?k:{"default":k})["default"]};q.exports=l["default"]},{"./async-stream":21,"./decrypter":22}],24:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});var e=function(){function e(e,f){for(var d=0;d<f.length;d++){var b=f[d];b.enumerable=b.enumerable||!1;b.configurable=!0;"value"in b&&(b.writable=!0);Object.defineProperty(e,b.key,b)}}return function(h,f,d){f&&e(h.prototype,f);d&&e(h,d);return h}}();k=function(){function h(){if(!(this instanceof h))throw new TypeError("Cannot call a class as a function");this.listeners={}}e(h,[{key:"on",value:function(e,f){this.listeners[e]||(this.listeners[e]=[]);this.listeners[e].push(f)}},{key:"off",value:function(e,f){var d;if(!this.listeners[e])return!1;d=this.listeners[e].indexOf(f);this.listeners[e].splice(d,1);return-1<d}},{key:"trigger",value:function(e){var f,d,b,a;if(f=this.listeners[e])if(2===arguments.length)for(b=f.length,d=0;d<b;++d)f[d].call(this,arguments[1]);else for(a=Array.prototype.slice.call(arguments,1),b=f.length,d=0;d<b;++d)f[d].apply(this,a)}},{key:"dispose",value:function(){this.listeners={}}},{key:"pipe",value:function(e){this.on("data",function(f){e.push(f)})}}]);return h}();l["default"]=k;q.exports=l["default"]},{}],25:[function(k,q,l){},{}],26:[function(k,q,l){l="undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{};l="undefined"!==typeof l?l:"undefined"!==typeof window?window:{};k=k("min-document");var e;"undefined"!==typeof document?e=document:(e=l["__GLOBAL_DOCUMENT_CACHE@4"])||(e=l["__GLOBAL_DOCUMENT_CACHE@4"]=k);q.exports=e},{"min-document":25}],27:[function(k,q,l){k="undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{};q.exports="undefined"!==typeof window?window:"undefined"!==typeof k?k:"undefined"!==typeof self?self:{}},{}],28:[function(k,q,l){function e(e){return e&&e.__esModule?e:{"default":e}}l=k("./line-stream");l=e(l);var h=k("./parse-stream"),h=e(h);k=k("./parser");k=e(k);q.exports={LineStream:l["default"],ParseStream:h["default"],Parser:k["default"]}},{"./line-stream":29,"./parse-stream":30,"./parser":31}],29:[function(k,q,l){function e(e,f){if("function"!==typeof f&&null!==f)throw new TypeError("Super expression must either be null or a function, not "+typeof f);e.prototype=Object.create(f&&f.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});f&&(Object.setPrototypeOf?Object.setPrototypeOf(e,f):e.__proto__=f)}Object.defineProperty(l,"__esModule",{value:!0});var h=function(){function e(f,d){for(var b=0;b<d.length;b++){var a=d[b];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(f,a.key,a)}}return function(f,d,b){d&&e(f.prototype,d);b&&e(f,b);return f}}();k=k("./stream");k=function(n){function f(){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");var d;d=(f.__proto__||Object.getPrototypeOf(f)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");d=!d||"object"!==typeof d&&"function"!==typeof d?this:d;d.buffer="";return d}e(f,n);h(f,[{key:"push",value:function(d){this.buffer+=d;for(d=this.buffer.indexOf("\n");-1<d;d=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,d)),this.buffer=this.buffer.substring(d+1)}}]);return f}((k&&k.__esModule?k:{"default":k})["default"]);l["default"]=k},{"./stream":32}],30:[function(k,q,l){function e(d,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);d.prototype=Object.create(b&&b.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(d,b):d.__proto__=b)}Object.defineProperty(l,"__esModule",{value:!0});var h=function(){return function(d,b){if(Array.isArray(d))return d;if(Symbol.iterator in Object(d)){var a=[],c=!0,f=!1,e=void 0;try{for(var h=d[Symbol.iterator](),n;!(c=(n=h.next()).done)&&(a.push(n.value),!b||a.length!==b);c=!0);}catch(g){f=!0,e=g}finally{try{if(!c&&h["return"])h["return"]()}finally{if(f)throw e;}}return a}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),n=function(){function d(b,a){for(var c=0;c<a.length;c++){var d=a[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(b,d.key,d)}}return function(b,a,c){a&&d(b.prototype,a);c&&d(b,c);return b}}();k=k("./stream");var f=function(d){d=d.split(/(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))/);for(var b={},a=d.length,c;a--;)""!==d[a]&&(c=/([^=]*)=(.*)/.exec(d[a]).slice(1),c[0]=c[0].replace(/^\s+|\s+$/g,""),c[1]=c[1].replace(/^\s+|\s+$/g,""),c[1]=c[1].replace(/^['"](.*)['"]$/g,"$1"),b[c[0]]=c[1]);return b};k=function(d){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var a=(b.__proto__||Object.getPrototypeOf(b)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==typeof a&&"function"!==typeof a?this:a}e(b,d);n(b,[{key:"push",value:function(a){var b;a=a.replace(/^[\u0000\s]+|[\u0000\s]+$/g,"");if(0!==a.length)if("#"!==a[0])this.trigger("data",{type:"uri",uri:a});else if(0!==a.indexOf("#EXT"))this.trigger("data",{type:"comment",text:a.slice(1)});else if(a=a.replace("\r",""),b=/^#EXTM3U/.exec(a))this.trigger("data",{type:"tag",tagType:"m3u"});else if(b=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(a))a={type:"tag",tagType:"inf"},b[1]&&(a.duration=parseFloat(b[1])),b[2]&&(a.title=b[2]),this.trigger("data",a);else if(b=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(a))a={type:"tag",tagType:"targetduration"},b[1]&&(a.duration=parseInt(b[1],10)),this.trigger("data",a);else if(b=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(a))a={type:"tag",tagType:"totalduration"},b[1]&&(a.duration=parseInt(b[1],10)),this.trigger("data",a);else if(b=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(a))a={type:"tag",tagType:"version"},b[1]&&(a.version=parseInt(b[1],10)),this.trigger("data",a);else if(b=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(a))a={type:"tag",tagType:"media-sequence"},b[1]&&(a.number=parseInt(b[1],10)),this.trigger("data",a);else if(b=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(a))a={type:"tag",tagType:"discontinuity-sequence"},b[1]&&(a.number=parseInt(b[1],10)),this.trigger("data",a);else if(b=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(a))a={type:"tag",tagType:"playlist-type"},b[1]&&(a.playlistType=b[1]),this.trigger("data",a);else if(b=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(a))a={type:"tag",tagType:"byterange"},b[1]&&(a.length=parseInt(b[1],10)),b[2]&&(a.offset=parseInt(b[2],10)),this.trigger("data",a);else if(b=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(a))a={type:"tag",tagType:"allow-cache"},b[1]&&(a.allowed=!/NO/.test(b[1])),this.trigger("data",a);else if(b=/^#EXT-X-MAP:?(.*)$/.exec(a)){a={type:"tag",tagType:"map"};if(b[1]&&(b=f(b[1]),b.URI&&(a.uri=b.URI),b.BYTERANGE)){b=b.BYTERANGE.split("@");var d=h(b,2);b=d[0];d=d[1];a.byterange={};b&&(a.byterange.length=parseInt(b,10));d&&(a.byterange.offset=parseInt(d,10))}this.trigger("data",a)}else(b=/^#EXT-X-STREAM-INF:?(.*)$/.exec(a))?(a={type:"tag",tagType:"stream-inf"},b[1]&&(a.attributes=f(b[1]),a.attributes.RESOLUTION&&(b=a.attributes.RESOLUTION.split("x"),d={},b[0]&&(d.width=parseInt(b[0],10)),b[1]&&(d.height=parseInt(b[1],10)),a.attributes.RESOLUTION=d),a.attributes.BANDWIDTH&&(a.attributes.BANDWIDTH=parseInt(a.attributes.BANDWIDTH,10)),a.attributes["PROGRAM-ID"]&&(a.attributes["PROGRAM-ID"]=parseInt(a.attributes["PROGRAM-ID"],10))),this.trigger("data",a)):(b=/^#EXT-X-MEDIA:?(.*)$/.exec(a))?(a={type:"tag",tagType:"media"},b[1]&&(a.attributes=f(b[1])),this.trigger("data",a)):(b=/^#EXT-X-ENDLIST/.exec(a))?this.trigger("data",{type:"tag",tagType:"endlist"}):(b=/^#EXT-X-DISCONTINUITY/.exec(a))?this.trigger("data",{type:"tag",tagType:"discontinuity"}):(b=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(a))?(a={type:"tag",tagType:"program-date-time"},b[1]&&(a.dateTimeString=b[1],a.dateTimeObject=new Date(b[1])),this.trigger("data",a)):(b=/^#EXT-X-KEY:?(.*)$/.exec(a))?(a={type:"tag",tagType:"key"},b[1]&&(a.attributes=f(b[1]),a.attributes.IV&&("0x"===a.attributes.IV.substring(0,2).toLowerCase()&&(a.attributes.IV=a.attributes.IV.substring(2)),a.attributes.IV=a.attributes.IV.match(/.{8}/g),a.attributes.IV[0]=parseInt(a.attributes.IV[0],16),a.attributes.IV[1]=parseInt(a.attributes.IV[1],16),a.attributes.IV[2]=parseInt(a.attributes.IV[2],16),a.attributes.IV[3]=parseInt(a.attributes.IV[3],16),a.attributes.IV=new Uint32Array(a.attributes.IV))),this.trigger("data",a)):(b=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(a))?(a={type:"tag",tagType:"cue-out-cont"},a.data=b[1]?b[1]:"",this.trigger("data",a)):(b=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(a))?(a={type:"tag",tagType:"cue-out"},a.data=b[1]?b[1]:"",this.trigger("data",a)):(b=/^#EXT-X-CUE-IN:?(.*)?$/.exec(a))?(a={type:"tag",tagType:"cue-in"},a.data=b[1]?b[1]:"",this.trigger("data",a)):this.trigger("data",{type:"tag",data:a.slice(4)})}}]);return b}((k&&k.__esModule?k:{"default":k})["default"]);l["default"]=k},{"./stream":32}],31:[function(k,q,l){function e(a){return a&&a.__esModule?a:{"default":a}}function h(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(l,"__esModule",{value:!0});var f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b],d;for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();q=k("./stream");q=e(q);var b=k("./line-stream"),a=e(b);k=k("./parse-stream");var c=e(k);k=function(b){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var b=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));b.lineStream=new a["default"];b.parseStream=new c["default"];b.lineStream.pipe(b.parseStream);var d=[],g={},p=void 0,n=void 0,r=function(){},m={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},k=0;b.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};b.parseStream.on("data",function(a){var c=void 0,e=void 0;({tag:function(){({"allow-cache":function(){this.manifest.allowCache=a.allowed;"allowed"in a||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var b={};"length"in a&&(g.byterange=b,b.length=a.length,"offset"in a||(this.trigger("info",{message:"defaulting offset to zero"}),a.offset=0));"offset"in a&&(g.byterange=b,b.offset=a.offset)},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"}));"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"}));0<a.duration&&(g.duration=a.duration);0===a.duration&&(g.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"}));this.manifest.segments=d},key:function(){a.attributes?"NONE"===a.attributes.METHOD?n=null:a.attributes.URI?(a.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),n={method:a.attributes.METHOD||"AES-128",uri:a.attributes.URI},"undefined"!==typeof a.attributes.IV&&(n.iv=a.attributes.IV)):this.trigger("warn",{message:"ignoring key declaration without URI"}):this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(a.number)?this.manifest.mediaSequence=a.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+a.number})},"discontinuity-sequence":function(){isFinite(a.number)?k=this.manifest.discontinuitySequence=a.number:this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+a.number})},"playlist-type":function(){/VOD|EVENT/.test(a.playlistType)?this.manifest.playlistType=a.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+a.playlist})},map:function(){p={};a.uri&&(p.uri=a.uri);a.byterange&&(p.byterange=a.byterange)},"stream-inf":function(){this.manifest.playlists=d;this.manifest.mediaGroups=this.manifest.mediaGroups||m;a.attributes?(g.attributes||(g.attributes={}),f(g.attributes,a.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){this.manifest.mediaGroups=this.manifest.mediaGroups||m;if(a.attributes&&a.attributes.TYPE&&a.attributes["GROUP-ID"]&&a.attributes.NAME){var b=this.manifest.mediaGroups[a.attributes.TYPE];b[a.attributes["GROUP-ID"]]=b[a.attributes["GROUP-ID"]]||{};c=b[a.attributes["GROUP-ID"]];e={"default":/yes/i.test(a.attributes.DEFAULT)};e.autoselect=e["default"]?!0:/yes/i.test(a.attributes.AUTOSELECT);a.attributes.LANGUAGE&&(e.language=a.attributes.LANGUAGE);a.attributes.URI&&(e.uri=a.attributes.URI);a.attributes["INSTREAM-ID"]&&(e.instreamId=a.attributes["INSTREAM-ID"]);a.attributes.CHARACTERISTICS&&(e.characteristics=a.attributes.CHARACTERISTICS);a.attributes.FORCED&&(e.forced=/yes/i.test(a.attributes.FORCED));c[a.attributes.NAME]=e}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){k+=1;g.discontinuity=!0;this.manifest.discontinuityStarts.push(d.length)},"program-date-time":function(){this.manifest.dateTimeString=a.dateTimeString;this.manifest.dateTimeObject=a.dateTimeObject},targetduration:function(){!isFinite(a.duration)||0>a.duration?this.trigger("warn",{message:"ignoring invalid target duration: "+a.duration}):this.manifest.targetDuration=a.duration},totalduration:function(){!isFinite(a.duration)||0>a.duration?this.trigger("warn",{message:"ignoring invalid total duration: "+a.duration}):this.manifest.totalDuration=a.duration},"cue-out":function(){g.cueOut=a.data},"cue-out-cont":function(){g.cueOutCont=a.data},"cue-in":function(){g.cueIn=a.data}}[a.tagType]||r).call(b)},uri:function(){g.uri=a.uri;d.push(g);!this.manifest.targetDuration||"duration"in g||(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),g.duration=this.manifest.targetDuration);n&&(g.key=n);g.timeline=k;p&&(g.map=p);g={}},comment:function(){}})[a.type].call(b)});return b}n(e,b);d(e,[{key:"push",value:function(a){this.lineStream.push(a)}},{key:"end",value:function(){this.lineStream.push("\n")}}]);return e}(q["default"]);l["default"]=k},{"./line-stream":29,"./parse-stream":30,"./stream":32}],32:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});var e=function(){function e(e,f){for(var d=0;d<f.length;d++){var b=f[d];b.enumerable=b.enumerable||!1;b.configurable=!0;"value"in b&&(b.writable=!0);Object.defineProperty(e,b.key,b)}}return function(h,f,d){f&&e(h.prototype,f);d&&e(h,d);return h}}();k=function(){function h(){if(!(this instanceof h))throw new TypeError("Cannot call a class as a function");this.listeners={}}e(h,[{key:"on",value:function(e,f){this.listeners[e]||(this.listeners[e]=[]);this.listeners[e].push(f)}},{key:"off",value:function(e,f){if(!this.listeners[e])return!1;var d=this.listeners[e].indexOf(f);this.listeners[e].splice(d,1);return-1<d}},{key:"trigger",value:function(e){var f=this.listeners[e],d,b,a;if(f)if(2===arguments.length)for(b=f.length,d=0;d<b;++d)f[d].call(this,arguments[1]);else for(a=Array.prototype.slice.call(arguments,1),b=f.length,d=0;d<b;++d)f[d].apply(this,a)}},{key:"dispose",value:function(){this.listeners={}}},{key:"pipe",value:function(e){this.on("data",function(f){e.push(f)})}}]);return h}();l["default"]=k},{}],33:[function(k,q,l){k=k("../utils/stream.js");var e;e=function(){var h=new Uint8Array,n=0;e.prototype.init.call(this);this.setTimestamp=function(f){n=f};this.parseId3TagSize=function(f,d){var b=f[d+6]<<21|f[d+7]<<14|f[d+8]<<7|f[d+9];return(f[d+5]&16)>>4?b+20:b+10};this.parseAdtsSize=function(f,d){return f[d+3]&6144|f[d+4]<<3|(f[d+5]&224)>>5};this.push=function(f){var d=0,b;h.length?(b=h.length,h=new Uint8Array(f.byteLength+b),h.set(h.subarray(0,b)),h.set(f,b)):h=f;for(;3<=h.length-d;)if(73===h[d]&&68===h[d+1]&&51===h[d+2]){if(10>h.length-d)break;f=this.parseId3TagSize(h,d);if(f>h.length)break;b={type:"timed-metadata",data:h.subarray(d,d+f)};this.trigger("data",b);d+=f}else if(h[d]&1&&240===(h[d+1]&240)){if(7>h.length-d)break;f=this.parseAdtsSize(h,d);if(f>h.length)break;b={type:"audio",data:h.subarray(d,d+f),pts:n,dts:n};this.trigger("data",b);d+=f}else d++;h=0<h.length-d?h.subarray(d):new Uint8Array}};e.prototype=new k;q.exports=e},{"../utils/stream.js":57}],34:[function(k,q,l){var e=[96E3,88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350],h=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]};q.exports={parseId3TagSize:function(e,f){var d=e[f+6]<<21|e[f+7]<<14|e[f+8]<<7|e[f+9];return(e[f+5]&16)>>4?d+20:d+10},parseAdtsSize:function(e,f){return e[f+3]&6144|e[f+4]<<3|(e[f+5]&224)>>5},parseType:function(e,f){return 73===e[f]&&68===e[f+1]&&51===e[f+2]?"timed-metadata":e[f]&1&&240===(e[f+1]&240)?"audio":null},parseSampleRate:function(h){for(var f=0;f+5<h.length;)if(255!==h[f]||240!==(h[f+1]&246))f++;else return e[(h[f+2]&60)>>>2];return null},parseAacTimestamp:function(e){var f,d,b;f=10;e[5]&64&&(f=f+4+h(e.subarray(10,14)));do{d=h(e.subarray(f+4,f+8));if(1>d)break;b=String.fromCharCode(e[f],e[f+1],e[f+2],e[f+3]);if("PRIV"===b){b=e.subarray(f+10,f+d+10);for(var a=0;a<b.byteLength;a++)if(0===b[a]){var c=unescape,n=b,k=a,t,l="";for(t=0;t<k;t++)l+="%"+("00"+n[t].toString(16)).slice(-2);if("com.apple.streaming.transportStreamTimestamp"===c(l))return e=b.subarray(a+1),f=(e[3]&1)<<30|e[4]<<22|e[5]<<14|e[6]<<6|e[7]>>>2,f*=4,f+=e[7]&3;break}}f+=10;f+=d}while(f<e.byteLength);return null}}},{}],35:[function(k,q,l){k=k("../utils/stream.js");var e,h=[96E3,88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350];e=function(){var n;e.prototype.init.call(this);this.push=function(e){var d=0,b=0,a,c,f,k;if("audio"===e.type)for(n?(c=n,n=new Uint8Array(c.byteLength+e.data.byteLength),n.set(c),n.set(e.data,c.byteLength)):n=e.data;d+5<n.length;)if(255!==n[d]||240!==(n[d+1]&246))d++;else{c=2*(~n[d+1]&1);a=(n[d+3]&3)<<11|n[d+4]<<3|(n[d+5]&224)>>5;f=1024*((n[d+6]&3)+1);k=9E4*f/h[(n[d+2]&60)>>>2];a=d+a;if(n.byteLength<a)break;this.trigger("data",{pts:e.pts+b*k,dts:e.dts+b*k,sampleCount:f,audioobjecttype:(n[d+2]>>>6&3)+1,channelcount:(n[d+2]&1)<<2|(n[d+3]&192)>>>6,samplerate:h[(n[d+2]&60)>>>2],samplingfrequencyindex:(n[d+2]&60)>>>2,samplesize:16,data:n.subarray(d+7+c,a)});if(n.byteLength===a){n=void 0;break}b++;n=n.subarray(a)}};this.flush=function(){this.trigger("done")}};e.prototype=new k;q.exports=e},{"../utils/stream.js":57}],36:[function(k,q,l){l=k("../utils/stream.js");var e=k("../utils/exp-golomb.js"),h,n,f;n=function(){var d=0,b,a;n.prototype.init.call(this);this.push=function(c){var e;a?(e=new Uint8Array(a.byteLength+c.data.byteLength),e.set(a),e.set(c.data,a.byteLength),a=e):a=c.data;for(;d<a.byteLength-3;d++)if(1===a[d+2]){b=d+5;break}for(;b<a.byteLength;)switch(a[b]){case 0:if(0!==a[b-1]){b+=2;break}else if(0!==a[b-2]){b++;break}d+3!==b-2&&this.trigger("data",a.subarray(d+3,b-2));do b++;while(1!==a[b]&&b<a.length);d=b-2;b+=3;break;case 1:if(0!==a[b-1]||0!==a[b-2]){b+=3;break}this.trigger("data",a.subarray(d+3,b-2));d=b-2;b+=3;break;default:b+=3}a=a.subarray(d);b-=d;d=0};this.flush=function(){a&&3<a.byteLength&&this.trigger("data",a.subarray(d+3));a=null;d=0;this.trigger("done")}};n.prototype=new l;f={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0};h=function(){var d=new n,b,a,c,k,l,t,v;h.prototype.init.call(this);b=this;this.push=function(b){"video"===b.type&&(a=b.trackId,c=b.pts,k=b.dts,d.push(b))};d.on("data",function(d){var g={trackId:a,pts:c,dts:k,data:d};switch(d[0]&31){case 5:g.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:g.nalUnitType="sei_rbsp";g.escapedRBSP=l(d.subarray(1));break;case 7:g.nalUnitType="seq_parameter_set_rbsp";g.escapedRBSP=l(d.subarray(1));g.config=t(g.escapedRBSP);break;case 8:g.nalUnitType="pic_parameter_set_rbsp";break;case 9:g.nalUnitType="access_unit_delimiter_rbsp"}b.trigger("data",g)});d.on("done",function(){b.trigger("done")});this.flush=function(){d.flush()};v=function(a,b){var c=8,d=8,g;for(g=0;g<a;g++)0!==d&&(d=b.readExpGolomb(),d=(c+d+256)%256),c=0===d?c:d};l=function(a){for(var b=a.byteLength,c=[],d=1,g;d<b-2;)0===a[d]&&0===a[d+1]&&3===a[d+2]?(c.push(d+2),d+=2):d++;if(0===c.length)return a;b-=c.length;g=new Uint8Array(b);for(var e=0,d=0;d<b;e++,d++)e===c[0]&&(e++,c.shift()),g[d]=a[e];return g};t=function(a){var b=0,c=0,d=0,g=0,h=1,n,k,r,t,l,u,q,G;a=new e(a);n=a.readUnsignedByte();r=a.readUnsignedByte();k=a.readUnsignedByte();a.skipUnsignedExpGolomb();if(f[n]&&(t=a.readUnsignedExpGolomb(),3===t&&a.skipBits(1),a.skipUnsignedExpGolomb(),a.skipUnsignedExpGolomb(),a.skipBits(1),a.readBoolean()))for(l=3!==t?8:12,t=0;t<l;t++)a.readBoolean()&&(6>t?v(16,a):v(64,a));a.skipUnsignedExpGolomb();t=a.readUnsignedExpGolomb();if(0===t)a.readUnsignedExpGolomb();else if(1===t)for(a.skipBits(1),a.skipExpGolomb(),a.skipExpGolomb(),l=a.readUnsignedExpGolomb(),t=0;t<l;t++)a.skipExpGolomb();a.skipUnsignedExpGolomb();a.skipBits(1);t=a.readUnsignedExpGolomb();l=a.readUnsignedExpGolomb();u=a.readBits(1);0===u&&a.skipBits(1);a.skipBits(1);a.readBoolean()&&(b=a.readUnsignedExpGolomb(),c=a.readUnsignedExpGolomb(),d=a.readUnsignedExpGolomb(),g=a.readUnsignedExpGolomb());if(a.readBoolean()&&a.readBoolean()){G=a.readUnsignedByte();switch(G){case 1:q=[1,1];break;case 2:q=[12,11];break;case 3:q=[10,11];break;case 4:q=[16,11];break;case 5:q=[40,33];break;case 6:q=[24,11];break;case 7:q=[20,11];break;case 8:q=[32,11];break;case 9:q=[80,33];break;case 10:q=[18,11];break;case 11:q=[15,11];break;case 12:q=[64,33];break;case 13:q=[160,99];break;case 14:q=[4,3];break;case 15:q=[3,2];break;case 16:q=[2,1];break;case 255:q=[a.readUnsignedByte()<<8|a.readUnsignedByte(),a.readUnsignedByte()<<8|a.readUnsignedByte()]}q&&(h=q[0]/q[1])}return{profileIdc:n,levelIdc:k,profileCompatibility:r,width:Math.ceil((16*(t+1)-2*b-2*c)*h),height:(2-u)*(l+1)*16-2*d-2*g}}};h.prototype=new l;q.exports={H264Stream:h,NalByteStream:n}},{"../utils/exp-golomb.js":56,"../utils/stream.js":57}],37:[function(k,q,l){k=[33,16,5,32,164,27];l=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252];var e=function(e){for(var h=[];e--;)h.push(0);return h};k={96E3:[k,[227,64],e(154),[56]],88200:[k,[231],e(170),[56]],64E3:[k,[248,192],e(240),[56]],48E3:[k,[255,192],e(268),[55,148,128],e(54),[112]],44100:[k,[255,192],e(268),[55,163,128],e(84),[112]],32E3:[k,[255,192],e(268),[55,234],e(226),[112]],24E3:[k,[255,192],e(268),[55,255,128],e(268),[111,112],e(126),[224]],16E3:[k,[255,192],e(268),[55,255,128],e(268),[111,255],e(269),[223,108],e(195),[1,192]],12E3:[l,e(268),[3,127,248],e(268),[6,255,240],e(268),[13,255,224],e(268),[27,253,128],e(259),[56]],11025:[l,e(268),[3,127,248],e(268),[6,255,240],e(268),[13,255,224],e(268),[27,255,192],e(268),[55,175,128],e(108),[112]],8E3:[l,e(268),[3,121,16],e(47),[7]]};q.exports=function(e){return Object.keys(e).reduce(function(h,f){h[f]=new Uint8Array(e[f].reduce(function(d,b){return d.concat(b)},[]));return h},{})}(k)},{}],38:[function(k,q,l){k=k("../utils/stream.js");var e=function(h){this.numberOfTracks=0;this.metadataStream=h.metadataStream;this.videoTags=[];this.audioTags=[];this.audioTrack=this.videoTrack=null;this.pendingCaptions=[];this.pendingMetadata=[];this.processedTracks=this.pendingTracks=0;e.prototype.init.call(this);this.push=function(e){if(e.text)return this.pendingCaptions.push(e);if(e.frames)return this.pendingMetadata.push(e);"video"===e.track.type&&(this.videoTrack=e.track,this.videoTags=e.tags,this.pendingTracks++);"audio"===e.track.type&&(this.audioTrack=e.track,this.audioTags=e.tags,this.pendingTracks++)}};e.prototype=new k;e.prototype.flush=function(e){var h,f,d={tags:{},captions:[],metadata:[]};if(this.pendingTracks<this.numberOfTracks&&("VideoSegmentStream"!==e&&"AudioSegmentStream"!==e||0===this.pendingTracks&&(this.processedTracks++,this.processedTracks<this.numberOfTracks)))return;this.processedTracks+=this.pendingTracks;this.pendingTracks=0;if(!(this.processedTracks<this.numberOfTracks)){this.videoTrack?f=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(f=this.audioTrack.timelineStartInfo.pts);d.tags.videoTags=this.videoTags;d.tags.audioTags=this.audioTags;for(e=0;e<this.pendingCaptions.length;e++)h=this.pendingCaptions[e],h.startTime=h.startPts-f,h.startTime/=9E4,h.endTime=h.endPts-f,h.endTime/=9E4,d.captions.push(h);for(e=0;e<this.pendingMetadata.length;e++)h=this.pendingMetadata[e],h.cueTime=h.pts-f,h.cueTime/=9E4,d.metadata.push(h);d.metadata.dispatchType=this.metadataStream.dispatchType;this.audioTrack=this.videoTrack=null;this.videoTags=[];this.audioTags=[];this.pendingCaptions.length=0;this.processedTracks=this.pendingTracks=this.pendingMetadata.length=0;this.trigger("data",d);this.trigger("done")}};q.exports=e},{"../utils/stream.js":57}],39:[function(k,q,l){var e=k("./flv-tag.js");q.exports=function(h,k,f){var d=new Uint8Array(9),b=new DataView(d.buffer);h=h||0;k=void 0===k?!0:k;f=void 0===f?!0:f;b.setUint8(0,70);b.setUint8(1,76);b.setUint8(2,86);b.setUint8(3,1);b.setUint8(4,(k?4:0)|(f?1:0));b.setUint32(5,d.byteLength);if(0>=h)return h=new Uint8Array(d.byteLength+4),h.set(d),h.set([0,0,0,0],d.byteLength),h;k=new e(e.METADATA_TAG);k.pts=k.dts=0;k.writeMetaDataDouble("duration",h);k=k.finalize().length;h=new Uint8Array(d.byteLength+k);h.set(d);h.set(b.byteLength,k);return h}},{"./flv-tag.js":40}],40:[function(k,q,l){var e;e=function(h,k){var f=0,d=16384,b=function(a,b){var c;c=a.position+b;c<a.bytes.byteLength||(c=new Uint8Array(2*c),c.set(a.bytes.subarray(0,a.position),0),a.bytes=c,a.view=new DataView(a.bytes.buffer))},a=e.widthBytes||new Uint8Array(5),c=e.heightBytes||new Uint8Array(6),r=e.videocodecidBytes||new Uint8Array(12),n;if(!e.widthBytes){for(n=0;5>n;n++)a[n]="width".charCodeAt(n);for(n=0;6>n;n++)c[n]="height".charCodeAt(n);for(n=0;12>n;n++)r[n]="videocodecid".charCodeAt(n);e.widthBytes=a;e.heightBytes=c;e.videocodecidBytes=r}this.keyFrame=!1;switch(h){case e.VIDEO_TAG:this.length=16;d*=6;break;case e.AUDIO_TAG:this.length=13;this.keyFrame=!0;break;case e.METADATA_TAG:this.length=29;this.keyFrame=!0;break;default:throw Error("Unknown FLV tag type");}this.bytes=new Uint8Array(d);this.view=new DataView(this.bytes.buffer);this.bytes[0]=h;this.position=this.length;this.keyFrame=k;this.dts=this.pts=0;this.writeBytes=function(a,c,d){c=c||0;var e;d=d||a.byteLength;e=c+d;b(this,d);this.bytes.set(a.subarray(c,e),this.position);this.position+=d;this.length=Math.max(this.length,this.position)};this.writeByte=function(a){b(this,1);this.bytes[this.position]=a;this.position++;this.length=Math.max(this.length,this.position)};this.writeShort=function(a){b(this,2);this.view.setUint16(this.position,a);this.position+=2;this.length=Math.max(this.length,this.position)};this.negIndex=function(a){return this.bytes[this.length-a]};this.nalUnitSize=function(){return 0===f?0:this.length-(f+4)};this.startNalUnit=function(){if(0<f)throw Error("Attempted to create new NAL wihout closing the old one");f=this.length;this.position=this.length+=4};this.endNalUnit=function(a){var b,c;this.length===f+4?this.length-=4:0<f&&(b=f+4,c=this.length-b,this.position=f,this.view.setUint32(this.position,c),this.position=this.length,a&&a.push(this.bytes.subarray(b,b+c)));f=0};this.writeMetaDataDouble=function(d,e){var g;b(this,2+d.length+9);this.view.setUint16(this.position,d.length);this.position+=2;if("width"===d)this.bytes.set(a,this.position),this.position+=5;else if("height"===d)this.bytes.set(c,this.position),this.position+=6;else if("videocodecid"===d)this.bytes.set(r,this.position),this.position+=12;else for(g=0;g<d.length;g++)this.bytes[this.position]=d.charCodeAt(g),this.position++;this.position++;this.view.setFloat64(this.position,e);this.position+=8;this.length=Math.max(this.length,this.position);++f};this.writeMetaDataBoolean=function(a,c){var d;b(this,2);this.view.setUint16(this.position,a.length);this.position+=2;for(d=0;d<a.length;d++)b(this,1),this.bytes[this.position]=a.charCodeAt(d),this.position++;b(this,2);this.view.setUint8(this.position,1);this.position++;this.view.setUint8(this.position,c?1:0);this.position++;this.length=Math.max(this.length,this.position);++f};this.finalize=function(){var a;switch(this.bytes[0]){case e.VIDEO_TAG:this.bytes[11]=(this.keyFrame||k?16:32)|7;this.bytes[12]=k?0:1;a=this.pts-this.dts;this.bytes[13]=(a&16711680)>>>16;this.bytes[14]=(a&65280)>>>8;this.bytes[15]=(a&255)>>>0;break;case e.AUDIO_TAG:this.bytes[11]=175;this.bytes[12]=k?0:1;break;case e.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,f),this.position=this.length,this.bytes.set([0,0,9],this.position),this.length=this.position+=3}a=this.length-11;this.bytes[1]=(a&16711680)>>>16;this.bytes[2]=(a&65280)>>>8;this.bytes[3]=(a&255)>>>0;this.bytes[4]=(this.dts&16711680)>>>16;this.bytes[5]=(this.dts&65280)>>>8;this.bytes[6]=(this.dts&255)>>>0;this.bytes[7]=(this.dts&4278190080)>>>24;this.bytes[8]=0;this.bytes[9]=0;this.bytes[10]=0;b(this,4);this.view.setUint32(this.length,this.length);this.length+=4;this.position+=4;this.bytes=this.bytes.subarray(0,this.length);this.frameTime=e.frameTime(this.bytes);return this}};e.AUDIO_TAG=8;e.VIDEO_TAG=9;e.METADATA_TAG=18;e.isAudioFrame=function(h){return e.AUDIO_TAG===h[0]};e.isVideoFrame=function(h){return e.VIDEO_TAG===h[0]};e.isMetaData=function(h){return e.METADATA_TAG===h[0]};e.isKeyFrame=function(h){return e.isVideoFrame(h)?23===h[11]:e.isAudioFrame(h)||e.isMetaData(h)?!0:!1};e.frameTime=function(e){var h=e[4]<<16,h=h|e[5]<<8,h=h|e[6]<<0;return h|=e[7]<<24};q.exports=e},{}],41:[function(k,q,l){q.exports={tag:k("./flv-tag"),Transmuxer:k("./transmuxer"),getFlvHeader:k("./flv-header")}},{"./flv-header":39,"./flv-tag":40,"./transmuxer":43}],42:[function(k,q,l){q.exports=function(){var e=this;this.list=[];this.push=function(e){this.list.push({bytes:e.bytes,dts:e.dts,pts:e.pts,keyFrame:e.keyFrame,metaDataTag:e.metaDataTag})};Object.defineProperty(this,"length",{get:function(){return e.list.length}})}},{}],43:[function(k,q,l){l=k("../utils/stream.js");var e=k("./flv-tag.js"),h=k("../m2ts/m2ts.js"),n=k("../codecs/adts.js"),f=k("../codecs/h264").H264Stream,d=k("./coalesce-stream.js"),b=k("./tag-list.js"),a,c,r,u,t,v;u=function(a,b){"number"===typeof b.pts&&(a.timelineStartInfo.pts=void 0===a.timelineStartInfo.pts?b.pts:Math.min(a.timelineStartInfo.pts,b.pts));"number"===typeof b.dts&&(a.timelineStartInfo.dts=void 0===a.timelineStartInfo.dts?b.dts:Math.min(a.timelineStartInfo.dts,b.dts))};t=function(a,b){var c=new e(e.METADATA_TAG);c.dts=b;c.pts=b;c.writeMetaDataDouble("videocodecid",7);c.writeMetaDataDouble("width",a.width);c.writeMetaDataDouble("height",a.height);return c};v=function(a,b){var c,d=new e(e.VIDEO_TAG,!0);d.dts=b;d.pts=b;d.writeByte(1);d.writeByte(a.profileIdc);d.writeByte(a.profileCompatibility);d.writeByte(a.levelIdc);d.writeByte(255);d.writeByte(225);d.writeShort(a.sps[0].length);d.writeBytes(a.sps[0]);d.writeByte(a.pps.length);for(c=0;c<a.pps.length;++c)d.writeShort(a.pps[c].length),d.writeBytes(a.pps[c]);return d};r=function(a){var c=[],d;r.prototype.init.call(this);this.push=function(b){u(a,b);a&&void 0===a.channelcount&&(a.audioobjecttype=b.audioobjecttype,a.channelcount=b.channelcount,a.samplerate=b.samplerate,a.samplingfrequencyindex=b.samplingfrequencyindex,a.samplesize=b.samplesize,a.extraData=a.audioobjecttype<<11|a.samplingfrequencyindex<<7|a.channelcount<<3);b.pts=Math.round(b.pts/90);b.dts=Math.round(b.dts/90);c.push(b)};this.flush=function(){var f,g,h,p=new b;if(0!==c.length){for(h=-Infinity;c.length;){f=c.shift();if(a.extraData!==d||1E3<=f.pts-h)g=new e(e.METADATA_TAG),g.pts=f.pts,g.dts=f.dts,g.writeMetaDataDouble("audiocodecid",10),g.writeMetaDataBoolean("stereo",2===a.channelcount),g.writeMetaDataDouble("audiosamplerate",a.samplerate),g.writeMetaDataDouble("audiosamplesize",16),p.push(g.finalize()),d=a.extraData,g=new e(e.AUDIO_TAG,!0),g.pts=f.pts,g.dts=f.dts,g.view.setUint16(g.position,a.extraData),g.position+=2,g.length=Math.max(g.length,g.position),p.push(g.finalize()),h=f.pts;g=new e(e.AUDIO_TAG);g.pts=f.pts;g.dts=f.dts;g.writeBytes(f.data);p.push(g.finalize())}d=null;this.trigger("data",{track:a,tags:p.list})}this.trigger("done","AudioSegmentStream")}};r.prototype=new l;c=function(a){var d=[],f,g;c.prototype.init.call(this);this.finishFrame=function(b,c){if(c){if(f&&a&&a.newMetadata&&(c.keyFrame||0===b.length)){var d=t(f,c.dts).finalize(),e=v(a,c.dts).finalize();d.metaDataTag=e.metaDataTag=!0;b.push(d);b.push(e);a.newMetadata=!1}c.endNalUnit();b.push(c.finalize());g=null}};this.push=function(b){u(a,b);b.pts=Math.round(b.pts/90);b.dts=Math.round(b.dts/90);d.push(b)};this.flush=function(){for(var c,h=new b;d.length&&"access_unit_delimiter_rbsp"!==d[0].nalUnitType;)d.shift();if(0!==d.length){for(;d.length;)c=d.shift(),"seq_parameter_set_rbsp"===c.nalUnitType?(a.newMetadata=!0,f=c.config,a.width=f.width,a.height=f.height,a.sps=[c.data],a.profileIdc=f.profileIdc,a.levelIdc=f.levelIdc,a.profileCompatibility=f.profileCompatibility,g.endNalUnit()):"pic_parameter_set_rbsp"===c.nalUnitType?(a.newMetadata=!0,a.pps=[c.data],g.endNalUnit()):"access_unit_delimiter_rbsp"===c.nalUnitType?(g&&this.finishFrame(h,g),g=new e(e.VIDEO_TAG),g.pts=c.pts,g.dts=c.dts):("slice_layer_without_partitioning_rbsp_idr"===c.nalUnitType&&(g.keyFrame=!0),g.endNalUnit()),g.startNalUnit(),g.writeBytes(c.data);g&&this.finishFrame(h,g);this.trigger("data",{track:a,tags:h.list})}this.trigger("done","VideoSegmentStream")}};c.prototype=new l;a=function(b){var e=this,g,k,m,l,t,v,B,q,u,F,D;a.prototype.init.call(this);b=b||{};this.metadataStream=new h.MetadataStream;b.metadataStream=this.metadataStream;g=new h.TransportPacketStream;k=new h.TransportParseStream;m=new h.ElementaryStream;l=new h.TimestampRolloverStream("video");t=new h.TimestampRolloverStream("audio");v=new h.TimestampRolloverStream("timed-metadata");B=new n;q=new f;D=new d(b);g.pipe(k).pipe(m);m.pipe(l).pipe(q);m.pipe(t).pipe(B);m.pipe(v).pipe(this.metadataStream).pipe(D);b=new h.CaptionStream;q.pipe(b).pipe(D);m.on("data",function(a){var b,d,e;if("metadata"===a.type){for(b=a.tracks.length;b--;)"video"===a.tracks[b].type?d=a.tracks[b]:"audio"===a.tracks[b].type&&(e=a.tracks[b]);d&&!u&&(D.numberOfTracks++,u=new c(d),q.pipe(u).pipe(D));e&&!F&&(D.numberOfTracks++,F=new r(e),B.pipe(F).pipe(D))}});this.push=function(a){g.push(a)};this.flush=function(){g.flush()};D.on("data",function(a){e.trigger("data",a)});D.on("done",function(){e.trigger("done")})};a.prototype=new l;q.exports=a},{"../codecs/adts.js":35,"../codecs/h264":36,"../m2ts/m2ts.js":45,"../utils/stream.js":57,"./coalesce-stream.js":38,"./flv-tag.js":40,"./tag-list.js":42}],44:[function(k,q,l){k=k("../utils/stream");var e=function(a,b){var c=[],d,e,f,g;if(!(b[0]&64))return c;e=b[0]&31;for(d=0;d<e;d++)f=3*d,g={type:b[f+2]&3,pts:a},b[f+2]&4&&(g.ccData=b[f+3]<<8|b[f+4],c.push(g));return c},h=function(){h.prototype.init.call(this);this.captionPackets_=[];this.field1_=new b;this.field1_.on("data",this.trigger.bind(this,"data"));this.field1_.on("done",this.trigger.bind(this,"done"))};h.prototype=new k;h.prototype.push=function(a){var b;if("sei_rbsp"===a.nalUnitType){b=a.escapedRBSP;for(var d=0,f={payloadType:-1,payloadSize:0},h=0,k=0;d<b.byteLength&&128!==b[d];){for(;255===b[d];)h+=255,d++;for(h+=b[d++];255===b[d];)k+=255,d++;k+=b[d++];if(!f.payload&&4===h){f.payloadType=h;f.payloadSize=k;f.payload=b.subarray(d,d+k);break}d+=k;k=h=0}4===f.payloadType&&(b=181!==f.payload[0]||49!==(f.payload[1]<<8|f.payload[2])||"GA94"!==String.fromCharCode(f.payload[3],f.payload[4],f.payload[5],f.payload[6])||3!==f.payload[7]?null:f.payload.subarray(8,f.payload.length-1))&&(this.captionPackets_=this.captionPackets_.concat(e(a.pts,b)))}};h.prototype.flush=function(){this.captionPackets_.length&&(this.captionPackets_.forEach(function(a,b){a.presortIndex=b}),this.captionPackets_.sort(function(a,b){return a.pts===b.pts?a.presortIndex-b.presortIndex:a.pts-b.pts}),this.captionPackets_.forEach(this.field1_.push,this.field1_),this.captionPackets_.length=0);this.field1_.flush()};var n={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608},f=function(a){if(null===a)return"";a=n[a]||a;return String.fromCharCode(a)},d=function(){for(var a=[],b=15;b--;)a.push("");return a},b=function(){b.prototype.init.call(this);this.mode_="popOn";this.startPts_=this.topRow_=0;this.displayed_=d();this.nonDisplayed_=d();this.lastControlCode_=null;this.push=function(a){if(0===a.type){var b,e;b=a.ccData&32639;if(b===this.lastControlCode_)this.lastControlCode_=null;else switch(this.lastControlCode_=4096===(b&61440)?b:null,b){case 0:break;case 5152:this.mode_="popOn";break;case 5167:this.flushDisplayed(a.pts);e=this.displayed_;this.displayed_=this.nonDisplayed_;this.nonDisplayed_=e;this.startPts_=a.pts;break;case 5157:this.topRow_=13;this.mode_="rollUp";break;case 5158:this.topRow_=12;this.mode_="rollUp";break;case 5159:this.topRow_=11;this.mode_="rollUp";break;case 5165:this.flushDisplayed(a.pts);this.shiftRowsUp_();this.startPts_=a.pts;break;case 5153:"popOn"===this.mode_?this.nonDisplayed_[14]=this.nonDisplayed_[14].slice(0,-1):this.displayed_[14]=this.displayed_[14].slice(0,-1);break;case 5164:this.flushDisplayed(a.pts);this.displayed_=d();break;case 5166:this.nonDisplayed_=d();break;default:e=b>>>8,b&=255,16<=e&&23>=e&&64<=b&&127>=b&&(16!==e||96>b)&&(e=32,b=null),(17===e||25===e)&&48<=b&&63>=b&&(e=9834,b=""),16!==(e&240)&&(0===e&&(e=null),0===b&&(b=null),this[this.mode_](a.pts,e,b))}}}};b.prototype=new k;b.prototype.flushDisplayed=function(a){var b=this.displayed_.map(function(a){return a.trim()}).filter(function(a){return a.length}).join("\n");b.length&&this.trigger("data",{startPts:this.startPts_,endPts:a,text:b})};b.prototype.popOn=function(a,b,d){a=this.nonDisplayed_[14];a+=f(b);a+=f(d);this.nonDisplayed_[14]=a};b.prototype.rollUp=function(a,b,d){var c=this.displayed_[14];""===c&&(this.flushDisplayed(a),this.startPts_=a);c+=f(b);c+=f(d);this.displayed_[14]=c};b.prototype.shiftRowsUp_=function(){var a;for(a=0;a<this.topRow_;a++)this.displayed_[a]="";for(a=this.topRow_;14>a;a++)this.displayed_[a]=this.displayed_[a+1];this.displayed_[14]=""};q.exports={CaptionStream:h,Cea608Stream:b}},{"../utils/stream":57}],45:[function(k,q,l){l=k("../utils/stream.js");var e=k("./caption-stream"),h=k("./stream-types"),n=k("./timestamp-rollover-stream").TimestampRolloverStream,f=k("./stream-types.js"),d,b,a;d=function(){var a=new Uint8Array(188),b=0;d.prototype.init.call(this);this.push=function(c){var d=0,e=188,f;b?(f=new Uint8Array(c.byteLength+b),f.set(a.subarray(0,b)),f.set(c,b),b=0):f=c;for(;e<f.byteLength;)71===f[d]&&71===f[e]?(this.trigger("data",f.subarray(d,e)),d+=188,e+=188):(d++,e++);d<f.byteLength&&(a.set(f.subarray(d),0),b=f.byteLength-d)};this.flush=function(){188===b&&71===a[0]&&(this.trigger("data",a),b=0);this.trigger("done")}};d.prototype=new l;b=function(){var a,c,d,e;b.prototype.init.call(this);e=this;this.packetsWaitingForPmt=[];this.programMapTable=void 0;a=function(a,b){var e=0;b.payloadUnitStartIndicator&&(e+=a[e]+1);"pat"===b.type?c(a.subarray(e),b):d(a.subarray(e),b)};c=function(a,b){b.section_number=a[7];b.last_section_number=a[8];e.pmtPid=(a[10]&31)<<8|a[11];b.pmtPid=e.pmtPid};d=function(a,b){var c,d;if(a[5]&1){e.programMapTable={};c=3+((a[1]&15)<<8|a[2])-4;for(d=12+((a[10]&15)<<8|a[11]);d<c;)e.programMapTable[(a[d+1]&31)<<8|a[d+2]]=a[d],d+=((a[d+3]&15)<<8|a[d+4])+5;for(b.programMapTable=e.programMapTable;e.packetsWaitingForPmt.length;)e.processPes_.apply(e,e.packetsWaitingForPmt.shift())}};this.push=function(b){var c={},d=4;c.payloadUnitStartIndicator=!!(b[1]&64);c.pid=b[1]&31;c.pid<<=8;c.pid|=b[2];1<(b[3]&48)>>>4&&(d+=b[d]+1);0===c.pid?(c.type="pat",a(b.subarray(d),c),this.trigger("data",c)):c.pid===this.pmtPid?(c.type="pmt",a(b.subarray(d),c),this.trigger("data",c)):void 0===this.programMapTable?this.packetsWaitingForPmt.push([b,d,c]):this.processPes_(b,d,c)};this.processPes_=function(a,b,c){c.streamType=this.programMapTable[c.pid];c.type="pes";c.data=a.subarray(b);this.trigger("data",c)}};b.prototype=new l;b.STREAM_TYPES={h264:27,adts:15};a=function(){var b=this,c={data:[],size:0},d={data:[],size:0},e={data:[],size:0},g=function(a,c,d){var e=new Uint8Array(a.size),f={type:c},g,h=0,k;if(a.data.length&&!(9>a.size)){f.trackId=a.data[0].pid;for(g=0;g<a.data.length;g++)k=a.data[g],e.set(k.data,h),h+=k.data.byteLength;f.packetLength=6+(e[4]<<8|e[5]);f.dataAlignmentIndicator=0!==(e[6]&4);g=e[7];g&192&&(f.pts=(e[9]&14)<<27|(e[10]&255)<<20|(e[11]&254)<<12|(e[12]&255)<<5|(e[13]&254)>>>3,f.pts*=4,f.pts+=(e[13]&6)>>>1,f.dts=f.pts,g&64&&(f.dts=(e[14]&14)<<27|(e[15]&255)<<20|(e[16]&254)<<12|(e[17]&255)<<5|(e[18]&254)>>>3,f.dts*=4,f.dts+=(e[18]&6)>>>1));f.data=e.subarray(9+e[8]);c="video"===c||f.packetLength===a.size;if(d||c)a.size=0,a.data.length=0;c&&b.trigger("data",f)}};a.prototype.init.call(this);this.push=function(a){({pat:function(){},pes:function(){var b,k;switch(a.streamType){case h.H264_STREAM_TYPE:case f.H264_STREAM_TYPE:b=c;k="video";break;case h.ADTS_STREAM_TYPE:b=d;k="audio";break;case h.METADATA_STREAM_TYPE:b=e;k="timed-metadata";break;default:return}a.payloadUnitStartIndicator&&g(b,k,!0);b.data.push(a);b.size+=a.data.byteLength},pmt:function(){var c={type:"metadata",tracks:[]},d=a.programMapTable,e,g;for(e in d)d.hasOwnProperty(e)&&(g={timelineStartInfo:{baseMediaDecodeTime:0}},g.id=+e,d[e]===f.H264_STREAM_TYPE?(g.codec="avc",g.type="video"):d[e]===f.ADTS_STREAM_TYPE&&(g.codec="adts",g.type="audio"),c.tracks.push(g));b.trigger("data",c)}})[a.type]()};this.flush=function(){g(c,"video");g(d,"audio");g(e,"timed-metadata");this.trigger("done")}};a.prototype=new l;k={PAT_PID:0,MP2T_PACKET_LENGTH:188,TransportPacketStream:d,TransportParseStream:b,ElementaryStream:a,TimestampRolloverStream:n,CaptionStream:e.CaptionStream,Cea608Stream:e.Cea608Stream,MetadataStream:k("./metadata-stream")};for(var c in h)h.hasOwnProperty(c)&&(k[c]=h[c]);q.exports=k},{"../utils/stream.js":57,"./caption-stream":44,"./metadata-stream":46,"./stream-types":48,"./stream-types.js":48,"./timestamp-rollover-stream":49}],46:[function(k,q,l){l=k("../utils/stream");var e=k("./stream-types"),h=function(b,a,c){for(var d="";a<c;a++)d+="%"+("00"+b[a].toString(16)).slice(-2);return d},n=function(b){return b[0]<<21|b[1]<<14|b[2]<<7|b[3]},f={TXXX:function(b){var a;if(3===b.data[0]){for(a=1;a<b.data.length;a++)if(0===b.data[a]){b.description=decodeURIComponent(h(b.data,1,a));b.value=decodeURIComponent(h(b.data,a+1,b.data.length)).replace(/\0*$/,"");break}b.data=b.value}},WXXX:function(b){var a;if(3===b.data[0])for(a=1;a<b.data.length;a++)if(0===b.data[a]){b.description=decodeURIComponent(h(b.data,1,a));b.url=decodeURIComponent(h(b.data,a+1,b.data.length));break}},PRIV:function(b){var a;for(a=0;a<b.data.length;a++)if(0===b.data[a]){b.owner=unescape(h(b.data,0,a));break}b.privateData=b.data.subarray(a+1);b.data=b.privateData}},d;d=function(b){var a=!(!b||!b.debug);b=b&&b.descriptor;var c=0,h=[],k=0,l;d.prototype.init.call(this);this.dispatchType=e.METADATA_STREAM_TYPE.toString(16);if(b)for(l=0;l<b.length;l++)this.dispatchType+=("00"+b[l].toString(16)).slice(-2);this.push=function(b){var d,e,r;if("timed-metadata"===b.type)if(b.dataAlignmentIndicator&&(k=0,h.length=0),0===h.length&&(10>b.data.length||73!==b.data[0]||68!==b.data[1]||51!==b.data[2]))a&&console.log("Skipping unrecognized metadata packet");else if(h.push(b),k+=b.data.byteLength,1===h.length&&(c=n(b.data.subarray(6,10)),c+=10),!(k<c)){b={data:new Uint8Array(c),frames:[],pts:h[0].pts,dts:h[0].dts};for(d=0;d<c;)b.data.set(h[0].data.subarray(0,c-d),d),d+=h[0].data.byteLength,k-=h[0].data.byteLength,h.shift();d=10;b.data[5]&64&&(d=d+4+n(b.data.subarray(10,14)),c-=n(b.data.subarray(16,20)));do{e=n(b.data.subarray(d+4,d+8));if(1>e)return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.");r=String.fromCharCode(b.data[d],b.data[d+1],b.data[d+2],b.data[d+3]);r={id:r,data:b.data.subarray(d+10,d+e+10)};r.key=r.id;if(f[r.id]&&(f[r.id](r),"com.apple.streaming.transportStreamTimestamp"===r.owner)){var l=r.data,m=(l[3]&1)<<30|l[4]<<22|l[5]<<14|l[6]<<6|l[7]>>>2,m=4*m,m=m+(l[7]&3);r.timeStamp=m;void 0===b.pts&&void 0===b.dts&&(b.pts=r.timeStamp,b.dts=r.timeStamp);this.trigger("timestamp",r)}b.frames.push(r);d+=10;d+=e}while(d<c);this.trigger("data",b)}}};d.prototype=new l;q.exports=d},{"../utils/stream":57,"./stream-types":48}],47:[function(k,q,l){var e=k("./stream-types.js"),h=function(b){var a=b[1]&31;return a=a<<8|b[2]},n=function(b){return!!(b[1]&64)},f=function(b){var a=0;1<(b[3]&48)>>>4&&(a+=b[4]+1);return a},d=function(b){switch(b){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}};q.exports={parseType:function(b,a){var c=h(b);return 0===c?"pat":c===a?"pmt":a?"pes":null},parsePat:function(b){var a=n(b),c=4+f(b);a&&(c+=b[c]+1);return(b[c+10]&31)<<8|b[c+11]},parsePmt:function(b){var a={},c=n(b),d=4+f(b);c&&(d+=b[d]+1);if(b[d+5]&1){for(var c=3+((b[d+1]&15)<<8|b[d+2])-4,e=12+((b[d+10]&15)<<8|b[d+11]);e<c;){var h=d+e;a[(b[h+1]&31)<<8|b[h+2]]=b[h];e+=((b[h+3]&15)<<8|b[h+4])+5}return a}},parsePayloadUnitStartIndicator:n,parsePesType:function(b,a){var c=h(b);switch(a[c]){case e.H264_STREAM_TYPE:return"video";case e.ADTS_STREAM_TYPE:return"audio";case e.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},parsePesTime:function(b){if(!n(b))return null;var a=4+f(b);if(a>=b.byteLength)return null;var c=null,d;d=b[a+7];d&192&&(c={},c.pts=(b[a+9]&14)<<27|(b[a+10]&255)<<20|(b[a+11]&254)<<12|(b[a+12]&255)<<5|(b[a+13]&254)>>>3,c.pts*=4,c.pts+=(b[a+13]&6)>>>1,c.dts=c.pts,d&64&&(c.dts=(b[a+14]&14)<<27|(b[a+15]&255)<<20|(b[a+16]&254)<<12|(b[a+17]&255)<<5|(b[a+18]&254)>>>3,c.dts*=4,c.dts+=(b[a+18]&6)>>>1));return c},videoPacketContainsKeyFrame:function(b){var a=4+f(b);b=b.subarray(a);for(var c=a=0,e=!1;c<b.byteLength-3;c++)if(1===b[c+2]){a=c+5;break}for(;a<b.byteLength;)switch(b[a]){case 0:if(0!==b[a-1]){a+=2;break}else if(0!==b[a-2]){a++;break}c+3!==a-2&&(c=d(b[c+3]&31),"slice_layer_without_partitioning_rbsp_idr"===c&&(e=!0));do a++;while(1!==b[a]&&a<b.length);c=a-2;a+=3;break;case 1:if(0!==b[a-1]||0!==b[a-2]){a+=3;break}c=d(b[c+3]&31);"slice_layer_without_partitioning_rbsp_idr"===c&&(e=!0);c=a-2;a+=3;break;default:a+=3}(b=b.subarray(c))&&3<b.byteLength&&(c=d(b[3]&31),"slice_layer_without_partitioning_rbsp_idr"===c&&(e=!0));return e}}},{"./stream-types.js":48}],48:[function(k,q,l){q.exports={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21}},{}],49:[function(k,q,l){k=k("../utils/stream");var e=function(e,f){var d=1;for(e>f&&(d=-1);4294967296<Math.abs(f-e);)e+=8589934592*d;return e},h=function(k){var f,d;h.prototype.init.call(this);this.type_=k;this.push=function(b){b.type===this.type_&&(void 0===d&&(d=b.dts),b.dts=e(b.dts,d),b.pts=e(b.pts,d),f=b.dts,this.trigger("data",b))};this.flush=function(){d=f;this.trigger("done")};this.discontinuity=function(){f=d=void 0}};h.prototype=new k;q.exports={TimestampRolloverStream:h,handleRollover:e}},{"../utils/stream":57}],50:[function(k,q,l){q.exports={generator:k("./mp4-generator"),Transmuxer:k("./transmuxer").Transmuxer,AudioSegmentStream:k("./transmuxer").AudioSegmentStream,VideoSegmentStream:k("./transmuxer").VideoSegmentStream}},{"./mp4-generator":51,"./transmuxer":53}],51:[function(k,q,l){var e=Math.pow(2,32)-1,h,n,f,d,b,a,c,r,u,t,v,g,p,x,w,m,C,y,z,B,A,E,F,D,G,H,N,I,O,P,J,K,Q,L;(function(){var a;A={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]};if("undefined"!==typeof Uint8Array){for(a in A)A.hasOwnProperty(a)&&(A[a]=[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3)]);E=new Uint8Array([105,115,111,109]);D=new Uint8Array([97,118,99,49]);F=new Uint8Array([0,0,0,1]);G=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);H=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);N={video:G,audio:H};P=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);O=new Uint8Array([0,0,0,0,0,0,0,0]);K=J=new Uint8Array([0,0,0,0,0,0,0,0]);Q=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);L=J;I=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})();h=function(a){var b=[],c=0,d,e;for(d=1;d<arguments.length;d++)b.push(arguments[d]);for(d=b.length;d--;)c+=b[d].byteLength;e=new Uint8Array(c+8);(new DataView(e.buffer,e.byteOffset,e.byteLength)).setUint32(0,e.byteLength);e.set(a,4);d=0;for(c=8;d<b.length;d++)e.set(b[d],c),c+=b[d].byteLength;return e};n=function(){return h(A.dinf,h(A.dref,P))};f=function(a){return h(A.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,a.audioobjecttype<<3|a.samplingfrequencyindex>>>1,a.samplingfrequencyindex<<7|a.channelcount<<3,6,1,2]))};d=function(){return h(A.ftyp,E,F,E,D)};x=function(a){return h(A.hdlr,N[a])};p=function(a){var b=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,a.duration>>>24&255,a.duration>>>16&255,a.duration>>>8&255,a.duration&255,85,196,0,0]);a.samplerate&&(b[12]=a.samplerate>>>24&255,b[13]=a.samplerate>>>16&255,b[14]=a.samplerate>>>8&255,b[15]=a.samplerate&255);return h(A.mdhd,b)};g=function(b){return h(A.mdia,p(b),x(b.type),a(b))};b=function(a){return h(A.mfhd,new Uint8Array([0,0,0,0,(a&4278190080)>>24,(a&16711680)>>16,(a&65280)>>8,a&255]))};a=function(a){return h(A.minf,"video"===a.type?h(A.vmhd,I):h(A.smhd,O),n(),m(a))};c=function(a){for(var b=a.length,c=[];b--;)c[b]=t(a[b]);return h.apply(null,[A.moov,u(4294967295)].concat(c).concat(r(a)))};r=function(a){for(var b=a.length,c=[];b--;)c[b]=z(a[b]);return h.apply(null,[A.mvex].concat(c))};u=function(a){a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(a&4278190080)>>24,(a&16711680)>>16,(a&65280)>>8,a&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return h(A.mvhd,a)};w=function(a){a=a.samples||[];var b=new Uint8Array(4+a.length),c,d;for(d=0;d<a.length;d++)c=a[d].flags,b[d+4]=c.dependsOn<<4|c.isDependedOn<<2|c.hasRedundancy;return h(A.sdtp,b)};m=function(a){return h(A.stbl,C(a),h(A.stts,L),h(A.stsc,K),h(A.stsz,Q),h(A.stco,J))};(function(){var a,b;C=function(c){return h(A.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===c.type?a(c):b(c))};a=function(a){var b=a.sps||[],c=a.pps||[],d=[],e=[],f;for(f=0;f<b.length;f++)d.push((b[f].byteLength&65280)>>>8),d.push(b[f].byteLength&255),d=d.concat(Array.prototype.slice.call(b[f]));for(f=0;f<c.length;f++)e.push((c[f].byteLength&65280)>>>8),e.push(c[f].byteLength&255),e=e.concat(Array.prototype.slice.call(c[f]));return h(A.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(a.width&65280)>>8,a.width&255,(a.height&65280)>>8,a.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h(A.avcC,new Uint8Array([1,a.profileIdc,a.profileCompatibility,a.levelIdc,255].concat([b.length]).concat(d).concat([c.length]).concat(e))),h(A.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))};b=function(a){return h(A.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(a.channelcount&65280)>>8,a.channelcount&255,(a.samplesize&65280)>>8,a.samplesize&255,0,0,0,0,(a.samplerate&65280)>>8,a.samplerate&255,0,0]),f(a))}})();v=function(a){a=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(a.id&4278190080)>>24,(a.id&16711680)>>16,(a.id&65280)>>8,a.id&255,0,0,0,0,(a.duration&4278190080)>>24,(a.duration&16711680)>>16,(a.duration&65280)>>8,a.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(a.width&65280)>>8,a.width&255,0,0,(a.height&65280)>>8,a.height&255,0,0]);return h(A.tkhd,a)};y=function(a){var b,c,d;b=h(A.tfhd,new Uint8Array([0,0,0,58,(a.id&4278190080)>>24,(a.id&16711680)>>16,(a.id&65280)>>8,a.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0]));c=Math.floor(a.baseMediaDecodeTime/(e+1));d=Math.floor(a.baseMediaDecodeTime%(e+1));c=h(A.tfdt,new Uint8Array([1,0,0,0,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255]));if("audio"===a.type)return a=B(a,92),h(A.traf,b,c,a);d=w(a);a=B(a,d.length+92);return h(A.traf,b,c,a,d)};t=function(a){a.duration=a.duration||4294967295;return h(A.trak,v(a),g(a))};z=function(a){var b=new Uint8Array([0,0,0,0,(a.id&4278190080)>>24,(a.id&16711680)>>16,(a.id&65280)>>8,a.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);"video"!==a.type&&(b[b.length-1]=0);return h(A.trex,b)};(function(){var a,b,c;c=function(a,b){var c=0,d=0,e=0,f=0;a.length&&(void 0!==a[0].duration&&(c=1),void 0!==a[0].size&&(d=2),void 0!==a[0].flags&&(e=4),void 0!==a[0].compositionTimeOffset&&(f=8));return[0,0,c|d|e|f,1,(a.length&4278190080)>>>24,(a.length&16711680)>>>16,(a.length&65280)>>>8,a.length&255,(b&4278190080)>>>24,(b&16711680)>>>16,(b&65280)>>>8,b&255]};b=function(a,b){var d,e,f,g;e=a.samples||[];b+=20+16*e.length;d=c(e,b);for(g=0;g<e.length;g++)f=e[g],d=d.concat([(f.duration&4278190080)>>>24,(f.duration&16711680)>>>16,(f.duration&65280)>>>8,f.duration&255,(f.size&4278190080)>>>24,(f.size&16711680)>>>16,(f.size&65280)>>>8,f.size&255,f.flags.isLeading<<2|f.flags.dependsOn,f.flags.isDependedOn<<6|f.flags.hasRedundancy<<4|f.flags.paddingValue<<1|f.flags.isNonSyncSample,f.flags.degradationPriority&61440,f.flags.degradationPriority&15,(f.compositionTimeOffset&4278190080)>>>24,(f.compositionTimeOffset&16711680)>>>16,(f.compositionTimeOffset&65280)>>>8,f.compositionTimeOffset&255]);return h(A.trun,new Uint8Array(d))};a=function(a,b){var d,e,f,g;e=a.samples||[];b+=20+8*e.length;d=c(e,b);for(g=0;g<e.length;g++)f=e[g],d=d.concat([(f.duration&4278190080)>>>24,(f.duration&16711680)>>>16,(f.duration&65280)>>>8,f.duration&255,(f.size&4278190080)>>>24,(f.size&16711680)>>>16,(f.size&65280)>>>8,f.size&255]);return h(A.trun,new Uint8Array(d))};B=function(c,d){return"audio"===c.type?a(c,d):b(c,d)}})();q.exports={ftyp:d,mdat:function(a){return h(A.mdat,a)},moof:function(a,c){for(var d=[],e=c.length;e--;)d[e]=y(c[e]);return h.apply(null,[A.moof,b(a)].concat(d))},moov:c,initSegment:function(a){var b=d();a=c(a);var e;e=new Uint8Array(b.byteLength+a.byteLength);e.set(b);e.set(a,b.byteLength);return e}}},{}],52:[function(k,q,l){var e,h;e=function(k,f){var d=[],b,a,c;if(!f.length)return null;for(b=0;b<k.byteLength;)a=k[b]<<24,a|=k[b+1]<<16,a|=k[b+2]<<8,a|=k[b+3],c=h(k.subarray(b+4,b+8)),a=1<a?b+a:k.byteLength,c===f[0]&&(1===f.length?d.push(k.subarray(b+8,a)):(b=e(k.subarray(b+8,a),f.slice(1)),b.length&&(d=d.concat(b)))),b=a;return d};h=function(e){var f;f=""+String.fromCharCode(e[0]);f+=String.fromCharCode(e[1]);f+=String.fromCharCode(e[2]);return f+=String.fromCharCode(e[3])};q.exports={parseType:h,timescale:function(h){return e(h,["moov","trak"]).reduce(function(f,d){var b,a,c;b=e(d,["tkhd"])[0];if(!b)return null;a=b[0];a=0===a?12:20;b=b[a]<<24|b[a+1]<<16|b[a+2]<<8|b[a+3];c=e(d,["mdia","mdhd"])[0];if(!c)return null;a=c[0];a=0===a?12:20;f[b]=c[a]<<24|c[a+1]<<16|c[a+2]<<8|c[a+3];return f},{})},startTime:function(h,f){var d;d=e(f,["moof","traf"]);d=[].concat.apply([],d.map(function(b){return e(b,["tfhd"]).map(function(a){var c;a=h[a[4]<<24|a[5]<<16|a[6]<<8|a[7]]||9E4;c=(c=e(b,["tfdt"]).map(function(a){var b,c;b=a[0];c=a[4]<<24|a[5]<<16|a[6]<<8|a[7];1===b&&(c*=Math.pow(2,32),c+=a[8]<<24|a[9]<<16|a[10]<<8|a[11]);return c})[0])||Infinity;return c/a})}));d=Math.min.apply(null,d);return isFinite(d)?d:0}}},{}],53:[function(k,q,l){l=k("../utils/stream.js");var e=k("./mp4-generator.js"),h=k("../m2ts/m2ts.js"),n=k("../codecs/adts.js"),f=k("../codecs/h264").H264Stream,d=k("../aac"),b=k("../data/silence"),a=k("../utils/clock"),c=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],r=["width","height","profileIdc","levelIdc","profileCompatibility"],u,t,v,g,p,x,w,m,C,y,z;p=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0}}};x=function(a){return 73===a[0]&&68===a[1]&&51===a[2]?!0:!1};y=function(a,b){var c;if(a.length!==b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0};z=function(a){var b,c,d=0;for(b=0;b<a.length;b++)c=a[b],d+=c.data.byteLength;return d};t=function(d){var f=[],g=0,h=0,k=0,p=Infinity;t.prototype.init.call(this);this.push=function(a){w(d,a);d&&c.forEach(function(b){d[b]=a[b]});f.push(a)};this.setEarliestDts=function(a){h=a-d.timelineStartInfo.baseMediaDecodeTime};this.setVideoBaseMediaDecodeTime=function(a){p=a};this.setAudioAppendStart=function(a){k=a};this.flush=function(){var a,b,c;0!==f.length&&(a=this.trimAdtsFramesByEarliestDts_(f),d.baseMediaDecodeTime=C(d),this.prefixWithSilence_(d,a),d.samples=this.generateSampleTable_(a),b=e.mdat(this.concatenateFrameData_(a)),f=[],a=e.moof(g,[d]),c=new Uint8Array(a.byteLength+b.byteLength),g++,c.set(a),c.set(b,a.byteLength),m(d),this.trigger("data",{track:d,boxes:c}));this.trigger("done","AudioSegmentStream")};this.prefixWithSilence_=function(c,d){var e,f,g,h=g=0;if(d.length&&(e=a.audioTsToVideoTs(c.baseMediaDecodeTime,c.samplerate),f=Math.ceil(9E4/(c.samplerate/1024)),k&&p&&(g=e-Math.max(k,p),g=Math.floor(g/f),h=g*f),!(1>g||45E3<h))){f=b[c.samplerate];f||(f=d[0].data);for(e=0;e<g;e++)d.splice(e,0,{data:f});c.baseMediaDecodeTime-=Math.floor(a.videoTsToAudioTs(h,c.samplerate))}};this.trimAdtsFramesByEarliestDts_=function(a){if(d.minSegmentDts>=h)return a;d.minSegmentDts=Infinity;return a.filter(function(a){return a.dts>=h?(d.minSegmentDts=Math.min(d.minSegmentDts,a.dts),d.minSegmentPts=d.minSegmentDts,!0):!1})};this.generateSampleTable_=function(a){var b,c,d=[];for(b=0;b<a.length;b++)c=a[b],d.push({size:c.data.byteLength,duration:1024});return d};this.concatenateFrameData_=function(a){var b,c,d=0,e=new Uint8Array(z(a));for(b=0;b<a.length;b++)c=a[b],e.set(c.data,d),d+=c.data.byteLength;return e}};t.prototype=new l;u=function(a){var b=0,c=[],d,f;u.prototype.init.call(this);delete a.minPTS;this.gopCache_=[];this.push=function(b){w(a,b);"seq_parameter_set_rbsp"!==b.nalUnitType||d||(d=b.config,a.sps=[b.data],r.forEach(function(b){a[b]=d[b]},this));"pic_parameter_set_rbsp"!==b.nalUnitType||f||(f=b.data,a.pps=[b.data]);c.push(b)};this.flush=function(){for(var d,f,g;c.length&&"access_unit_delimiter_rbsp"!==c[0].nalUnitType;)c.shift();0!==c.length&&(d=this.groupNalsIntoFrames_(c),f=this.groupFramesIntoGops_(d),f[0][0].keyFrame||((d=this.getGopForFusion_(c[0],a))?(f.unshift(d),f.byteLength+=d.byteLength,f.nalCount+=d.nalCount,f.pts=d.pts,f.dts=d.dts,f.duration+=d.duration):f=this.extendFirstKeyFrame_(f)),w(a,f),a.samples=this.generateSampleTable_(f),d=e.mdat(this.concatenateNalData_(f)),this.gopCache_.unshift({gop:f.pop(),pps:a.pps,sps:a.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),c=[],a.baseMediaDecodeTime=C(a),this.trigger("baseMediaDecodeTime",a.baseMediaDecodeTime),this.trigger("timelineStartInfo",a.timelineStartInfo),f=e.moof(b,[a]),g=new Uint8Array(f.byteLength+d.byteLength),b++,g.set(f),g.set(d,f.byteLength),this.trigger("data",{track:a,boxes:g}));this.resetStream_();this.trigger("done","VideoSegmentStream")};this.resetStream_=function(){m(a);f=d=void 0};this.getGopForFusion_=function(b){var c=Infinity,d,e,f,g;for(g=0;g<this.gopCache_.length;g++)f=this.gopCache_[g],d=f.gop,a.pps&&y(a.pps[0],f.pps[0])&&a.sps&&y(a.sps[0],f.sps[0])&&!(d.dts<a.timelineStartInfo.dts)&&(d=b.dts-d.dts-d.duration,-1E4<=d&&45E3>=d&&(!e||c>d)&&(e=f,c=d));return e?e.gop:null};this.extendFirstKeyFrame_=function(a){var b;!a[0][0].keyFrame&&1<a.length&&(b=a.shift(),a.byteLength-=b.byteLength,a.nalCount-=b.nalCount,a[0][0].dts=b.dts,a[0][0].pts=b.pts,a[0][0].duration+=b.duration);return a};this.groupNalsIntoFrames_=function(a){var b,c,d=[],e=[];for(b=d.byteLength=0;b<a.length;b++)c=a[b],"access_unit_delimiter_rbsp"===c.nalUnitType?(d.length&&(d.duration=c.dts-d.dts,e.push(d)),d=[c],d.byteLength=c.data.byteLength,d.pts=c.pts,d.dts=c.dts):("slice_layer_without_partitioning_rbsp_idr"===c.nalUnitType&&(d.keyFrame=!0),d.duration=c.dts-d.dts,d.byteLength+=c.data.byteLength,d.push(c));e.length&&(!d.duration||0>=d.duration)&&(d.duration=e[e.length-1].duration);e.push(d);return e};this.groupFramesIntoGops_=function(a){var b,c,d=[],e=[];d.byteLength=0;d.nalCount=0;d.duration=0;d.pts=a[0].pts;d.dts=a[0].dts;e.byteLength=0;e.nalCount=0;e.duration=0;e.pts=a[0].pts;e.dts=a[0].dts;for(b=0;b<a.length;b++)c=a[b],c.keyFrame?(d.length&&(e.push(d),e.byteLength+=d.byteLength,e.nalCount+=d.nalCount,e.duration+=d.duration),d=[c],d.nalCount=c.length,d.byteLength=c.byteLength,d.pts=c.pts,d.dts=c.dts,d.duration=c.duration):(d.duration+=c.duration,d.nalCount+=c.length,d.byteLength+=c.byteLength,d.push(c));e.length&&0>=d.duration&&(d.duration=e[e.length-1].duration);e.byteLength+=d.byteLength;e.nalCount+=d.nalCount;e.duration+=d.duration;e.push(d);return e};this.generateSampleTable_=function(a,b){var c,d,e,f,g,h=b||0,k=[];for(c=0;c<a.length;c++)for(f=a[c],d=0;d<f.length;d++)g=f[d],e=p(),e.dataOffset=h,e.compositionTimeOffset=g.pts-g.dts,e.duration=g.duration,e.size=4*g.length,e.size+=g.byteLength,g.keyFrame&&(e.flags.dependsOn=2),h+=e.size,k.push(e);return k};this.concatenateNalData_=function(a){var b,c,d,e,f,g,h=0,k=new Uint8Array(a.byteLength+4*a.nalCount),m=new DataView(k.buffer);for(b=0;b<a.length;b++)for(e=a[b],c=0;c<e.length;c++)for(f=e[c],d=0;d<f.length;d++)g=f[d],m.setUint32(h,g.data.byteLength),h+=4,k.set(g.data,h),h+=g.data.byteLength;return k}};u.prototype=new l;w=function(a,b){"number"===typeof b.pts&&(void 0===a.timelineStartInfo.pts&&(a.timelineStartInfo.pts=b.pts),a.minSegmentPts=void 0===a.minSegmentPts?b.pts:Math.min(a.minSegmentPts,b.pts),a.maxSegmentPts=void 0===a.maxSegmentPts?b.pts:Math.max(a.maxSegmentPts,b.pts));"number"===typeof b.dts&&(void 0===a.timelineStartInfo.dts&&(a.timelineStartInfo.dts=b.dts),a.minSegmentDts=void 0===a.minSegmentDts?b.dts:Math.min(a.minSegmentDts,b.dts),a.maxSegmentDts=void 0===a.maxSegmentDts?b.dts:Math.max(a.maxSegmentDts,b.dts))};m=function(a){delete a.minSegmentDts;delete a.maxSegmentDts;delete a.minSegmentPts;delete a.maxSegmentPts};C=function(a){var b,c=a.minSegmentDts-a.timelineStartInfo.dts;b=a.timelineStartInfo.baseMediaDecodeTime;b=Math.max(0,b+c);"audio"===a.type&&(a=a.samplerate/9E4,b=Math.floor(b*a));return b};g=function(a,b){this.numberOfTracks=0;this.metadataStream=b;this.remuxTracks="undefined"!==typeof a.remux?!!a.remux:!0;this.pendingTracks=[];this.videoTrack=null;this.pendingBoxes=[];this.pendingCaptions=[];this.pendingMetadata=[];this.emittedTracks=this.pendingBytes=0;g.prototype.init.call(this);this.push=function(a){if(a.text)return this.pendingCaptions.push(a);if(a.frames)return this.pendingMetadata.push(a);this.pendingTracks.push(a.track);this.pendingBoxes.push(a.boxes);this.pendingBytes+=a.boxes.byteLength;"video"===a.track.type&&(this.videoTrack=a.track);"audio"===a.track.type&&(this.audioTrack=a.track)}};g.prototype=new l;g.prototype.flush=function(a){var b=0,d={captions:[],metadata:[],info:{}},f=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==a&&"AudioSegmentStream"!==a||this.remuxTracks)return;if(0===this.pendingTracks.length){this.emittedTracks++;this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}this.videoTrack?(f=this.videoTrack.timelineStartInfo.pts,r.forEach(function(a){d.info[a]=this.videoTrack[a]},this)):this.audioTrack&&(f=this.audioTrack.timelineStartInfo.pts,c.forEach(function(a){d.info[a]=this.audioTrack[a]},this));d.type=1===this.pendingTracks.length?this.pendingTracks[0].type:"combined";this.emittedTracks+=this.pendingTracks.length;a=e.initSegment(this.pendingTracks);d.initSegment=new Uint8Array(a.byteLength);d.initSegment.set(a);d.data=new Uint8Array(this.pendingBytes);for(a=0;a<this.pendingBoxes.length;a++)d.data.set(this.pendingBoxes[a],b),b+=this.pendingBoxes[a].byteLength;for(a=0;a<this.pendingCaptions.length;a++)b=this.pendingCaptions[a],b.startTime=b.startPts-f,b.startTime/=9E4,b.endTime=b.endPts-f,b.endTime/=9E4,d.captions.push(b);for(a=0;a<this.pendingMetadata.length;a++)b=this.pendingMetadata[a],b.cueTime=b.pts-f,b.cueTime/=9E4,d.metadata.push(b);d.metadata.dispatchType=this.metadataStream.dispatchType;this.pendingTracks.length=0;this.videoTrack=null;this.pendingBoxes.length=0;this.pendingBytes=this.pendingCaptions.length=0;this.pendingMetadata.length=0;this.trigger("data",d);this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)};v=function(a){var b=this,c=!0,e,k;v.prototype.init.call(this);a=a||{};this.baseMediaDecodeTime=a.baseMediaDecodeTime||0;this.transmuxPipeline_={};this.setupAacPipeline=function(){var c={};this.transmuxPipeline_=c;c.type="aac";c.metadataStream=new h.MetadataStream;c.aacStream=new d;c.audioTimestampRolloverStream=new h.TimestampRolloverStream("audio");c.timedMetadataTimestampRolloverStream=new h.TimestampRolloverStream("timed-metadata");c.adtsStream=new n;c.coalesceStream=new g(a,c.metadataStream);c.headOfPipeline=c.aacStream;c.aacStream.pipe(c.audioTimestampRolloverStream).pipe(c.adtsStream);c.aacStream.pipe(c.timedMetadataTimestampRolloverStream).pipe(c.metadataStream).pipe(c.coalesceStream);c.metadataStream.on("timestamp",function(a){c.aacStream.setTimestamp(a.timeStamp)});c.aacStream.on("data",function(a){"timed-metadata"!==a.type||c.audioSegmentStream||(k=k||{timelineStartInfo:{baseMediaDecodeTime:b.baseMediaDecodeTime},codec:"adts",type:"audio"},c.coalesceStream.numberOfTracks++,c.audioSegmentStream=new t(k),c.adtsStream.pipe(c.audioSegmentStream).pipe(c.coalesceStream))});c.coalesceStream.on("data",this.trigger.bind(this,"data"));c.coalesceStream.on("done",this.trigger.bind(this,"done"))};this.setupTsPipeline=function(){var c={};this.transmuxPipeline_=c;c.type="ts";c.metadataStream=new h.MetadataStream;c.packetStream=new h.TransportPacketStream;c.parseStream=new h.TransportParseStream;c.elementaryStream=new h.ElementaryStream;c.videoTimestampRolloverStream=new h.TimestampRolloverStream("video");c.audioTimestampRolloverStream=new h.TimestampRolloverStream("audio");c.timedMetadataTimestampRolloverStream=new h.TimestampRolloverStream("timed-metadata");c.adtsStream=new n;c.h264Stream=new f;c.captionStream=new h.CaptionStream;c.coalesceStream=new g(a,c.metadataStream);c.headOfPipeline=c.packetStream;c.packetStream.pipe(c.parseStream).pipe(c.elementaryStream);c.elementaryStream.pipe(c.videoTimestampRolloverStream).pipe(c.h264Stream);c.elementaryStream.pipe(c.audioTimestampRolloverStream).pipe(c.adtsStream);c.elementaryStream.pipe(c.timedMetadataTimestampRolloverStream).pipe(c.metadataStream).pipe(c.coalesceStream);c.h264Stream.pipe(c.captionStream).pipe(c.coalesceStream);c.elementaryStream.on("data",function(a){var d;if("metadata"===a.type){for(d=a.tracks.length;d--;)e||"video"!==a.tracks[d].type?k||"audio"!==a.tracks[d].type||(k=a.tracks[d],k.timelineStartInfo.baseMediaDecodeTime=b.baseMediaDecodeTime):(e=a.tracks[d],e.timelineStartInfo.baseMediaDecodeTime=b.baseMediaDecodeTime);e&&!c.videoSegmentStream&&(c.coalesceStream.numberOfTracks++,c.videoSegmentStream=new u(e),c.videoSegmentStream.on("timelineStartInfo",function(a){k&&(k.timelineStartInfo=a,c.audioSegmentStream.setEarliestDts(a.dts))}),c.videoSegmentStream.on("baseMediaDecodeTime",function(a){k&&c.audioSegmentStream.setVideoBaseMediaDecodeTime(a)}),c.h264Stream.pipe(c.videoSegmentStream).pipe(c.coalesceStream));k&&!c.audioSegmentStream&&(c.coalesceStream.numberOfTracks++,c.audioSegmentStream=new t(k),c.adtsStream.pipe(c.audioSegmentStream).pipe(c.coalesceStream))}});c.coalesceStream.on("data",this.trigger.bind(this,"data"));c.coalesceStream.on("done",this.trigger.bind(this,"done"))};this.setBaseMediaDecodeTime=function(a){var b=this.transmuxPipeline_;this.baseMediaDecodeTime=a;k&&(k.timelineStartInfo.dts=void 0,k.timelineStartInfo.pts=void 0,m(k),k.timelineStartInfo.baseMediaDecodeTime=a,b.audioTimestampRolloverStream&&b.audioTimestampRolloverStream.discontinuity());e&&(b.videoSegmentStream&&(b.videoSegmentStream.gopCache_=[],b.videoTimestampRolloverStream.discontinuity()),e.timelineStartInfo.dts=void 0,e.timelineStartInfo.pts=void 0,m(e),e.timelineStartInfo.baseMediaDecodeTime=a);b.timedMetadataTimestampRolloverStream&&b.timedMetadataTimestampRolloverStream.discontinuity()};this.setAudioAppendStart=function(a){k&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(a)};this.push=function(a){if(c){var b=x(a);b&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():b||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline();c=!1}this.transmuxPipeline_.headOfPipeline.push(a)};this.flush=function(){c=!0;this.transmuxPipeline_.headOfPipeline.flush()}};v.prototype=new l;q.exports={Transmuxer:v,VideoSegmentStream:u,AudioSegmentStream:t,AUDIO_PROPERTIES:c,VIDEO_PROPERTIES:r}},{"../aac":33,"../codecs/adts.js":35,"../codecs/h264":36,"../data/silence":37,"../m2ts/m2ts.js":45,"../utils/clock":55,"../utils/stream.js":57,"./mp4-generator.js":51}],54:[function(k,q,l){var e=k("../m2ts/stream-types.js"),h=k("../m2ts/timestamp-rollover-stream.js").handleRollover,n,f;n=k("../m2ts/probe.js");f=k("../aac/probe.js");var d=function(b,a){if(b.audio&&b.audio.length){var c=a;"undefined"===typeof c&&(c=b.audio[0].dts);b.audio.forEach(function(a){a.dts=h(a.dts,c);a.pts=h(a.pts,c);a.dtsTime=a.dts/9E4;a.ptsTime=a.pts/9E4})}if(b.video&&b.video.length){var d=a;"undefined"===typeof d&&(d=b.video[0].dts);b.video.forEach(function(a){a.dts=h(a.dts,d);a.pts=h(a.pts,d);a.dtsTime=a.dts/9E4;a.ptsTime=a.pts/9E4});if(b.firstKeyFrame){var e=b.firstKeyFrame;e.dts=h(e.dts,d);e.pts=h(e.pts,d);e.dtsTime=e.dts/9E4;e.ptsTime=e.dts/9E4}}};q.exports={inspect:function(b,a){var c;c=73===b[0]&&68===b[1]&&51===b[2]?!0:!1;var h;if(c)a:{var k=!1;h=0;var l=null;c=null;for(var q,g=0,p;3<=b.length-g;){switch(f.parseType(b,g)){case "timed-metadata":if(10>b.length-g){k=!0;break}q=f.parseId3TagSize(b,g);if(q>b.length){k=!0;break}null===c&&(p=b.subarray(g,g+q),c=f.parseAacTimestamp(p));g+=q;break;case "audio":if(7>b.length-g){k=!0;break}q=f.parseAdtsSize(b,g);if(q>b.length){k=!0;break}null===l&&(p=b.subarray(g,g+q),l=f.parseSampleRate(p));h++;g+=q;break;default:g++}if(k){h=null;break a}}null===l||null===c?h=null:(k=9E4/l,h={audio:[{type:"audio",dts:c,pts:c},{type:"audio",dts:c+1024*h*k,pts:c+1024*h*k}]})}else{c={pid:null,table:null};k={};l=0;for(q=188;q<b.byteLength;)if(71===b[l]&&71===b[q]){g=b.subarray(l,q);p=n.parseType(g,c.pid);switch(p){case "pat":c.pid||(c.pid=n.parsePat(g));break;case "pmt":c.table||(c.table=n.parsePmt(g))}if(c.pid&&c.table)break;l+=188;q+=188}else l++,q++;for(h in c.table)if(c.table.hasOwnProperty(h))switch(c.table[h]){case e.H264_STREAM_TYPE:k.video=[];l=b;q=c;g=k;p=0;var x=188,w,m,C,y,z=!1,B=[];for(y=0;x<l.byteLength;)if(71===l[p]&&71===l[x]){w=l.subarray(p,x);m=n.parseType(w,q.pid);switch(m){case "pes":if(C=n.parsePesType(w,q.table),m=n.parsePayloadUnitStartIndicator(w),"video"===C)if(m&&!z&&(C=n.parsePesTime(w))&&(C.type="video",g.video.push(C),z=!0),!g.firstKeyFrame){if(m&&0!==y){y=new Uint8Array(y);for(m=0;B.length;)C=B.shift(),y.set(C,m),m+=C.byteLength;n.videoPacketContainsKeyFrame(y)&&(g.firstKeyFrame=n.parsePesTime(y),g.firstKeyFrame.type="video");y=0}B.push(w);y+=w.byteLength}}if(z&&g.firstKeyFrame)break;p+=188;x+=188}else p++,x++;x=l.byteLength;p=x-188;for(z=!1;0<=p;)if(71===l[p]&&71===l[x]){w=l.subarray(p,x);m=n.parseType(w,q.pid);switch(m){case "pes":if(C=n.parsePesType(w,q.table),m=n.parsePayloadUnitStartIndicator(w),"video"===C&&m&&(C=n.parsePesTime(w)))C.type="video",g.video.push(C),z=!0}if(z)break;p-=188;x-=188}else p--,x--;0===k.video.length&&delete k.video;break;case e.ADTS_STREAM_TYPE:k.audio=[];l=b;q=c;g=k;p=0;x=188;for(w=!1;x<l.byteLength;)if(71===l[p]&&71===l[x]){z=l.subarray(p,x);B=n.parseType(z,q.pid);switch(B){case "pes":if(B=n.parsePesType(z,q.table),y=n.parsePayloadUnitStartIndicator(z),"audio"===B&&y&&(z=n.parsePesTime(z)))z.type="audio",g.audio.push(z),w=!0}if(w)break;p+=188;x+=188}else p++,x++;x=l.byteLength;p=x-188;for(w=!1;0<=p;)if(71===l[p]&&71===l[x]){z=l.subarray(p,x);B=n.parseType(z,q.pid);switch(B){case "pes":if(B=n.parsePesType(z,q.table),y=n.parsePayloadUnitStartIndicator(z),"audio"===B&&y&&(z=n.parsePesTime(z)))z.type="audio",g.audio.push(z),w=!0}if(w)break;p-=188;x-=188}else p--,x--;0===k.audio.length&&delete k.audio}h=k}if(!h||!h.audio&&!h.video)return null;d(h,a);return h}}},{"../aac/probe.js":34,"../m2ts/probe.js":47,"../m2ts/stream-types.js":48,"../m2ts/timestamp-rollover-stream.js":49}],55:[function(k,q,l){var e,h,n,f;e=function(d){return 9E4*d};h=function(d,b){return d*b};n=function(d){return d/9E4};f=function(d,b){return d/b};q.exports={secondsToVideoTs:e,secondsToAudioTs:h,videoTsToSeconds:n,audioTsToSeconds:f,audioTsToVideoTs:function(d,b){return e(f(d,b))},videoTsToAudioTs:function(d,b){return h(n(d),b)}}},{}],56:[function(k,q,l){q.exports=function(e){var h=e.byteLength,k=0,f=0;this.length=function(){return 8*h};this.bitsAvailable=function(){return 8*h+f};this.loadWord=function(){var d=e.byteLength-h,b=new Uint8Array(4),a=Math.min(4,h);if(0===a)throw Error("no bytes available");b.set(e.subarray(d,d+a));k=(new DataView(b.buffer)).getUint32(0);f=8*a;h-=a};this.skipBits=function(d){var b;f>d||(d-=f,b=Math.floor(d/8),d-=8*b,h-=b,this.loadWord());k<<=d;f-=d};this.readBits=function(d){var b=Math.min(f,d),a=k>>>32-b;f-=b;0<f?k<<=b:0<h&&this.loadWord();b=d-b;return 0<b?a<<b|this.readBits(b):a};this.skipLeadingZeros=function(){var d;for(d=0;d<f;++d)if(0!==(k&2147483648>>>d))return k<<=d,f-=d,d;this.loadWord();return d+this.skipLeadingZeros()};this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())};this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())};this.readUnsignedExpGolomb=function(){var d=this.skipLeadingZeros();return this.readBits(d+1)-1};this.readExpGolomb=function(){var d=this.readUnsignedExpGolomb();return 1&d?1+d>>>1:-1*(d>>>1)};this.readBoolean=function(){return 1===this.readBits(1)};this.readUnsignedByte=function(){return this.readBits(8)};this.loadWord()}},{}],57:[function(k,q,l){k=function(){this.init=function(){var e={};this.on=function(h,k){e[h]||(e[h]=[]);e[h]=e[h].concat(k)};this.off=function(h,k){var f;if(!e[h])return!1;f=e[h].indexOf(k);e[h]=e[h].slice();e[h].splice(f,1);return-1<f};this.trigger=function(h){var k,f,d,b;if(k=e[h])if(2===arguments.length)for(d=k.length,f=0;f<d;++f)k[f].call(this,arguments[1]);else{b=[];for(f=1;f<arguments.length;++f)b.push(arguments[f]);d=k.length;for(f=0;f<d;++f)k[f].apply(this,b)}};this.dispose=function(){e={}}}};k.prototype.pipe=function(e){this.on("data",function(h){e.push(h)});this.on("done",function(h){e.flush(h)});return e};k.prototype.push=function(e){this.trigger("data",e)};k.prototype.flush=function(e){this.trigger("done",e)};q.exports=k},{}],58:[function(k,q,l){var e;q.exports=function(h){var k=e[h.byteLength%16||0],f=new Uint8Array(h.byteLength+k.length);f.set(h);f.set(k,h.byteLength);return f};e=[[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],[15,15,15,15,15,15,15,15,15,15,15,15,15,15,15],[14,14,14,14,14,14,14,14,14,14,14,14,14,14],[13,13,13,13,13,13,13,13,13,13,13,13,13],[12,12,12,12,12,12,12,12,12,12,12,12],[11,11,11,11,11,11,11,11,11,11,11],[10,10,10,10,10,10,10,10,10,10],[9,9,9,9,9,9,9,9,9],[8,8,8,8,8,8,8,8],[7,7,7,7,7,7,7],[6,6,6,6,6,6],[5,5,5,5,5],[4,4,4,4],[3,3,3],[2,2],[1]]},{}],59:[function(k,q,l){l.pad=k("./pad.js");l.unpad=k("./unpad.js")},{"./pad.js":58,"./unpad.js":60}],60:[function(k,q,l){q.exports=function(e){return e.subarray(0,e.byteLength-e[e.byteLength-1])}},{}],61:[function(k,q,l){(function(e){var h={buildAbsoluteURL:function(e,f){f=f.trim();if(/^[a-z]+:/i.test(f))return f;var d=null,b=null,a=/^([^#]*)(.*)$/.exec(f);a&&(b=a[2],f=a[1]);if(a=/^([^\?]*)(.*)$/.exec(f))d=a[2],f=a[1];(a=/^([^#]*)(.*)$/.exec(e))&&(e=a[1]);(a=/^([^\?]*)(.*)$/.exec(e))&&(e=a[1]);var c=/^(([a-z]+:)?\/\/[^:\/]+(:[0-9]+)?)?(\/?.*)$/i.exec(e);if(!c)throw Error("Error trying to parse base URL.");var a=c[2]||"",k=c[1]||"",c=c[4];0!==c.indexOf("/")&&""!==k&&(c="/"+c);a=/^\/\//.test(f)?a+"//"+h.buildAbsolutePath("",f.substring(2)):/^\//.test(f)?k+"/"+h.buildAbsolutePath("",f.substring(1)):h.buildAbsolutePath(k+c,f);d&&(a+=d);b&&(a+=b);return a},buildAbsolutePath:function(e,f){for(var d,b="",a=e.replace(/[^\/]*$/,f.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),c,h=0;c=a.indexOf("/../",h),-1<c;h=c+d)d=/^\/(?:\.\.\/)*/.exec(a.slice(c))[0].length,b=(b+a.substring(h,c)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(d-1)/3+"}$"),"/");return b+a.substr(h)}};"object"===typeof l&&"object"===typeof q?q.exports=h:"object"===typeof l?l.URLToolkit=h:e.URLToolkit=h})(this)},{}],62:[function(k,q,l){(function(e){Object.defineProperty(l,"__esModule",{value:!0});var h=k("global/window"),n=h&&h.__esModule?h:{"default":h},f=(e="undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null)&&e.__esModule?e:{"default":e},d=function(a){Object.defineProperties(a.frame,{id:{get:function(){f["default"].log.warn("cue.frame.id is deprecated. Use cue.value.key instead.");return a.value.key}},value:{get:function(){f["default"].log.warn("cue.frame.value is deprecated. Use cue.value.data instead.");return a.value.data}},privateData:{get:function(){f["default"].log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead.");return a.value.data}}})},b=function(a){return isNaN(a)||Infinity===Math.abs(a)?Number.MAX_VALUE:a};l["default"]={addTextTrackData:function(a,c,e){var f=n["default"].WebKitDataCue||n["default"].VTTCue;c&&c.forEach(function(a){this.inbandTextTrack_.addCue(new f(a.startTime+this.timestampOffset,a.endTime+this.timestampOffset,a.text))},a);e&&function(){var c=b(a.mediaSource_.duration);e.forEach(function(a){var b=a.cueTime+this.timestampOffset;a.frames.forEach(function(a){var c=new f(b,b,a.value||a.url||a.data||"");c.frame=a;c.value=a;d(c);this.metadataTrack_.addCue(c)},this)},a);a.metadataTrack_&&a.metadataTrack_.cues&&a.metadataTrack_.cues.length&&function(){for(var b=a.metadataTrack_.cues,d=[],e=0;e<b.length;e++)b[e]&&d.push(b[e]);var f=d.reduce(function(a,b){var c=a[b.startTime]||[];c.push(b);a[b.startTime]=c;return a},{}),h=Object.keys(f).sort(function(a,b){return Number(a)-Number(b)});h.forEach(function(a,b){var d=Number(h[b+1])||c;f[a].forEach(function(a){a.endTime=d})})}()}()},durationOfVideo:b};q.exports=l["default"]}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"global/window":27}],63:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});var e=function(e,k,f){for(var d=e.remoteTextTracks()||[],b=0;b<d.length;b++){var a=d[b];a.kind===k&&a.label===f&&e.removeRemoteTextTrack(a)}};l.removeExistingTrack=e;l.cleanupTextTracks=function(h){e(h,"captions","cc1");e(h,"metadata","Timed Metadata")}},{}],64:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});l["default"]={isAudioCodec:function(e){return/mp4a\.\d+.\d+/i.test(e)},parseContentType:function(e){var h={type:"",parameters:{}};e=e.trim().split(";");h.type=e.shift().trim();e.forEach(function(e){var f=e.trim().split("\x3d");1<f.length&&(e=f[0].replace(/"/g,"").trim(),f=f[1].replace(/"/g,"").trim(),h.parameters[e]=f)});return h},isVideoCodec:function(e){return/avc1\.[\da-f]+/i.test(e)},translateLegacyCodecs:function(e){return e.map(function(e){return e.replace(/avc1\.(\d+)\.(\d+)/i,function(e,f,d){e=("00"+Number(f).toString(16)).slice(-2);d=("00"+Number(d).toString(16)).slice(-2);return"avc1."+e+"00"+d})})}};q.exports=l["default"]},{}],65:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});var e=k("./cleanup-text-tracks");l["default"]=function(h,k,f){k=k.player_;f.captions&&f.captions.length&&!h.inbandTextTrack_&&((0,e.removeExistingTrack)(k,"captions","cc1"),h.inbandTextTrack_=k.addRemoteTextTrack({kind:"captions",label:"cc1"},!1).track,k.tech_.trigger({type:"usage",name:"hls-608"}));f.metadata&&f.metadata.length&&!h.metadataTrack_&&((0,e.removeExistingTrack)(k,"metadata","Timed Metadata",!0),h.metadataTrack_=k.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,h.metadataTrack_.inBandMetadataTrackDispatchType=f.metadata.dispatchType)};q.exports=l["default"]},{"./cleanup-text-tracks":63}],66:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});l["default"]={TIME_BETWEEN_CHUNKS:1,BYTES_PER_CHUNK:32768};q.exports=l["default"]},{}],67:[function(k,q,l){(function(e){function h(a){return a&&a.__esModule?a:{"default":a}}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(l,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),d=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},b=k("global/document"),a=h(b),c=h("undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null);e=k("./flash-source-buffer");var r=h(e);e=k("./flash-constants");e=h(e);var u=k("./codec-utils"),t=k("./cleanup-text-tracks"),b=function(b){function e(){var b=this;if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");d(Object.getPrototypeOf(e.prototype),"constructor",this).call(this);this.sourceBuffers=[];this.readyState="closed";this.on(["sourceopen","webkitsourceopen"],function(d){b.swfObj=a["default"].getElementById(d.swfId);b.player_=(0,c["default"])(b.swfObj.parentNode);b.tech_=b.swfObj.tech;b.readyState="open";b.tech_.on("seeking",function(){for(var a=b.sourceBuffers.length;a--;)b.sourceBuffers[a].abort()});if(b.tech_.hls)b.tech_.hls.on("dispose",function(){(0,t.cleanupTextTracks)(b.player_)});b.swfObj&&b.swfObj.vjs_load()})}n(e,b);f(e,[{key:"addSeekableRange_",value:function(){}},{key:"addSourceBuffer",value:function(a){a=(0,u.parseContentType)(a);if("video/mp2t"===a.type||"audio/mp2t"===a.type)a=new r["default"](this);else throw Error("NotSupportedError (Video.js)");this.sourceBuffers.push(a);return a}},{key:"endOfStream",value:function(a){"network"===a?this.tech_.error(2):"decode"===a&&this.tech_.error(3);"ended"!==this.readyState&&(this.readyState="ended",this.swfObj.vjs_endOfStream())}}]);return e}(c["default"].EventTarget);l["default"]=b;try{Object.defineProperty(b.prototype,"duration",{get:function(){return this.swfObj?this.swfObj.vjs_getProperty("duration"):NaN},set:function(a){var b,c=this.swfObj.vjs_getProperty("duration");this.swfObj.vjs_setProperty("duration",a);if(a<c)for(b=0;b<this.sourceBuffers.length;b++)this.sourceBuffers[b].remove(a,c);return a}})}catch(g){b.prototype.duration=NaN}for(var v in e["default"])b[v]=e["default"][v];q.exports=l["default"]}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./cleanup-text-tracks":63,"./codec-utils":64,"./flash-constants":66,"./flash-source-buffer":68,"global/document":26}],68:[function(k,q,l){(function(e){function h(a){return a&&a.__esModule?a:{"default":a}}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(l,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),d=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},b=k("global/window"),a=h(b),c=h("undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null);e=k("mux.js/lib/flv");var r=h(e);e=k("./remove-cues-from-track");var u=h(e);e=k("./create-text-tracks-if-necessary");var t=h(e),v=k("./add-text-track-data");e=k("./flash-transmuxer-worker");var g=h(e);e=k("webworkify");var p=h(e);e=k("./flash-constants");var x=h(e),w=function(b){a["default"].setTimeout(b,x["default"].TIME_BETWEEN_CHUNKS)},m=function(a,b){if("number"!==typeof b||0>b)b=0;var c=Math.pow(10,b);return Math.round(a*c)/c};e=function(b){function e(b){var f=this;if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");d(Object.getPrototypeOf(e.prototype),"constructor",this).call(this);var h=void 0;this.chunkSize_=x["default"].BYTES_PER_CHUNK;this.buffer_=[];this.bufferSize_=0;this.basePtsOffset_=NaN;this.mediaSource_=b;this.videoBufferEnd_=this.audioBufferEnd_=NaN;this.updating=!1;this.timestampOffset_=0;h=a["default"].btoa(String.fromCharCode.apply(null,Array.prototype.slice.call(r["default"].getFlvHeader())));b=this.mediaSource_.player_.id().replace(/[^a-zA-Z0-9]/g,"_");this.flashEncodedHeaderName_="vjs_flashEncodedHeader_"+b+Math.random().toString(36).slice(2,8);this.flashEncodedDataName_="vjs_flashEncodedData_"+b+Math.random().toString(36).slice(2,8);a["default"][this.flashEncodedHeaderName_]=function(){delete a["default"][f.flashEncodedHeaderName_];return h};this.mediaSource_.swfObj.vjs_appendChunkReady(this.flashEncodedHeaderName_);this.transmuxer_=(0,p["default"])(g["default"]);this.transmuxer_.postMessage({action:"init",options:{}});this.transmuxer_.onmessage=function(a){"data"===a.data.action&&f.receiveBuffer_(a.data.segment)};this.one("updateend",function(){f.mediaSource_.tech_.trigger("loadedmetadata")});Object.defineProperty(this,"timestampOffset",{get:function(){return this.timestampOffset_},set:function(a){"number"===typeof a&&0<=a&&(this.timestampOffset_=a,this.mediaSource_.swfObj.vjs_discontinuity(),this.videoBufferEnd_=this.audioBufferEnd_=this.basePtsOffset_=NaN,this.transmuxer_.postMessage({action:"reset"}))}});Object.defineProperty(this,"buffered",{get:function(){if(!(this.mediaSource_&&this.mediaSource_.swfObj&&"vjs_getProperty"in this.mediaSource_.swfObj))return c["default"].createTimeRange();var a=this.mediaSource_.swfObj.vjs_getProperty("buffered");a&&a.length&&(a[0][0]=m(a[0][0],3),a[0][1]=m(a[0][1],3));return c["default"].createTimeRanges(a)}});this.mediaSource_.player_.on("seeked",function(){(0,u["default"])(0,Infinity,f.metadataTrack_);(0,u["default"])(0,Infinity,f.inbandTextTrack_)});this.mediaSource_.player_.tech_.hls.on("dispose",function(){f.transmuxer_.terminate()})}n(e,b);f(e,[{key:"appendBuffer",value:function(a){if(this.updating)throw a=Error("SourceBuffer.append() cannot be called while an update is in progress"),a.name="InvalidStateError",a.code=11,a;this.updating=!0;this.mediaSource_.readyState="open";this.trigger({type:"update"});this.transmuxer_.postMessage({action:"push",data:a.buffer,byteOffset:a.byteOffset,byteLength:a.byteLength},[a.buffer]);this.transmuxer_.postMessage({action:"flush"})}},{key:"abort",value:function(){this.buffer_=[];this.bufferSize_=0;this.mediaSource_.swfObj.vjs_abort();this.updating&&(this.updating=!1,this.trigger({type:"updateend"}))}},{key:"remove",value:function(a,b){(0,u["default"])(a,b,this.metadataTrack_);(0,u["default"])(a,b,this.inbandTextTrack_);this.trigger({type:"update"});this.trigger({type:"updateend"})}},{key:"receiveBuffer_",value:function(a){var b=this;(0,t["default"])(this,this.mediaSource_,a);(0,v.addTextTrackData)(this,a.captions,a.metadata);w(function(){var c=b.convertTagsToData_(a);0===b.buffer_.length&&w(b.processBuffer_.bind(b));c&&(b.buffer_.push(c),b.bufferSize_+=c.byteLength)})}},{key:"processBuffer_",value:function(){var b=this,c=x["default"].BYTES_PER_CHUNK;if(this.buffer_.length){var d=this.buffer_[0].subarray(0,c);d.byteLength<c||this.buffer_[0].byteLength===c?this.buffer_.shift():this.buffer_[0]=this.buffer_[0].subarray(c);this.bufferSize_-=d.byteLength;for(var c=[],e=d.byteLength,f=0;f<e;f++)c.push(String.fromCharCode(d[f]));var g=a["default"].btoa(c.join(""));a["default"][this.flashEncodedDataName_]=function(){w(b.processBuffer_.bind(b));delete a["default"][b.flashEncodedDataName_];return g};this.mediaSource_.swfObj.vjs_appendChunkReady(this.flashEncodedDataName_)}else!1!==this.updating&&(this.updating=!1,this.trigger({type:"updateend"}))}},{key:"convertTagsToData_",value:function(a){var b=0,c=this.mediaSource_.tech_,d=0,e=a.tags.videoTags;a=a.tags.audioTags;isNaN(this.basePtsOffset_)&&(e.length||a.length)&&(this.basePtsOffset_=Math.min((a[0]||{pts:Infinity}).pts,(e[0]||{pts:Infinity}).pts));c.seeking()&&(this.audioBufferEnd_=this.videoBufferEnd_=NaN);isNaN(this.videoBufferEnd_)?(c.buffered().length&&(d=c.buffered().end(0)-this.timestampOffset),c.seeking()&&(d=Math.max(d,c.currentTime()-this.timestampOffset)),d=1E3*d+this.basePtsOffset_):d=this.videoBufferEnd_+.1;var f=e.length;if(f&&e[f-1].pts>=d){for(;--f;){var g=e[f];if(!(g.pts>d)&&(g.keyFrame||g.metaDataTag))break}for(;f&&e[f-1].metaDataTag;)f--}e=e.slice(f);g=isNaN(this.audioBufferEnd_)?d:this.audioBufferEnd_+.1;e.length&&(g=Math.min(g,e[0].pts));for(f=0;f<a.length&&!(a[f].pts>=g);)f++;a=a.slice(f);a.length&&(this.audioBufferEnd_=a[a.length-1].pts);e.length&&(this.videoBufferEnd_=e[e.length-1].pts);a=this.getOrderedTags_(e,a);if(0!==a.length){if(a[0].pts<d&&c.seeking()){f=1/30;c=c.currentTime()-(d-a[0].pts)/1E3;c<f&&(c=0);try{this.mediaSource_.swfObj.vjs_adjustCurrentTime(c)}catch(H){}}for(c=0;c<a.length;c++)b+=a[c].bytes.byteLength;b=new Uint8Array(b);for(d=c=0;c<a.length;c++)b.set(a[c].bytes,d),d+=a[c].bytes.byteLength;return b}}},{key:"getOrderedTags_",value:function(a,b){for(var c,d=[];a.length||b.length;)c=a.length?b.length?b[0].dts<a[0].dts?b.shift():a.shift():a.shift():b.shift(),d.push(c);return d}}]);return e}(c["default"].EventTarget);l["default"]=e;q.exports=l["default"]}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./add-text-track-data":62,"./create-text-tracks-if-necessary":65,"./flash-constants":66,"./flash-transmuxer-worker":69,"./remove-cues-from-track":71,"global/window":27,"mux.js/lib/flv":41,webworkify:75}],69:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),h=k("global/window"),n=h&&h.__esModule?h:{"default":h},f=(k=k("mux.js/lib/flv"))&&k.__esModule?k:{"default":k},d=function(a){a.on("data",function(a){n["default"].postMessage({action:"data",segment:a})});a.on("done",function(a){n["default"].postMessage({action:"done"})})},b=function(){function a(b){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.options=b||{};this.init()}e(a,[{key:"init",value:function(){this.transmuxer&&this.transmuxer.dispose();this.transmuxer=new f["default"].Transmuxer(this.options);d(this.transmuxer)}},{key:"push",value:function(a){a=new Uint8Array(a.data,a.byteOffset,a.byteLength);this.transmuxer.push(a)}},{key:"reset",value:function(){this.init()}},{key:"flush",value:function(){this.transmuxer.flush()}}]);return a}(),a=function(a){a.onmessage=function(a){if("init"===a.data.action&&a.data.options)this.messageHandlers=new b(a.data.options);else if(this.messageHandlers||(this.messageHandlers=new b),a.data&&a.data.action&&"init"!==a.data.action&&this.messageHandlers[a.data.action])this.messageHandlers[a.data.action](a.data)}};l["default"]=function(b){return new a(b)};q.exports=l["default"]},{"global/window":27,"mux.js/lib/flv":41}],70:[function(k,q,l){(function(e){function h(a){return a&&a.__esModule?a:{"default":a}}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(l,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),d=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},b=k("global/window"),a=h(b),b=k("global/document"),c=h(b),r=h("undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null);e=k("./virtual-source-buffer");var u=h(e),t=k("./add-text-track-data"),v=k("./codec-utils"),g=k("./cleanup-text-tracks");e=function(b){function e(){var b=this;if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");d(Object.getPrototypeOf(e.prototype),"constructor",this).call(this);var f=void 0;this.nativeMediaSource_=new a["default"].MediaSource;for(f in this.nativeMediaSource_)f in e.prototype||"function"!==typeof this.nativeMediaSource_[f]||(this[f]=this.nativeMediaSource_[f].bind(this.nativeMediaSource_));this.duration_=NaN;Object.defineProperty(this,"duration",{get:function(){return Infinity===this.duration_?this.duration_:this.nativeMediaSource_.duration},set:function(a){this.duration_=a;Infinity!==a&&(this.nativeMediaSource_.duration=a)}});Object.defineProperty(this,"seekable",{get:function(){return Infinity===this.duration_?r["default"].createTimeRanges([[0,this.nativeMediaSource_.duration]]):this.nativeMediaSource_.seekable}});Object.defineProperty(this,"readyState",{get:function(){return this.nativeMediaSource_.readyState}});Object.defineProperty(this,"activeSourceBuffers",{get:function(){return this.activeSourceBuffers_}});this.sourceBuffers=[];this.activeSourceBuffers_=[];this.updateActiveSourceBuffers_=function(){b.activeSourceBuffers_.length=0;if(1===b.sourceBuffers.length){var a=b.sourceBuffers[0];a.appendAudioInitSegment_=!0;a.audioDisabled_=!a.audioCodec_;b.activeSourceBuffers_.push(a)}else{for(var c=!1,d=!0,a=0;a<b.player_.audioTracks().length;a++){var e=b.player_.audioTracks()[a];if(e.enabled&&"main"!==e.kind){c=!0;d=!1;break}}b.sourceBuffers.forEach(function(a){a.appendAudioInitSegment_=!0;if(a.videoCodec_&&a.audioCodec_)a.audioDisabled_=c;else if(a.videoCodec_&&!a.audioCodec_)a.audioDisabled_=!0,d=!1;else if(!a.videoCodec_&&a.audioCodec_&&(a.audioDisabled_=d))return;b.activeSourceBuffers_.push(a)})}};this.onPlayerMediachange_=function(){b.sourceBuffers.forEach(function(a){a.appendAudioInitSegment_=!0})};["sourceopen","sourceclose","sourceended"].forEach(function(a){this.nativeMediaSource_.addEventListener(a,this.trigger.bind(this))},this);this.on("sourceopen",function(a){if(a=c["default"].querySelector('[src\x3d"'+b.url_+'"]'))b.player_=(0,r["default"])(a.parentNode),b.player_.audioTracks&&b.player_.audioTracks()&&(b.player_.audioTracks().on("change",b.updateActiveSourceBuffers_),b.player_.audioTracks().on("addtrack",b.updateActiveSourceBuffers_),b.player_.audioTracks().on("removetrack",b.updateActiveSourceBuffers_)),b.player_.on("mediachange",b.onPlayerMediachange_)});this.on("sourceended",function(a){a=(0,t.durationOfVideo)(b.duration);for(var c=0;c<b.sourceBuffers.length;c++){var d=b.sourceBuffers[c];(d=d.metadataTrack_&&d.metadataTrack_.cues)&&d.length&&(d[d.length-1].endTime=a)}});this.on("sourceclose",function(a){this.sourceBuffers.forEach(function(a){a.transmuxer_&&a.transmuxer_.terminate()});this.sourceBuffers.length=0;this.player_&&((0,g.cleanupTextTracks)(this.player_),this.player_.audioTracks&&this.player_.audioTracks()&&(this.player_.audioTracks().off("change",this.updateActiveSourceBuffers_),this.player_.audioTracks().off("addtrack",this.updateActiveSourceBuffers_),this.player_.audioTracks().off("removetrack",this.updateActiveSourceBuffers_)),this.player_.el_&&this.player_.off("mediachange",this.onPlayerMediachange_))})}n(e,b);f(e,[{key:"addSeekableRange_",value:function(a,b){var c;if(Infinity!==this.duration)throw c=Error("MediaSource.addSeekableRange() can only be invoked when the duration is Infinity"),c.name="InvalidStateError",c.code=11,c;if(b>this.nativeMediaSource_.duration||isNaN(this.nativeMediaSource_.duration))this.nativeMediaSource_.duration=b}},{key:"addSourceBuffer",value:function(a){var b=void 0,b=(0,v.parseContentType)(a);/^(video|audio)\/mp2t$/i.test(b.type)?(a=[],b.parameters&&b.parameters.codecs&&(a=b.parameters.codecs.split(","),a=(0,v.translateLegacyCodecs)(a),a=a.filter(function(a){return(0,v.isAudioCodec)(a)||(0,v.isVideoCodec)(a)})),0===a.length&&(a=["avc1.4d400d","mp4a.40.2"]),b=new u["default"](this,a),0!==this.sourceBuffers.length&&(this.sourceBuffers[0].createRealSourceBuffers_(),b.createRealSourceBuffers_(),this.sourceBuffers[0].audioDisabled_=!0)):b=this.nativeMediaSource_.addSourceBuffer(a);this.sourceBuffers.push(b);return b}}]);return e}(r["default"].EventTarget);l["default"]=e;q.exports=l["default"]}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./add-text-track-data":62,"./cleanup-text-tracks":63,"./codec-utils":64,"./virtual-source-buffer":74,"global/document":26,"global/window":27}],71:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});l["default"]=function(e,h,k){var f,d;if(k&&k.cues)for(f=k.cues.length;f--;)d=k.cues[f],d.startTime<=h&&d.endTime>=e&&k.removeCue(d)};q.exports=l["default"]},{}],72:[function(k,q,l){Object.defineProperty(l,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),h=k("global/window"),n=h&&h.__esModule?h:{"default":h},f=(k=k("mux.js/lib/mp4"))&&k.__esModule?k:{"default":k},d=function(a){a.on("data",function(a){var b=a.initSegment;a.initSegment={data:b.buffer,byteOffset:b.byteOffset,byteLength:b.byteLength};b=a.data;a.data=b.buffer;n["default"].postMessage({action:"data",segment:a,byteOffset:b.byteOffset,byteLength:b.byteLength},[a.data])});if(a.captionStream)a.captionStream.on("data",function(a){n["default"].postMessage({action:"caption",data:a})});a.on("done",function(a){n["default"].postMessage({action:"done"})})},b=function(){function a(b){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.options=b||{};this.init()}e(a,[{key:"init",value:function(){this.transmuxer&&this.transmuxer.dispose();this.transmuxer=new f["default"].Transmuxer(this.options);d(this.transmuxer)}},{key:"push",value:function(a){a=new Uint8Array(a.data,a.byteOffset,a.byteLength);this.transmuxer.push(a)}},{key:"reset",value:function(){this.init()}},{key:"setTimestampOffset",value:function(a){this.transmuxer.setBaseMediaDecodeTime(Math.round(9E4*(a.timestampOffset||0)))}},{key:"setAudioAppendStart",value:function(a){this.transmuxer.setAudioAppendStart(Math.ceil(9E4*a.appendStart))}},{key:"flush",value:function(a){this.transmuxer.flush()}}]);return a}(),a=function(a){a.onmessage=function(a){if("init"===a.data.action&&a.data.options)this.messageHandlers=new b(a.data.options);else if(this.messageHandlers||(this.messageHandlers=new b),a.data&&a.data.action&&"init"!==a.data.action&&this.messageHandlers[a.data.action])this.messageHandlers[a.data.action](a.data)}};l["default"]=function(b){return new a(b)};q.exports=l["default"]},{"global/window":27,"mux.js/lib/mp4":50}],73:[function(k,q,l){(function(e){function h(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(l,"__esModule",{value:!0});var n=k("global/window"),f=h(n),n=k("./flash-media-source"),d=h(n),n=k("./html-media-source"),b=h(n),a=h("undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null),c=0,q={mode:"auto"};a["default"].mediaSources={};var u=function(b,c){var d=a["default"].mediaSources[b];if(d)d.trigger({type:"sourceopen",swfId:c});else throw Error("Media Source not found (Video.js)");},t=function(){return!!f["default"].MediaSource&&!!f["default"].MediaSource.isTypeSupported&&f["default"].MediaSource.isTypeSupported('video/mp4;codecs\x3d"avc1.4d400d,mp4a.40.2"')};e=function(c){c=a["default"].mergeOptions(q,c);this.MediaSource={open:u,supportsNativeMediaSources:t};if("html5"===c.mode||"auto"===c.mode&&t())return new b["default"];if(a["default"].getTech("Flash"))return new d["default"];throw Error("Cannot use Flash or Html5 to create a MediaSource for this video");};l.MediaSource=e;e.open=u;e.supportsNativeMediaSources=t;n={createObjectURL:function(e){var g;if(e instanceof b["default"])return g=f["default"].URL.createObjectURL(e.nativeMediaSource_),e.url_=g;if(!(e instanceof d["default"]))return g=f["default"].URL.createObjectURL(e),e.url_=g;g="blob:vjs-media-source/"+c;c++;a["default"].mediaSources[g]=e;return g}};l.URL=n;a["default"].MediaSource=e;a["default"].URL=n}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./flash-media-source":67,"./html-media-source":70,"global/window":27}],74:[function(k,q,l){(function(e){function h(a){return a&&a.__esModule?a:{"default":a}}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(l,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),d=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},b=h("undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null);e=k("./create-text-tracks-if-necessary");var a=h(e);e=k("./remove-cues-from-track");var c=h(e),r=k("./add-text-track-data");e=k("webworkify");var u=h(e);e=k("./transmuxer-worker");var t=h(e),v=k("./codec-utils"),g=function(a,b){var c=a.addSourceBuffer(b),d=Object.create(null);d.updating=!1;d.realBuffer_=c;var e=function(a){"function"===typeof c[a]?d[a]=function(){return c[a].apply(c,arguments)}:"undefined"===typeof d[a]&&Object.defineProperty(d,a,{get:function(){return c[a]},set:function(b){return c[a]=b}})},f;for(f in c)e(f);return d};e=function(e){function h(a,c){var e=this;if(!(this instanceof h))throw new TypeError("Cannot call a class as a function");d(Object.getPrototypeOf(h.prototype),"constructor",this).call(this,b["default"].EventTarget);this.timestampOffset_=0;this.pendingBuffers_=[];this.bufferUpdating_=!1;this.mediaSource_=a;this.codecs_=c;this.videoCodec_=this.audioCodec_=null;this.audioDisabled_=!1;this.appendAudioInitSegment_=!0;this.codecs_.forEach(function(a){(0,v.isAudioCodec)(a)?e.audioCodec_=a:(0,v.isVideoCodec)(a)&&(e.videoCodec_=a)});this.transmuxer_=(0,u["default"])(t["default"]);this.transmuxer_.postMessage({action:"init",options:{remux:!1}});this.transmuxer_.onmessage=function(a){if("data"===a.data.action)return e.data_(a);if("done"===a.data.action)return e.done_(a)};Object.defineProperty(this,"timestampOffset",{get:function(){return this.timestampOffset_},set:function(a){"number"===typeof a&&0<=a&&(this.timestampOffset_=a,this.appendAudioInitSegment_=!0,this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:a}))}});Object.defineProperty(this,"appendWindowStart",{get:function(){return(this.videoBuffer_||this.audioBuffer_).appendWindowStart},set:function(a){this.videoBuffer_&&(this.videoBuffer_.appendWindowStart=a);this.audioBuffer_&&(this.audioBuffer_.appendWindowStart=a)}});Object.defineProperty(this,"updating",{get:function(){return!!(this.bufferUpdating_||!this.audioDisabled_&&this.audioBuffer_&&this.audioBuffer_.updating||this.videoBuffer_&&this.videoBuffer_.updating)}});Object.defineProperty(this,"buffered",{get:function(){var a=null,c=null,d=0,e=[],f=[];if(!this.videoBuffer_&&!this.audioBuffer_)return b["default"].createTimeRange();if(!this.videoBuffer_)return this.audioBuffer_.buffered;if(!this.audioBuffer_||this.audioDisabled_)return this.videoBuffer_.buffered;if(0===this.videoBuffer_.buffered.length&&0===this.audioBuffer_.buffered.length)return b["default"].createTimeRange();for(var g=this.videoBuffer_.buffered,h=this.audioBuffer_.buffered,k=g.length;k--;)e.push({time:g.start(k),type:"start"}),e.push({time:g.end(k),type:"end"});for(k=h.length;k--;)e.push({time:h.start(k),type:"start"}),e.push({time:h.end(k),type:"end"});e.sort(function(a,b){return a.time-b.time});for(k=0;k<e.length;k++)"start"===e[k].type?(d++,2===d&&(a=e[k].time)):"end"===e[k].type&&(d--,1===d&&(c=e[k].time)),null!==a&&null!==c&&(f.push([a,c]),c=a=null);return b["default"].createTimeRanges(f)}})}n(h,e);f(h,[{key:"data_",value:function(b){var c=b.data.segment;c.data=new Uint8Array(c.data,b.data.byteOffset,b.data.byteLength);c.initSegment=new Uint8Array(c.initSegment.data,c.initSegment.byteOffset,c.initSegment.byteLength);(0,a["default"])(this,this.mediaSource_,c);this.pendingBuffers_.push(c)}},{key:"done_",value:function(a){"closed"===this.mediaSource_.readyState?this.pendingBuffers_.length=0:this.processPendingSegments_()}},{key:"createRealSourceBuffers_",value:function(){var a=this,b=["audio","video"];b.forEach(function(c){if(a[c+"Codec_"]&&!a[c+"Buffer_"]){var d=null;a.mediaSource_[c+"Buffer_"]?(d=a.mediaSource_[c+"Buffer_"],d.updating=!1):(d=g(a.mediaSource_.nativeMediaSource_,c+'/mp4;codecs\x3d"'+a[c+"Codec_"]+'"'),a.mediaSource_[c+"Buffer_"]=d);a[c+"Buffer_"]=d;["update","updatestart","updateend"].forEach(function(e){d.addEventListener(e,function(){if("audio"!==c||!a.audioDisabled_)if("updateend"===e&&(a[c+"Buffer_"].updating=!1),b.every(function(b){return"audio"===b&&a.audioDisabled_?!0:c!==b&&a[b+"Buffer_"]&&a[b+"Buffer_"].updating?!1:!0}))return a.trigger(e)})})}})}},{key:"appendBuffer",value:function(a){this.bufferUpdating_=!0;if(this.audioBuffer_&&this.audioBuffer_.buffered.length){var b=this.audioBuffer_.buffered;this.transmuxer_.postMessage({action:"setAudioAppendStart",appendStart:b.end(b.length-1)})}this.transmuxer_.postMessage({action:"push",data:a.buffer,byteOffset:a.byteOffset,byteLength:a.byteLength},[a.buffer]);this.transmuxer_.postMessage({action:"flush"})}},{key:"remove",value:function(a,b){this.videoBuffer_&&(this.videoBuffer_.updating=!0,this.videoBuffer_.remove(a,b));!this.audioDisabled_&&this.audioBuffer_&&(this.audioBuffer_.updating=!0,this.audioBuffer_.remove(a,b));(0,c["default"])(a,b,this.metadataTrack_);(0,c["default"])(a,b,this.inbandTextTrack_)}},{key:"processPendingSegments_",value:function(){var a={video:{segments:[],bytes:0},audio:{segments:[],bytes:0},captions:[],metadata:[]},a=this.pendingBuffers_.reduce(function(a,b){var c=b.type,d=b.data,e=b.initSegment;a[c].segments.push(d);a[c].bytes+=d.byteLength;a[c].initSegment=e;b.captions&&(a.captions=a.captions.concat(b.captions));b.info&&(a[c].info=b.info);b.metadata&&(a.metadata=a.metadata.concat(b.metadata));return a},a);this.videoBuffer_||this.audioBuffer_||(0===a.video.bytes&&(this.videoCodec_=null),0===a.audio.bytes&&(this.audioCodec_=null),this.createRealSourceBuffers_());a.audio.info&&this.mediaSource_.trigger({type:"audioinfo",info:a.audio.info});a.video.info&&this.mediaSource_.trigger({type:"videoinfo",info:a.video.info});this.appendAudioInitSegment_&&(!this.audioDisabled_&&this.audioBuffer_&&(a.audio.segments.unshift(a.audio.initSegment),a.audio.bytes+=a.audio.initSegment.byteLength),this.appendAudioInitSegment_=!1);this.videoBuffer_&&(a.video.segments.unshift(a.video.initSegment),a.video.bytes+=a.video.initSegment.byteLength,this.concatAndAppendSegments_(a.video,this.videoBuffer_),(0,r.addTextTrackData)(this,a.captions,a.metadata));!this.audioDisabled_&&this.audioBuffer_&&this.concatAndAppendSegments_(a.audio,this.audioBuffer_);this.pendingBuffers_.length=0;this.bufferUpdating_=!1}},{key:"concatAndAppendSegments_",value:function(a,b){var c=0,d=void 0;if(a.bytes){d=new Uint8Array(a.bytes);a.segments.forEach(function(a){d.set(a,c);c+=a.byteLength});try{b.updating=!0,b.appendBuffer(d)}catch(z){this.mediaSource_.player_&&this.mediaSource_.player_.error({code:-3,type:"APPEND_BUFFER_ERR",message:z.message,originalError:z})}}}},{key:"abort",value:function(){this.videoBuffer_&&this.videoBuffer_.abort();!this.audioDisabled_&&this.audioBuffer_&&this.audioBuffer_.abort();this.transmuxer_&&this.transmuxer_.postMessage({action:"reset"});this.pendingBuffers_.length=0;this.bufferUpdating_=!1}}]);return h}(b["default"].EventTarget);l["default"]=e;q.exports=l["default"]}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./add-text-track-data":62,"./codec-utils":64,"./create-text-tracks-if-necessary":65,"./remove-cues-from-track":71,"./transmuxer-worker":72,webworkify:75}],75:[function(k,q,l,e,h,n){var f=JSON.stringify;q.exports=function(d){for(var b,a=Object.keys(n),c=0,k=a.length;c<k;c++){var l=a[c];if(n[l].exports===d){b=l;break}}if(!b){b=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var q={},c=0,k=a.length;c<k;c++)l=a[c],q[l]=l;h[b]=[Function(["require","module","exports"],"("+d+")(self)"),q]}d=Math.floor(Math.pow(16,8)*Math.random()).toString(16);a={};a[b]=b;h[d]=[Function(["require"],"require("+f(b)+")(self)"),a];b="("+e+")({"+Object.keys(h).map(function(a){return f(a)+":["+h[a][0]+","+f(h[a][1])+"]"}).join(",")+"},{},["+f(d)+"])";return new Worker((window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(new Blob([b],{type:"text/javascript"})))}},{}],76:[function(k,q,l){(function(e){function h(a){return a&&a.__esModule?a:{"default":a}}function l(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),d=function(a,b,c){var d=!0;for(;d;)if(null===a&&(a=Function.prototype),d=Object.getOwnPropertyDescriptor(a,b),void 0===d){a=Object.getPrototypeOf(a);if(null===a)break;d=!0}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},b=k("global/document"),a=h(b),b=k("./playlist-loader"),b=h(b),c=k("./playlist"),c=h(c),r=k("./xhr"),u=h(r),t=k("aes-decrypter"),r=k("./bin-utils"),v=h(r),r=k("videojs-contrib-media-sources"),g=k("m3u8-parser"),g=h(g),p=h("undefined"!==typeof window?window.videojs:"undefined"!==typeof e?e.videojs:null),x=k("./master-playlist-controller");e=k("./config");var w=h(e);e=k("./rendition-mixin");var m=h(e);e=k("global/window");e=h(e);var C=k("./playback-watcher"),y=h(C),C=k("./reload-source-on-error"),C=h(C),z=k("./playlist-selectors.js"),B={PlaylistLoader:b["default"],Playlist:c["default"],Decrypter:t.Decrypter,AsyncStream:t.AsyncStream,decrypt:t.decrypt,utils:v["default"],STANDARD_PLAYLIST_SELECTOR:z.lastBandwidthSelector,comparePlaylistBandwidth:z.comparePlaylistBandwidth,comparePlaylistResolution:z.comparePlaylistResolution,xhr:(0,u["default"])()};"GOAL_BUFFER_LENGTH MAX_GOAL_BUFFER_LENGTH GOAL_BUFFER_LENGTH_RATE BUFFER_LOW_WATER_LINE MAX_BUFFER_LOW_WATER_LINE BUFFER_LOW_WATER_LINE_RATE BANDWIDTH_VARIANCE".split(" ").forEach(function(a){Object.defineProperty(B,a,{get:function(){p["default"].log.warn("using Hls."+a+" is UNSAFE be sure you know what you are doing");return w["default"][a]},set:function(b){p["default"].log.warn("using Hls."+a+" is UNSAFE be sure you know what you are doing");"number"!==typeof b||0>b?p["default"].log.warn("value of Hls."+a+" must be greater than or equal to 0"):w["default"][a]=b}})});var A=function(a,b){for(var c=b.media(),d=-1,e=0;e<a.length;e++)if(a[e].id===c.uri){d=e;break}a.selectedIndex_=d;a.trigger({selectedIndex:d,type:"change"})},E=function(a,b){b.representations().forEach(function(b){a.addQualityLevel(b)});A(a,b.playlists)};B.canPlaySource=function(){return p["default"].log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};B.supportsNativeHls=function(){var b=a["default"].createElement("video");return p["default"].getTech("Html5").isSupported()?"application/vnd.apple.mpegurl audio/mpegurl audio/x-mpegurl application/x-mpegurl video/x-mpegurl video/mpegurl application/mpegurl".split(" ").some(function(a){return/maybe|probably/i.test(b.canPlayType(a))}):!1}();B.isSupported=function(){return p["default"].log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var F=e["default"].navigator&&e["default"].navigator.userAgent||"";B.supportsAudioInfoChange_=function(){if(p["default"].browser.IS_FIREFOX){var a=/Firefox\/([\d.]+)/i.exec(F);return 49<=parseInt(a[1],10)}return!0};var D=function(b){function c(b,e,f){var g=this;if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");d(Object.getPrototypeOf(c.prototype),"constructor",this).call(this,e,f.hls);e.options_&&e.options_.playerId&&(f=(0,p["default"])(e.options_.playerId),f.hasOwnProperty("hls")||Object.defineProperty(f,"hls",{get:function(){p["default"].log.warn("player.hls is deprecated. Use player.tech_.hls instead.");e.trigger({type:"usage",name:"hls-player-access"});return g}}));this.tech_=e;this.source_=b;this.stats={};this.ignoreNextSeekingEvent_=!1;this.setOptions_();if(this.options_.overrideNative&&(e.featuresNativeVideoTracks||e.featuresNativeAudioTracks))throw Error("Overriding native HLS requires emulated tracks. See https://git.io/vMpjB");this.on(a["default"],["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],function(b){(b=a["default"].fullscreenElement||a["default"].webkitFullscreenElement||a["default"].mozFullScreenElement||a["default"].msFullscreenElement)&&b.contains(g.tech_.el())&&g.masterPlaylistController_.fastQualityChange_()});this.on(this.tech_,"seeking",function(){this.ignoreNextSeekingEvent_?this.ignoreNextSeekingEvent_=!1:this.setCurrentTime(this.tech_.currentTime())});this.on(this.tech_,"error",function(){this.masterPlaylistController_&&this.masterPlaylistController_.pauseLoading()});this.audioTrackChange_=function(){g.masterPlaylistController_.setupAudio();g.tech_.trigger({type:"usage",name:"hls-audio-change"})};this.textTrackChange_=function(){g.masterPlaylistController_.setupSubtitles()};this.on(this.tech_,"play",this.play)}l(c,b);f(c,[{key:"setOptions_",value:function(){var a=this;this.options_.withCredentials=this.options_.withCredentials||!1;"number"!==typeof this.options_.blacklistDuration&&(this.options_.blacklistDuration=300);"number"!==typeof this.options_.bandwidth&&(this.options_.bandwidth=p["default"].browser.IS_ANDROID?5E5:4194304);["withCredentials","bandwidth"].forEach(function(b){"undefined"!==typeof a.source_[b]&&(a.options_[b]=a.source_[b])});this.bandwidth=this.options_.bandwidth}},{key:"src",value:function(a){var b=this;a&&(this.setOptions_(),this.options_.url=this.source_.src,this.options_.tech=this.tech_,this.options_.externHls=B,this.masterPlaylistController_=new x.MasterPlaylistController(this.options_),this.playbackWatcher_=new y["default"](p["default"].mergeOptions(this.options_,{seekable:function(){return b.seekable()}})),this.masterPlaylistController_.on("error",function(){p["default"].players[b.tech_.options_.playerId].error(b.masterPlaylistController_.error)}),this.masterPlaylistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):B.STANDARD_PLAYLIST_SELECTOR.bind(this),this.playlists=this.masterPlaylistController_.masterPlaylistLoader_,this.mediaSource=this.masterPlaylistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get:function(){return this.masterPlaylistController_.selectPlaylist},set:function(a){this.masterPlaylistController_.selectPlaylist=a.bind(this)}},throughput:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate},set:function(a){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=a;this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.bandwidth},set:function(a){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=a;this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get:function(){return Math.floor(1/(1/(this.bandwidth||1)+(0<this.throughput?1/this.throughput:0)))},set:function(){p["default"].log.error('The "systemBandwidth" property is read-only')}}}),Object.defineProperties(this.stats,{bandwidth:{get:function(){return b.bandwidth||0},enumerable:!0},mediaRequests:{get:function(){return b.masterPlaylistController_.mediaRequests_()||0},enumerable:!0},mediaRequestsAborted:{get:function(){return b.masterPlaylistController_.mediaRequestsAborted_()||0},enumerable:!0},mediaRequestsTimedout:{get:function(){return b.masterPlaylistController_.mediaRequestsTimedout_()||0},enumerable:!0},mediaRequestsErrored:{get:function(){return b.masterPlaylistController_.mediaRequestsErrored_()||0},enumerable:!0},mediaTransferDuration:{get:function(){return b.masterPlaylistController_.mediaTransferDuration_()||0},enumerable:!0},mediaBytesTransferred:{get:function(){return b.masterPlaylistController_.mediaBytesTransferred_()||0},enumerable:!0},mediaSecondsLoaded:{get:function(){return b.masterPlaylistController_.mediaSecondsLoaded_()||0},enumerable:!0}}),this.tech_.one("canplay",this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_)),this.masterPlaylistController_.on("sourceopen",function(){b.tech_.audioTracks().addEventListener("change",b.audioTrackChange_);b.tech_.remoteTextTracks().addEventListener("change",b.textTrackChange_)}),this.masterPlaylistController_.on("selectedinitialmedia",function(){(0,m["default"])(b)}),this.masterPlaylistController_.on("audioupdate",function(){b.tech_.clearTracks("audio");b.masterPlaylistController_.activeAudioGroup().forEach(function(a){b.tech_.audioTracks().addTrack(a)})}),this.on(this.masterPlaylistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.masterPlaylistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.tech_.ready(function(){return b.setupQualityLevels_()}),this.tech_.el()&&this.tech_.src(p["default"].URL.createObjectURL(this.masterPlaylistController_.mediaSource)))}},{key:"setupQualityLevels_",value:function(){var a=this,b=p["default"].players[this.tech_.options_.playerId];b&&b.qualityLevels&&(this.qualityLevels_=b.qualityLevels(),this.masterPlaylistController_.on("selectedinitialmedia",function(){E(a.qualityLevels_,a)}),this.playlists.on("mediachange",function(){A(a.qualityLevels_,a.playlists)}))}},{key:"activeAudioGroup_",value:function(){return this.masterPlaylistController_.activeAudioGroup()}},{key:"play",value:function(){this.masterPlaylistController_.play()}},{key:"setCurrentTime",value:function(a){this.masterPlaylistController_.setCurrentTime(a)}},{key:"duration",value:function(){return this.masterPlaylistController_.duration()}},{key:"seekable",value:function(){return this.masterPlaylistController_.seekable()}},{key:"dispose",value:function(){this.playbackWatcher_&&this.playbackWatcher_.dispose();this.masterPlaylistController_&&this.masterPlaylistController_.dispose();this.qualityLevels_&&this.qualityLevels_.dispose();this.tech_.audioTracks().removeEventListener("change",this.audioTrackChange_);this.tech_.remoteTextTracks().removeEventListener("change",this.textTrackChange_);d(Object.getPrototypeOf(c.prototype),"dispose",this).call(this)}}]);return c}(p["default"].getComponent("Component")),b=function H(a){return{canHandleSource:function(b){var c=p["default"].mergeOptions(p["default"].options,1>=arguments.length||void 0===arguments[1]?{}:arguments[1]);return c.hls&&c.hls.mode&&c.hls.mode!==a?!1:H.canPlayType(b.type,c)},handleSource:function(b,c){var d=p["default"].mergeOptions(p["default"].options,2>=arguments.length||void 0===arguments[2]?{}:arguments[2],{hls:{mode:a}});"flash"===a&&c.setTimeout(function(){c.trigger("loadstart")},1);c.hls=new D(b,c,d);c.hls.xhr=(0,u["default"])();c.hls.src(b.src);return c.hls},canPlayType:function(a){var b=p["default"].mergeOptions(p["default"].options,1>=arguments.length||void 0===arguments[1]?{}:arguments[1]);return H.canPlayType(a,b)?"maybe":""}}};b.canPlayType=function(a,b){return p["default"].browser.IE_VERSION&&10>=p["default"].browser.IE_VERSION||!b.hls.overrideNative&&B.supportsNativeHls?!1:/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i.test(a)};if("undefined"===typeof p["default"].MediaSource||"undefined"===typeof p["default"].URL)p["default"].MediaSource=r.MediaSource,p["default"].URL=r.URL;c=p["default"].getTech("Flash");r.MediaSource.supportsNativeMediaSources()&&p["default"].getTech("Html5").registerSourceHandler(b("html5"),0);e["default"].Uint8Array&&c&&c.registerSourceHandler(b("flash"));p["default"].HlsHandler=D;p["default"].HlsSourceHandler=b;p["default"].Hls=B;p["default"].use||p["default"].registerComponent("Hls",B);p["default"].m3u8=g["default"];p["default"].options.hls=p["default"].options.hls||{};p["default"].registerPlugin?p["default"].registerPlugin("reloadSourceOnError",C["default"]):p["default"].plugin("reloadSourceOnError",C["default"]);q.exports={Hls:B,HlsHandler:D,HlsSourceHandler:b}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./bin-utils":2,"./config":3,"./master-playlist-controller":5,"./playback-watcher":7,"./playlist":10,"./playlist-loader":8,"./playlist-selectors.js":9,"./reload-source-on-error":12,"./rendition-mixin":13,"./xhr":19,"aes-decrypter":23,"global/document":26,"global/window":27,"m3u8-parser":28,"videojs-contrib-media-sources":73}]},{},[76])(76)});